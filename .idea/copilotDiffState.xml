<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/boat-listing/boat-details.php">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/boat-listing/boat-details.php" />
              <option name="originalContent" value="&lt;?php&#10;&#10;add_shortcode('boat_details', 'render_single_boat_by_query');&#10;&#10;function render_single_boat_by_query() {&#10;    $helper = new Boat_Listing_Helper();&#10;&#10;    $current_year = date('Y');&#10;    $boat_id = sanitize_text_field($_GET['yachtId'] ?? '');&#10;    $country = sanitize_text_field($_GET['country'] ?? '');&#10;    $dateFrom = sanitize_text_field($_GET['dateFrom'] ?? '');&#10;    $dateTo = sanitize_text_field($_GET['dateTo'] ?? '');&#10;    $productName = sanitize_text_field($_GET['productName'] ?? '');&#10;    $charterType = sanitize_text_field($_GET['charterType'] ?? '');&#10;    $cabin = sanitize_text_field($_GET['cabin'] ?? '');&#10;    $year = sanitize_text_field($_GET['year'] ?? '');&#10;    $person = sanitize_text_field($_GET['person'] ?? '');&#10;    $berths = sanitize_text_field($_GET['berths'] ?? '');&#10;    $wc = sanitize_text_field($_GET['wc'] ?? '');&#10;    $minLength = sanitize_text_field($_GET['minLength'] ?? '');&#10;    $maxLength = sanitize_text_field($_GET['maxLength'] ?? '');&#10;    $companyId = sanitize_text_field($_GET['companyId'] ?? '');&#10;    $baseFromId = sanitize_text_field($_GET['baseFromId'] ?? '');&#10;    $baseToId = sanitize_text_field($_GET['baseToId'] ?? '');&#10;    $sailingAreaId = sanitize_text_field($_GET['sailingAreaId'] ?? '');&#10;    $modelId = sanitize_text_field($_GET['modelId'] ?? '');&#10;    $flexibility = sanitize_text_field($_GET['flexibility'] ?? '');&#10;&#10;    $default_date_from = $current_year . '-01-01T00:00:00';&#10;    $default_date_to = $current_year . '-12-31T00:00:00';&#10;&#10;    $date_from = sanitize_text_field($_GET['dateFrom'] ?? $default_date_from);&#10;    $date_to   = sanitize_text_field($_GET['dateTo'] ?? $default_date_to);&#10;&#10;    // Ensure dates have proper ISO time format if they don't already&#10;    if (!empty($date_from) &amp;&amp; strpos($date_from, 'T') === false) {&#10;        $date_from .= 'T00:00:00';&#10;    }&#10;    if (!empty($date_to) &amp;&amp; strpos($date_to, 'T') === false) {&#10;        $date_to .= 'T00:00:00';&#10;    }&#10;&#10;    // Prepare all filters for API call including the specific yachtId&#10;    $all_filters = [&#10;            'country' =&gt; $country,&#10;            'productName' =&gt; $productName,&#10;            'charterType' =&gt; $charterType,&#10;            'person' =&gt; $person,&#10;            'cabin' =&gt; $cabin,&#10;            'year' =&gt; $year,&#10;            'berths' =&gt; $berths,&#10;            'wc' =&gt; $wc,&#10;            'minLength' =&gt; $minLength,&#10;            'maxLength' =&gt; $maxLength,&#10;            'companyId' =&gt; $companyId,&#10;            'baseFromId' =&gt; $baseFromId,&#10;            'baseToId' =&gt; $baseToId,&#10;            'sailingAreaId' =&gt; $sailingAreaId,&#10;            'modelId' =&gt; $modelId,&#10;            'flexibility' =&gt; $flexibility,&#10;            'yachtId' =&gt; [$boat_id],&#10;    ];&#10;&#10;    // Remove empty values but keep meaningful zeros and arrays&#10;    $filters_for_api = array_filter($all_filters, function($value) {&#10;        return $value !== '' &amp;&amp; $value !== null &amp;&amp; (!is_array($value) || !empty($value));&#10;    });&#10;&#10;    // ========== CRITICAL CACHE #1: BOAT DATA (24 HOURS) ==========&#10;    $cache_key_boat = 'bl_boat_' . $boat_id;&#10;    $boat_data = get_transient($cache_key_boat);&#10;&#10;    if ($boat_data === false) {&#10;        error_log(&quot; Cache MISS for boat: {$boat_id}&quot;);&#10;        $boat_data = $helper-&gt;fetch_all_boats($boat_id);&#10;&#10;        if (!empty($boat_data)) {&#10;            set_transient($cache_key_boat, $boat_data, DAY_IN_SECONDS);&#10;            error_log(&quot; Cached boat data: {$boat_id}&quot;);&#10;        }&#10;    } else {&#10;        error_log(&quot;✅ Cache HIT for boat: {$boat_id}&quot;);&#10;    }&#10;    // ============================================================&#10;&#10;    // ========== CRITICAL CACHE #2: PRICE DATA (1 HOUR) ==========&#10;    $cache_key_price = 'bl_price_' . md5($boat_id . $date_from . $date_to . serialize($filters_for_api));&#10;    $prices = get_transient($cache_key_price);&#10;&#10;    if ($prices === false) {&#10;        error_log(&quot; Cache MISS for prices: boat {$boat_id}&quot;);&#10;        $prices = $helper-&gt;get_single_yacht_offer_details($boat_id, $date_from, $date_to, $filters_for_api);&#10;&#10;        if (!empty($prices)) {&#10;            set_transient($cache_key_price, $prices, HOUR_IN_SECONDS);&#10;            error_log(&quot; Cached price data: {$boat_id}&quot;);&#10;        }&#10;    } else {&#10;        error_log(&quot;✅ Cache HIT for prices: boat {$boat_id}&quot;);&#10;    }&#10;    // ============================================================&#10;&#10;    if (empty($boat_id)) {&#10;        return '&lt;p&gt;No boat ID provided.&lt;/p&gt;';&#10;    }&#10;&#10;    if (empty($boat_data)) {&#10;        return '&lt;p&gt;Boat not found.&lt;/p&gt;';&#10;    }&#10;&#10;    // Extract boat data from the result&#10;    $data = $boat_data['data'] ?? [];&#10;&#10;    if (empty($data)) {&#10;        return '&lt;p&gt;Invalid boat data.&lt;/p&gt;';&#10;    }&#10;&#10;    // Build back to results URL with all current filter parameters&#10;    $back_params = [];&#10;&#10;    $filter_params = [&#10;            'country', 'productName', 'charterType', 'person', 'cabin', 'year',&#10;            'berths', 'wc', 'minLength', 'maxLength', 'companyId', 'baseFromId',&#10;            'baseToId', 'sailingAreaId', 'modelId', 'flexibility', 'dateFrom', 'dateTo'&#10;    ];&#10;&#10;    foreach ($filter_params as $param) {&#10;        if (!empty($_GET[$param])) {&#10;            $back_params[] = $param . '=' . urlencode($_GET[$param]);&#10;        }&#10;    }&#10;&#10;    $back_url = site_url('/boat-filter' . (!empty($back_params) ? '?' . implode('&amp;', $back_params) : ''));&#10;    $show_back_button = !empty($back_params);&#10;&#10;    ob_start();&#10;    ?&gt;&#10;    &lt;div class=&quot;single-boat-details&quot;&gt;&#10;&#10;        &lt;div class=&quot;single-boat-img&quot;&gt;&#10;            &lt;div class=&quot;bl-slick-slider&quot;&gt;&#10;                &lt;?php if (!empty($data['images'])): ?&gt;&#10;                    &lt;?php foreach ($data['images'] as $img): ?&gt;&#10;                        &lt;?php if (!empty($img['url'])): ?&gt;&#10;                            &lt;div&gt;&#10;                                &lt;a href=&quot;&lt;?php echo esc_url($img['url']); ?&gt;&quot; data-fancybox=&quot;gallery&quot;&gt;&#10;                                    &lt;img src=&quot;&lt;?php echo esc_url($img['url']); ?&gt;&quot; alt=&quot;&lt;?php echo esc_attr($data['name']); ?&gt;&quot;&gt;&#10;                                &lt;/a&gt;&#10;                            &lt;/div&gt;&#10;                        &lt;?php endif; ?&gt;&#10;                    &lt;?php endforeach; ?&gt;&#10;                &lt;?php else: ?&gt;&#10;                    &lt;div&gt;&#10;                        &lt;img src=&quot;&lt;?php echo esc_url(plugins_url('assets/no-image.jpg', __FILE__)); ?&gt;&quot; alt=&quot;No image&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;?php endif; ?&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;bl-slick-slider-nav&quot;&gt;&#10;                &lt;?php if (!empty($data['images'])): ?&gt;&#10;                    &lt;?php foreach ($data['images'] as $img): ?&gt;&#10;                        &lt;?php if (!empty($img['url'])): ?&gt;&#10;                            &lt;div&gt;&#10;                                &lt;img src=&quot;&lt;?php echo esc_url($img['url']); ?&gt;&quot; alt=&quot;&lt;?php echo esc_attr($data['name']); ?&gt;&quot;&gt;&#10;                            &lt;/div&gt;&#10;                        &lt;?php endif; ?&gt;&#10;                    &lt;?php endforeach; ?&gt;&#10;                &lt;?php endif; ?&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div class=&quot;boat-details&quot;&gt;&#10;            &lt;h4&gt;&#10;                &lt;?php&#10;                echo esc_html($data['name']);&#10;&#10;                if (!empty($data['homeBase'])) {&#10;                    echo ' in &lt;span class=&quot;location&quot;&gt;&lt;i class=&quot;ri-map-pin-line&quot;&gt;&lt;/i&gt; ' . esc_html($data['homeBase']) . '&lt;/span&gt;';&#10;                }&#10;                ?&gt;&#10;            &lt;/h4&gt;&#10;            &lt;div class=&quot;company-info info-card&quot;&gt;&#10;                &lt;h5&gt;Yacht Information&lt;/h5&gt;&#10;                &lt;ul&gt;&#10;                    &lt;li&gt;&#10;                        &lt;span&gt;&lt;?php _e('Price:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                        &lt;?php&#10;                        if ($prices &amp;&amp; $prices['min'] !== 'N/A' &amp;&amp; $prices['max'] !== 'N/A') {&#10;                            echo esc_html($prices['min'] . ' to ' . $prices['max'] . ' ' . $prices['currency']);&#10;                        } else {&#10;                            echo 'N/A';&#10;                        }&#10;                        ?&gt;&#10;                        &lt;a href=&quot;#yachtPrice&quot; class=&quot;open-tab-link&quot;&gt;View Full List&lt;/a&gt;&#10;                    &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Yacht Type:', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['kind']) ? esc_html($data['kind']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Cabins:', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['cabins']) ? esc_html($data['cabins']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Yacht Age:', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['year']) ? esc_html($data['year']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Beam (Feet):', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['beam']) ? esc_html($data['beam']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Engine(s):', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['engine']) ? esc_html($data['engine']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Engine(s) Power:', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['engine']) ? esc_html($data['engine']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Fuel Capacity:', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['fuelCapacity']) ? esc_html($data['fuelCapacity']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Length (Feet):', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['length']) ? esc_html($data['length']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                &lt;/ul&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;button class=&quot;boat-book-now&quot; data-id=&quot;&lt;?php echo $boat_id; ?&gt;&quot;&gt;Request to book&lt;/button&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;bl-single-full-boat-details&quot;&gt;&#10;        &lt;div class=&quot;details&quot;&gt;&#10;&#10;            &lt;div class=&quot;title&quot;&gt;Details&lt;/div&gt;&#10;&#10;            &lt;div class=&quot;features&quot;&gt;&#10;&#10;                &lt;div class=&quot;yachtdeails-info&quot;&gt;&#10;                    &lt;div class=&quot;f-title&quot;&gt;Features&lt;/div&gt;&#10;                    &lt;ul&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Yacht Type:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['kind'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Model:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['model'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Yacht Age:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['year'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Max Persons:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['maxPeopleOnBoard'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Cabins:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['cabins'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Total Showers / WC:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['wc'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Berths (Total):', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['berths'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                    &lt;/ul&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;div class=&quot;layout yachtdeails-info&quot;&gt;&#10;                    &lt;div class=&quot;f-title&quot;&gt;Layout&lt;/div&gt;&#10;                    &lt;ul&gt;&#10;                        &lt;li&gt;&#10;                            &lt;span&gt;&lt;?php _e('Yacht Layout:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php&#10;                            if (!empty($data['images'])) {&#10;                                foreach ($data['images'] as $img) {&#10;                                    if (!empty($img['url']) &amp;&amp; stripos($img['name'], 'layout') !== false) {&#10;                                        echo '&lt;a href=&quot;' . esc_url($img['url']) . '&quot; target=&quot;_blank&quot;&gt;&#10;                            &lt;img src=&quot;' . esc_url($img['url']) . '&quot; style=&quot;max-width:60px;margin:5px;&quot;&gt;&#10;                            &lt;/a&gt;';&#10;                                    }&#10;                                }&#10;                            }&#10;                            ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Yacht Length (m):', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['length'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Beam (m):', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['beam'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Draft (m):', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['draught'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Engine(s):', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['engine'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Fuel Capacity:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['fuelCapacity'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Water Capacity:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['waterCapacity'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;                    &lt;/ul&gt;&#10;                &lt;/div&gt;&#10;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div class=&quot;location&quot;&gt;&#10;            &lt;div class=&quot;title&quot;&gt;Location&lt;/div&gt;&#10;&#10;            &lt;div class=&quot;l-features&quot;&gt;&#10;&#10;                &lt;ul&gt;&#10;                    &lt;li&gt;&#10;                        &lt;span&gt;&lt;?php _e('Check In Time:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                        &lt;?php echo !empty($data['defaultCheckInTime']) ? esc_html($data['defaultCheckInTime']) : __('N/A', 'boat-listing'); ?&gt;&#10;                    &lt;/li&gt;&#10;&#10;                    &lt;li&gt;&#10;                        &lt;span&gt;&lt;?php _e('Check Out Time:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                        &lt;?php echo !empty($data['defaultCheckOutTime']) ? esc_html($data['defaultCheckOutTime']) : __('N/A', 'boat-listing'); ?&gt;&#10;                    &lt;/li&gt;&#10;                    &lt;li&gt;&#10;                        &lt;span&gt;&lt;?php _e('Location:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                        &lt;?php echo !empty($data['homeBase']) ? esc_html($data['homeBase']) : __('N/A', 'boat-listing'); ?&gt;&#10;                    &lt;/li&gt;&#10;                &lt;/ul&gt;&#10;&#10;                &lt;div class=&quot;boat-map&quot;&gt;&#10;                    &lt;?php&#10;                    $homeBase = urlencode((string) ($data['homeBase'] ?? ''));&#10;                    ?&gt;&#10;&#10;                    &lt;iframe&#10;                            src=&quot;https://maps.google.com/maps?q=&lt;?php echo esc_attr($homeBase); ?&gt;&amp;z=14&amp;output=embed&quot;&#10;                            width=&quot;100%&quot;&#10;                            height=&quot;200&quot;&#10;                            style=&quot;border:0;&quot;&#10;                            allowfullscreen&#10;                            loading=&quot;lazy&quot;&#10;                            referrerpolicy=&quot;no-referrer-when-downgrade&quot;&gt;&#10;                    &lt;/iframe&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div class=&quot;price&quot;&gt;&#10;            &lt;div class=&quot;title&quot;&gt;Price Info&lt;/div&gt;&#10;            &lt;div class=&quot;yachtPrice&quot;&gt;&#10;                &lt;?php if (!empty($prices['rows'])): ?&gt;&#10;                    &lt;table class=&quot;table table-stripe&quot;&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;th&gt;From&lt;/th&gt;&#10;                            &lt;th&gt;To&lt;/th&gt;&#10;                            &lt;th&gt;Price&lt;/th&gt;&#10;                            &lt;th&gt;Currency&lt;/th&gt;&#10;                        &lt;/tr&gt;&#10;&#10;                        &lt;?php foreach ($prices['rows'] as $row): ?&gt;&#10;                            &lt;tr&gt;&#10;                                &lt;td&gt;&#10;                                    &lt;?php echo esc_html(date('Y-m-d', strtotime($row['dateFrom']))); ?&gt;&#10;                                &lt;/td&gt;&#10;                                &lt;td&gt;&#10;                                    &lt;?php echo esc_html(date('Y-m-d', strtotime($row['dateTo']))); ?&gt;&#10;                                &lt;/td&gt;&#10;                                &lt;td&gt;&lt;?php echo esc_html(number_format($row['totalPrice'] ?? $row['price'], 2)); ?&gt;&lt;/td&gt;&#10;                                &lt;td&gt;&lt;?php echo esc_html($row['currency']); ?&gt;&lt;/td&gt;&#10;                            &lt;/tr&gt;&#10;                        &lt;?php endforeach; ?&gt;&#10;                    &lt;/table&gt;&#10;                &lt;?php else: ?&gt;&#10;                    &lt;p&gt;Price not available&lt;/p&gt;&#10;                &lt;?php endif; ?&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;?php&#10;    // This shortcode for booking modal&#10;    echo do_shortcode('[book_now_modal_shortcode]');&#10;    ?&gt;&#10;&#10;    &lt;?php if ($show_back_button): ?&gt;&#10;        &lt;!-- Enhanced navigation JavaScript for details page --&gt;&#10;        &lt;script&gt;&#10;            jQuery(document).ready(function($) {&#10;&#10;                // Handle browser back button to go to filter page if came from there&#10;                var referrer = document.referrer;&#10;                if (referrer &amp;&amp; referrer.includes('/boat-filter')) {&#10;                    // User came from filter page - enhance back button behavior&#10;                    console.log(' User came from filter page, enhancing navigation');&#10;&#10;                    // Handle browser back button&#10;                    window.addEventListener('popstate', function(event) {&#10;                        if (referrer.includes('/boat-filter')) {&#10;                            window.location.href = '&lt;?php echo esc_js($back_url); ?&gt;';&#10;                        }&#10;                    });&#10;&#10;                    // Add keyboard shortcut (Escape key) for quick back navigation&#10;                    $(document).keydown(function(e) {&#10;                        if (e.keyCode === 27) { // Escape key&#10;                            window.location.href = '&lt;?php echo esc_js($back_url); ?&gt;';&#10;                        }&#10;                    });&#10;&#10;                    // Add visual feedback for back button&#10;                    $('.back-to-results a').on('click', function() {&#10;                        $(this).css('opacity', '0.7');&#10;                        console.log(' Navigating back to search results with filters preserved');&#10;                    });&#10;                }&#10;&#10;                // Log filter parameters being preserved for debugging&#10;                var urlParams = new URLSearchParams(window.location.search);&#10;                var filterParams = [];&#10;                var preservedParams = ['country', 'productName', 'charterType', 'person', 'cabin', 'year', 'dateFrom', 'dateTo'];&#10;&#10;                preservedParams.forEach(function(param) {&#10;                    if (urlParams.get(param)) {&#10;                        filterParams.push(param + '=' + urlParams.get(param));&#10;                    }&#10;                });&#10;&#10;                if (filterParams.length &gt; 0) {&#10;                    console.log(' Details page loaded with filter parameters:', filterParams.join('&amp;'));&#10;                }&#10;&#10;                // Log cache performance&#10;                console.log('⚡ Cache Status - Boat: &lt;?php echo ($boat_data !== false) ? &quot;HIT&quot; : &quot;MISS&quot;; ?&gt;, Price: &lt;?php echo ($prices !== false) ? &quot;HIT&quot; : &quot;MISS&quot;; ?&gt;');&#10;&#10;            });&#10;        &lt;/script&gt;&#10;    &lt;?php endif; ?&gt;&#10;&#10;    &lt;?php&#10;&#10;    return ob_get_clean();&#10;}&#10;&#10;/**&#10; * AJAX handler to clear details page cache&#10; */&#10;add_action('wp_ajax_bl_clear_details_cache', 'bl_clear_details_cache_handler');&#10;add_action('wp_ajax_nopriv_bl_clear_details_cache', 'bl_clear_details_cache_handler');&#10;&#10;function bl_clear_details_cache_handler() {&#10;    $boat_id = sanitize_text_field($_POST['boat_id'] ?? '');&#10;&#10;    if ($boat_id) {&#10;        delete_transient('bl_boat_' . $boat_id);&#10;&#10;        // Clear all price caches for this boat&#10;        global $wpdb;&#10;        $wpdb-&gt;query(&#10;                $wpdb-&gt;prepare(&#10;                        &quot;DELETE FROM {$wpdb-&gt;options} WHERE option_name LIKE %s&quot;,&#10;                        '%_transient_bl_price_' . md5($boat_id . '%') . '%'&#10;                )&#10;        );&#10;&#10;        wp_send_json_success(['message' =&gt; 'Cache cleared for boat ' . $boat_id]);&#10;    } else {&#10;        wp_send_json_error(['message' =&gt; 'No boat ID provided']);&#10;    }&#10;}" />
              <option name="updatedContent" value="&lt;?php&#10;&#10;add_shortcode('boat_details', 'render_single_boat_by_query');&#10;&#10;function render_single_boat_by_query() {&#10;    $helper = new Boat_Listing_Helper();&#10;&#10;    $current_year = date('Y');&#10;    $boat_id = sanitize_text_field($_GET['yachtId'] ?? '');&#10;    $country = sanitize_text_field($_GET['country'] ?? '');&#10;    $dateFrom = sanitize_text_field($_GET['dateFrom'] ?? '');&#10;    $dateTo = sanitize_text_field($_GET['dateTo'] ?? '');&#10;    $productName = sanitize_text_field($_GET['productName'] ?? '');&#10;    $charterType = sanitize_text_field($_GET['charterType'] ?? '');&#10;    $cabin = sanitize_text_field($_GET['cabin'] ?? '');&#10;    $year = sanitize_text_field($_GET['year'] ?? '');&#10;    $person = sanitize_text_field($_GET['person'] ?? '');&#10;    $berths = sanitize_text_field($_GET['berths'] ?? '');&#10;    $wc = sanitize_text_field($_GET['wc'] ?? '');&#10;    $minLength = sanitize_text_field($_GET['minLength'] ?? '');&#10;    $maxLength = sanitize_text_field($_GET['maxLength'] ?? '');&#10;    $companyId = sanitize_text_field($_GET['companyId'] ?? '');&#10;    $baseFromId = sanitize_text_field($_GET['baseFromId'] ?? '');&#10;    $baseToId = sanitize_text_field($_GET['baseToId'] ?? '');&#10;    $sailingAreaId = sanitize_text_field($_GET['sailingAreaId'] ?? '');&#10;    $modelId = sanitize_text_field($_GET['modelId'] ?? '');&#10;    $flexibility = sanitize_text_field($_GET['flexibility'] ?? '');&#10;&#10;    $default_date_from = $current_year . '-01-01T00:00:00';&#10;    $default_date_to = $current_year . '-12-31T00:00:00';&#10;&#10;    $date_from = sanitize_text_field($_GET['dateFrom'] ?? $default_date_from);&#10;    $date_to   = sanitize_text_field($_GET['dateTo'] ?? $default_date_to);&#10;&#10;    // Ensure dates have proper ISO time format if they don't already&#10;    if (!empty($date_from) &amp;&amp; strpos($date_from, 'T') === false) {&#10;        $date_from .= 'T00:00:00';&#10;    }&#10;    if (!empty($date_to) &amp;&amp; strpos($date_to, 'T') === false) {&#10;        $date_to .= 'T00:00:00';&#10;    }&#10;&#10;    // Prepare all filters for API call including the specific yachtId&#10;    $all_filters = [&#10;            'country' =&gt; $country,&#10;            'productName' =&gt; $productName,&#10;            'charterType' =&gt; $charterType,&#10;            'person' =&gt; $person,&#10;            'cabin' =&gt; $cabin,&#10;            'year' =&gt; $year,&#10;            'berths' =&gt; $berths,&#10;            'wc' =&gt; $wc,&#10;            'minLength' =&gt; $minLength,&#10;            'maxLength' =&gt; $maxLength,&#10;            'companyId' =&gt; $companyId,&#10;            'baseFromId' =&gt; $baseFromId,&#10;            'baseToId' =&gt; $baseToId,&#10;            'sailingAreaId' =&gt; $sailingAreaId,&#10;            'modelId' =&gt; $modelId,&#10;            'flexibility' =&gt; $flexibility,&#10;            'yachtId' =&gt; [$boat_id],&#10;    ];&#10;&#10;    // Remove empty values but keep meaningful zeros and arrays&#10;    $filters_for_api = array_filter($all_filters, function($value) {&#10;        return $value !== '' &amp;&amp; $value !== null &amp;&amp; (!is_array($value) || !empty($value));&#10;    });&#10;&#10;    // ========== CRITICAL CACHE #1: BOAT DATA (24 HOURS) ==========&#10;    $cache_key_boat = 'bl_boat_' . $boat_id;&#10;    $boat_data = get_transient($cache_key_boat);&#10;&#10;    if ($boat_data === false) {&#10;        error_log(&quot; Cache MISS for boat: {$boat_id}&quot;);&#10;        $boat_data = $helper-&gt;fetch_all_boats($boat_id);&#10;&#10;        if (!empty($boat_data)) {&#10;            set_transient($cache_key_boat, $boat_data, DAY_IN_SECONDS);&#10;            error_log(&quot; Cached boat data: {$boat_id}&quot;);&#10;        }&#10;    } else {&#10;        error_log(&quot;✅ Cache HIT for boat: {$boat_id}&quot;);&#10;    }&#10;    // ============================================================&#10;&#10;    // ========== CRITICAL CACHE #2: PRICE DATA (1 HOUR) ==========&#10;    $cache_key_price = 'bl_price_' . md5($boat_id . $date_from . $date_to . serialize($filters_for_api));&#10;    $prices = get_transient($cache_key_price);&#10;&#10;    if ($prices === false) {&#10;        error_log(&quot; Cache MISS for prices: boat {$boat_id}&quot;);&#10;        $prices = $helper-&gt;get_single_yacht_offer_details($boat_id, $date_from, $date_to, $filters_for_api);&#10;&#10;        if (!empty($prices)) {&#10;            set_transient($cache_key_price, $prices, HOUR_IN_SECONDS);&#10;            error_log(&quot; Cached price data: {$boat_id}&quot;);&#10;        }&#10;    } else {&#10;        error_log(&quot;✅ Cache HIT for prices: boat {$boat_id}&quot;);&#10;    }&#10;    // ============================================================&#10;&#10;    if (empty($boat_id)) {&#10;        return '&lt;p&gt;No boat ID provided.&lt;/p&gt;';&#10;    }&#10;&#10;    if (empty($boat_data)) {&#10;        return '&lt;p&gt;Boat not found.&lt;/p&gt;';&#10;    }&#10;&#10;    // Extract boat data from the result&#10;    $data = $boat_data['data'] ?? [];&#10;&#10;    if (empty($data)) {&#10;        return '&lt;p&gt;Invalid boat data.&lt;/p&gt;';&#10;    }&#10;&#10;    // Build back to results URL with all current filter parameters&#10;    $back_params = [];&#10;&#10;    $filter_params = [&#10;            'country', 'productName', 'charterType', 'person', 'cabin', 'year',&#10;            'berths', 'wc', 'minLength', 'maxLength', 'companyId', 'baseFromId',&#10;            'baseToId', 'sailingAreaId', 'modelId', 'flexibility', 'dateFrom', 'dateTo'&#10;    ];&#10;&#10;    foreach ($filter_params as $param) {&#10;        if (!empty($_GET[$param])) {&#10;            $back_params[] = $param . '=' . urlencode($_GET[$param]);&#10;        }&#10;    }&#10;&#10;    $back_url = site_url('/boat-filter' . (!empty($back_params) ? '?' . implode('&amp;', $back_params) : ''));&#10;    $show_back_button = !empty($back_params);&#10;&#10;    ob_start();&#10;    ?&gt;&#10;    &lt;div class=&quot;single-boat-details&quot;&gt;&#10;&#10;        &lt;div class=&quot;single-boat-img&quot;&gt;&#10;            &lt;div class=&quot;bl-slick-slider&quot;&gt;&#10;                &lt;?php if (!empty($data['images'])): ?&gt;&#10;                    &lt;?php foreach ($data['images'] as $img): ?&gt;&#10;                        &lt;?php if (!empty($img['url'])): ?&gt;&#10;                            &lt;div&gt;&#10;                                &lt;a href=&quot;&lt;?php echo esc_url($img['url']); ?&gt;&quot; data-fancybox=&quot;gallery&quot;&gt;&#10;                                    &lt;img src=&quot;&lt;?php echo esc_url($img['url']); ?&gt;&quot; alt=&quot;&lt;?php echo esc_attr($data['name']); ?&gt;&quot;&gt;&#10;                                &lt;/a&gt;&#10;                            &lt;/div&gt;&#10;                        &lt;?php endif; ?&gt;&#10;                    &lt;?php endforeach; ?&gt;&#10;                &lt;?php else: ?&gt;&#10;                    &lt;div&gt;&#10;                        &lt;img src=&quot;&lt;?php echo esc_url(plugins_url('assets/no-image.jpg', __FILE__)); ?&gt;&quot; alt=&quot;No image&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;?php endif; ?&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;bl-slick-slider-nav&quot;&gt;&#10;                &lt;?php if (!empty($data['images'])): ?&gt;&#10;                    &lt;?php foreach ($data['images'] as $img): ?&gt;&#10;                        &lt;?php if (!empty($img['url'])): ?&gt;&#10;                            &lt;div&gt;&#10;                                &lt;img src=&quot;&lt;?php echo esc_url($img['url']); ?&gt;&quot; alt=&quot;&lt;?php echo esc_attr($data['name']); ?&gt;&quot;&gt;&#10;                            &lt;/div&gt;&#10;                        &lt;?php endif; ?&gt;&#10;                    &lt;?php endforeach; ?&gt;&#10;                &lt;?php endif; ?&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div class=&quot;boat-details&quot;&gt;&#10;            &lt;h4&gt;&#10;                &lt;?php&#10;                echo esc_html($data['name']);&#10;&#10;                if (!empty($data['homeBase'])) {&#10;                    echo ' in &lt;span class=&quot;location&quot;&gt;&lt;i class=&quot;ri-map-pin-line&quot;&gt;&lt;/i&gt; ' . esc_html($data['homeBase']) . '&lt;/span&gt;';&#10;                }&#10;                ?&gt;&#10;            &lt;/h4&gt;&#10;            &lt;div class=&quot;company-info info-card&quot;&gt;&#10;                &lt;h5&gt;Yacht Information&lt;/h5&gt;&#10;                &lt;ul&gt;&#10;                    &lt;li&gt;&#10;                        &lt;span&gt;&lt;?php _e('Price:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                        &lt;?php&#10;                        if ($prices &amp;&amp; $prices['min'] !== 'N/A' &amp;&amp; $prices['max'] !== 'N/A') {&#10;                            echo esc_html($prices['min'] . ' to ' . $prices['max'] . ' ' . $prices['currency']);&#10;                        } else {&#10;                            echo 'N/A';&#10;                        }&#10;                        ?&gt;&#10;                        &lt;a href=&quot;#yachtPrice&quot; class=&quot;open-tab-link&quot;&gt;View Full List&lt;/a&gt;&#10;                    &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Yacht Type:', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['kind']) ? esc_html($data['kind']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Cabins:', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['cabins']) ? esc_html($data['cabins']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Yacht Age:', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['year']) ? esc_html($data['year']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Beam (Feet):', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['beam']) ? esc_html($data['beam']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Engine(s):', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['engine']) ? esc_html($data['engine']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Engine(s) Power:', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['engine']) ? esc_html($data['engine']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Fuel Capacity:', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['fuelCapacity']) ? esc_html($data['fuelCapacity']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                    &lt;li&gt;&lt;span&gt;&lt;?php _e('Length (Feet):', 'boat-listing'); ?&gt;&lt;/span&gt; &lt;?php echo !empty($data['length']) ? esc_html($data['length']) : __('N/A', 'boat-listing'); ?&gt; &lt;/li&gt;&#10;                &lt;/ul&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;button class=&quot;boat-book-now&quot; data-id=&quot;&lt;?php echo $boat_id; ?&gt;&quot;&gt;Request to book&lt;/button&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;bl-single-full-boat-details&quot;&gt;&#10;        &lt;div class=&quot;details&quot;&gt;&#10;&#10;            &lt;div class=&quot;title&quot;&gt;Details&lt;/div&gt;&#10;&#10;            &lt;div class=&quot;features&quot;&gt;&#10;&#10;                &lt;div class=&quot;yachtdeails-info&quot;&gt;&#10;                    &lt;div class=&quot;f-title&quot;&gt;Features&lt;/div&gt;&#10;                    &lt;ul&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Yacht Type:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['kind'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Model:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['model'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Yacht Age:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['year'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Max Persons:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['maxPeopleOnBoard'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Cabins:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['cabins'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Total Showers / WC:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['wc'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Berths (Total):', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['berths'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                    &lt;/ul&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;div class=&quot;layout yachtdeails-info&quot;&gt;&#10;                    &lt;div class=&quot;f-title&quot;&gt;Layout&lt;/div&gt;&#10;                    &lt;ul&gt;&#10;                        &lt;li&gt;&#10;                            &lt;span&gt;&lt;?php _e('Yacht Layout:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php&#10;                            if (!empty($data['images'])) {&#10;                                foreach ($data['images'] as $img) {&#10;                                    if (!empty($img['url']) &amp;&amp; stripos($img['name'], 'layout') !== false) {&#10;                                        echo '&lt;a href=&quot;' . esc_url($img['url']) . '&quot; target=&quot;_blank&quot;&gt;&#10;                            &lt;img src=&quot;' . esc_url($img['url']) . '&quot; style=&quot;max-width:60px;margin:5px;&quot;&gt;&#10;                            &lt;/a&gt;';&#10;                                    }&#10;                                }&#10;                            }&#10;                            ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Yacht Length (m):', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['length'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Beam (m):', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['beam'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Draft (m):', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['draught'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Engine(s):', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['engine'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Fuel Capacity:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['fuelCapacity'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;&#10;                        &lt;li&gt;&lt;span&gt;&lt;?php _e('Water Capacity:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                            &lt;?php echo esc_html($data['waterCapacity'] ?? 'N/A'); ?&gt;&#10;                        &lt;/li&gt;&#10;                    &lt;/ul&gt;&#10;                &lt;/div&gt;&#10;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div class=&quot;location&quot;&gt;&#10;            &lt;div class=&quot;title&quot;&gt;Location&lt;/div&gt;&#10;&#10;            &lt;div class=&quot;l-features&quot;&gt;&#10;&#10;                &lt;ul&gt;&#10;                    &lt;li&gt;&#10;                        &lt;span&gt;&lt;?php _e('Check In Time:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                        &lt;?php echo !empty($data['defaultCheckInTime']) ? esc_html($data['defaultCheckInTime']) : __('N/A', 'boat-listing'); ?&gt;&#10;                    &lt;/li&gt;&#10;&#10;                    &lt;li&gt;&#10;                        &lt;span&gt;&lt;?php _e('Check Out Time:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                        &lt;?php echo !empty($data['defaultCheckOutTime']) ? esc_html($data['defaultCheckOutTime']) : __('N/A', 'boat-listing'); ?&gt;&#10;                    &lt;/li&gt;&#10;                    &lt;li&gt;&#10;                        &lt;span&gt;&lt;?php _e('Location:', 'boat-listing'); ?&gt;&lt;/span&gt;&#10;                        &lt;?php echo !empty($data['homeBase']) ? esc_html($data['homeBase']) : __('N/A', 'boat-listing'); ?&gt;&#10;                    &lt;/li&gt;&#10;                &lt;/ul&gt;&#10;&#10;                &lt;div class=&quot;boat-map&quot;&gt;&#10;                    &lt;?php&#10;                    $homeBase = urlencode((string) ($data['homeBase'] ?? ''));&#10;                    ?&gt;&#10;&#10;                    &lt;iframe&#10;                            src=&quot;https://maps.google.com/maps?q=&lt;?php echo esc_attr($homeBase); ?&gt;&amp;z=14&amp;output=embed&quot;&#10;                            width=&quot;100%&quot;&#10;                            height=&quot;200&quot;&#10;                            style=&quot;border:0;&quot;&#10;                            allowfullscreen&#10;                            loading=&quot;lazy&quot;&#10;                            referrerpolicy=&quot;no-referrer-when-downgrade&quot;&gt;&#10;                    &lt;/iframe&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div class=&quot;price&quot;&gt;&#10;            &lt;div class=&quot;title&quot;&gt;Price Info&lt;/div&gt;&#10;            &lt;div class=&quot;yachtPrice&quot;&gt;&#10;                &lt;?php if (!empty($prices['rows'])): ?&gt;&#10;                    &lt;table class=&quot;table table-stripe&quot;&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;th&gt;From&lt;/th&gt;&#10;                            &lt;th&gt;To&lt;/th&gt;&#10;                            &lt;th&gt;Price&lt;/th&gt;&#10;                            &lt;th&gt;Currency&lt;/th&gt;&#10;                        &lt;/tr&gt;&#10;&#10;                        &lt;?php foreach ($prices['rows'] as $row): ?&gt;&#10;                            &lt;tr&gt;&#10;                                &lt;td&gt;&#10;                                    &lt;?php echo esc_html(date('Y-m-d', strtotime($row['dateFrom']))); ?&gt;&#10;                                &lt;/td&gt;&#10;                                &lt;td&gt;&#10;                                    &lt;?php echo esc_html(date('Y-m-d', strtotime($row['dateTo']))); ?&gt;&#10;                                &lt;/td&gt;&#10;                                &lt;td&gt;&lt;?php echo esc_html(number_format($row['totalPrice'] ?? $row['price'], 2)); ?&gt;&lt;/td&gt;&#10;                                &lt;td&gt;&lt;?php echo esc_html($row['currency']); ?&gt;&lt;/td&gt;&#10;                            &lt;/tr&gt;&#10;                        &lt;?php endforeach; ?&gt;&#10;                    &lt;/table&gt;&#10;                &lt;?php else: ?&gt;&#10;                    &lt;p&gt;Price not available&lt;/p&gt;&#10;                &lt;?php endif; ?&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;?php&#10;    // This shortcode for booking modal&#10;    echo do_shortcode('[book_now_modal_shortcode]');&#10;    ?&gt;&#10;&#10;    &lt;?php if ($show_back_button): ?&gt;&#10;        &lt;!-- Enhanced navigation JavaScript for details page --&gt;&#10;        &lt;script&gt;&#10;            jQuery(document).ready(function($) {&#10;&#10;                // Handle browser back button to go to filter page if came from there&#10;                var referrer = document.referrer;&#10;                if (referrer &amp;&amp; referrer.includes('/boat-filter')) {&#10;                    // User came from filter page - enhance back button behavior&#10;                    console.log(' User came from filter page, enhancing navigation');&#10;&#10;                    // Handle browser back button&#10;                    window.addEventListener('popstate', function(event) {&#10;                        if (referrer.includes('/boat-filter')) {&#10;                            window.location.href = '&lt;?php echo esc_js($back_url); ?&gt;';&#10;                        }&#10;                    });&#10;&#10;                    // Add keyboard shortcut (Escape key) for quick back navigation&#10;                    $(document).keydown(function(e) {&#10;                        if (e.keyCode === 27) { // Escape key&#10;                            window.location.href = '&lt;?php echo esc_js($back_url); ?&gt;';&#10;                        }&#10;                    });&#10;&#10;                    // Add visual feedback for back button&#10;                    $('.back-to-results a').on('click', function() {&#10;                        $(this).css('opacity', '0.7');&#10;                        console.log(' Navigating back to search results with filters preserved');&#10;                    });&#10;                }&#10;&#10;                // Log filter parameters being preserved for debugging&#10;                var urlParams = new URLSearchParams(window.location.search);&#10;                var filterParams = [];&#10;                var preservedParams = ['country', 'productName', 'charterType', 'person', 'cabin', 'year', 'dateFrom', 'dateTo'];&#10;&#10;                preservedParams.forEach(function(param) {&#10;                    if (urlParams.get(param)) {&#10;                        filterParams.push(param + '=' + urlParams.get(param));&#10;                    }&#10;                });&#10;&#10;                if (filterParams.length &gt; 0) {&#10;                    console.log(' Details page loaded with filter parameters:', filterParams.join('&amp;'));&#10;                }&#10;&#10;                // Log cache performance&#10;                console.log('⚡ Cache Status - Boat: &lt;?php echo ($boat_data !== false) ? &quot;HIT&quot; : &quot;MISS&quot;; ?&gt;, Price: &lt;?php echo ($prices !== false) ? &quot;HIT&quot; : &quot;MISS&quot;; ?&gt;');&#10;&#10;            });&#10;        &lt;/script&gt;&#10;    &lt;?php endif; ?&gt;&#10;&#10;    &lt;?php&#10;&#10;    return ob_get_clean();&#10;}&#10;&#10;/**&#10; * AJAX handler to clear details page cache&#10; */&#10;add_action('wp_ajax_bl_clear_details_cache', 'bl_clear_details_cache_handler');&#10;add_action('wp_ajax_nopriv_bl_clear_details_cache', 'bl_clear_details_cache_handler');&#10;&#10;function bl_clear_details_cache_handler() {&#10;    $boat_id = sanitize_text_field($_POST['boat_id'] ?? '');&#10;&#10;    if ($boat_id) {&#10;        delete_transient('bl_boat_' . $boat_id);&#10;&#10;        // Clear all price caches for this boat&#10;        global $wpdb;&#10;        $wpdb-&gt;query(&#10;                $wpdb-&gt;prepare(&#10;                        &quot;DELETE FROM {$wpdb-&gt;options} WHERE option_name LIKE %s&quot;,&#10;                        '%_transient_bl_price_' . md5($boat_id . '%') . '%'&#10;                )&#10;        );&#10;&#10;        wp_send_json_success(['message' =&gt; 'Cache cleared for boat ' . $boat_id]);&#10;    } else {&#10;        wp_send_json_error(['message' =&gt; 'No boat ID provided']);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/boat-listing/boat-listing-filters.php">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/boat-listing/boat-listing-filters.php" />
              <option name="originalContent" value="&lt;?php&#10;    add_shortcode('boat_filter', 'render_boat_listing_filter');&#10;&#10;    function render_boat_listing_filter($atts, $content = null){&#10;&#10;        $helper = new Boat_Listing_Helper();&#10;        $icon = $helper-&gt;icons();&#10;        $charterTypes = $helper-&gt;fetch_category();&#10;        $preloader = $helper-&gt;bl_render_boat_overlay_preloader();&#10;        $getBoatProductTypes = $helper-&gt;getBoatProductTypes();&#10;        $data = $helper-&gt;sortPriorityCountries();&#10;        $getYears = $helper-&gt;getBoatYears();&#10;        $getCabins = $helper-&gt;getBoatCabins();&#10;        $getBoatPersons = $helper-&gt;getBoatPersons();&#10;&#10;        $regionsOrdered     = $data['regions'];&#10;        $remainingCountries = $data['countries'];&#10;&#10;        ob_start();&#10;&#10;        ?&gt;&#10;            &lt;div class=&quot;boat-listing-filter-area&quot; style=&quot;position:relative&quot;&gt;&#10;                &lt;div class=&quot;boat-lists-loader&quot;&gt;&lt;?php echo $preloader; ?&gt;&lt;/div&gt;&#10;&#10;                &lt;div class=&quot;boat-listing-filter-wraper&quot;&gt;&#10;                    &lt;div class=&quot;filter-bar-area&quot;&gt;&#10;                        &lt;div class=&quot;filter-bar&quot;&gt;&#10;                            &lt;strong&gt;&lt;?php echo $icon['filter']; ?&gt; Filter By&lt;/strong&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;charterType&quot;&gt;&lt;?php echo $icon['charter_type']; ?&gt; Charter Type&lt;/label&gt;&#10;                                &lt;select name=&quot;charterType&quot; id=&quot;charterType&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Charter Type &lt;/option&gt;&#10;                                    &lt;?php foreach ($charterTypes as $category): ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($category['name']); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($category['name']); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;!-- Date filter --&gt;&#10;                            &lt;!-- Hidden API fields --&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;dateFrom&quot; id=&quot;dateFrom&quot;&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;dateTo&quot; id=&quot;dateTo&quot;&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;dateRange&quot;&gt;&lt;?php echo $icon['date']; ?&gt; Dates &lt;/label&gt;&#10;                                &lt;input type=&quot;text&quot; id=&quot;dateRange&quot; name=&quot;dateRange&quot; placeholder=&quot;Select date range&quot; autocomplete=&quot;off&quot; class=&quot;boat-listing-input-text bl-date-range-picker&quot; /&gt;&#10;                            &lt;/div&gt;&#10;&#10;                             &lt;!-- Regions --&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;country&quot;&gt;&lt;?php echo $icon['location']; ?&gt; Destinations&lt;/label&gt;&#10;                                &lt;select name=&quot;country&quot; id=&quot;country&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;All Destinations&lt;/option&gt;&#10;                                    &lt;?php if (!empty($priorityCountries)): ?&gt;&#10;                                        &lt;optgroup label=&quot;Popular Destinations&quot;&gt;&#10;                                            &lt;?php foreach ($priorityCountries as $country): ?&gt;&#10;                                                &lt;option value=&quot;&lt;?php echo esc_attr($country['id']); ?&gt;&quot;&gt;&#10;                                                    &lt;?php echo esc_html($country['country_data']['name']); ?&gt;&#10;                                                &lt;/option&gt;&#10;                                            &lt;?php endforeach; ?&gt;&#10;                                        &lt;/optgroup&gt;&#10;                                    &lt;?php endif; ?&gt;&#10;&#10;                                    &lt;?php&#10;                                    foreach ($regionsOrdered as $region):&#10;                                        $regionId   = $region['id'];&#10;                                        $regionName = $region['regions_data']['name'] ?? 'Unknown Region';&#10;&#10;                                        $regionCountries = array_filter($remainingCountries, function ($country) use ($regionId) {&#10;                                            return ($country['country_data']['worldRegion'] ?? null) == $regionId;&#10;                                        });&#10;&#10;                                        if (!empty($regionCountries)):&#10;                                            ?&gt;&#10;                                            &lt;optgroup label=&quot;&lt;?php echo esc_html($regionName); ?&gt;&quot;&gt;&#10;                                                &lt;?php foreach ($regionCountries as $country): ?&gt;&#10;                                                    &lt;option value=&quot;&lt;?php echo esc_attr($country['country_data']['shortName']); ?&gt;&quot;&gt;&#10;                                                        − &lt;?php echo esc_html($country['country_data']['name']); ?&gt;&#10;                                                    &lt;/option&gt;&#10;                                                &lt;?php endforeach; ?&gt;&#10;                                            &lt;/optgroup&gt;&#10;                                        &lt;?php&#10;                                        endif;&#10;                                    endforeach;&#10;                                    ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;productName&quot;&gt;&lt;?php echo $icon['category']; ?&gt; Category&lt;/label&gt;&#10;                                &lt;select name=&quot;productName&quot; id=&quot;productName&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Category&lt;/option&gt;&#10;                                    &lt;?php&#10;                                    foreach ($getBoatProductTypes as $productType):&#10;                                        ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($productType); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($productType); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;!--Person filter --&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;people&quot;&gt;&lt;?php echo $icon['person']; ?&gt; Person&lt;/label&gt;&#10;                                &lt;select name=&quot;people&quot; id=&quot;people&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Person&lt;/option&gt;&#10;                                    &lt;?php foreach ($getBoatPersons as $person):&#10;                                        ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($person); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($person); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;cabin&quot;&gt;&lt;?php echo $icon['cabin']; ?&gt; Cabin&lt;/label&gt;&#10;                                &lt;select name=&quot;cabin&quot; id=&quot;cabin&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Cabin&lt;/option&gt;&#10;                                    &lt;?php foreach( $getCabins as $cabin): ?&gt;&#10;&#10;                                    &lt;option value=&quot;&lt;?php echo $cabin; ?&gt;&quot;&gt;&lt;?php echo $cabin; ?&gt;&lt;/option&gt;&#10;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;year&quot;&gt;&lt;?php echo $icon['date']; ?&gt; Build Year&lt;/label&gt;&#10;                                &lt;select name=&quot;year&quot; id=&quot;year&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Year&lt;/option&gt;&#10;                                    &lt;?php foreach ($getYears as $year):&#10;                                        ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($year); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($year); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;button id=&quot;submitFilter&quot; type=&quot;button&quot;&gt;Filter&lt;/button&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div class=&quot;contact-info&quot;&gt;&#10;                            &lt;h5 class=&quot;title&quot;&gt;&lt;?php echo $icon['headphone']; ?&gt;Help Center&lt;/h5&gt;&#10;                            &lt;p&gt;We're always just a message away&lt;/p&gt;&#10;                            &lt;div class=&quot;contact-content&quot;&gt;&#10;                                &lt;ul&gt;&#10;                                    &lt;li&gt;&lt;?php echo $icon['email_check']; ?&gt; &lt;a href=&quot;mailto:info@thebarefootparadise.com&quot;&gt;Email Us&lt;/a&gt;&lt;/li&gt;&#10;                                    &lt;li&gt;&lt;?php echo $icon['phone']; ?&gt; &lt;a href=&quot;tel:1-284-342-2387&quot;&gt;1-284-342-2387&lt;/a&gt; or &lt;a href=&quot;tel:340-201-8319&quot;&gt;340-201-8319&lt;/a&gt;&lt;/li&gt;&#10;                                    &lt;li&gt;&lt;?php echo $icon['message']; ?&gt; &lt;a href=&quot;javascript:void(0)&quot; id=&quot;boat-listing-open-hubspot-chat-box&quot;&gt;Chat with us&lt;/a&gt;&lt;/li&gt;&#10;                                &lt;/ul&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;button  class=&quot;need-help-btn filter-page-contact-us-frm&quot;&gt; Contact Us &lt;?php echo $icon['question_round']; ?&gt;&lt;/button&gt;&#10;                        &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;boat-listing-area&quot;&gt;&#10;                        &lt;div class=&quot;boat-count-and-pagination&quot;&gt;&#10;                            &lt;div id=&quot;boat-count&quot; class=&quot;boat-count-message&quot;&gt;&#10;                                &lt;!-- boat count result show here --&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;boat-listing-pagi&quot;&gt;&#10;                                &lt;!-- get boat pagination from ajax --&gt;&#10;                            &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                        &#10;                        &lt;div class=&quot;boat-lists&quot;&gt;&#10;                            &lt;!-- get boat list from ajax --&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;div class=&quot;boat-listing-pagi&quot;&gt;&#10;                            &lt;!-- get boat pagination from ajax --&gt;&#10;                        &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;&#10;        &lt;?php&#10;&#10;        $content = ob_get_clean();&#10;&#10;        return $content;&#10;    }&#10;&#10;// End Filter ======================================================&#10;    add_action('wp_ajax_bl_get_paginated_boats', 'bl_get_paginated_boats');&#10;    add_action('wp_ajax_nopriv_bl_get_paginated_boats', 'bl_get_paginated_boats');&#10;&#10;    function bl_get_paginated_boats() {&#10;&#10;        $helper = new Boat_Listing_Helper();&#10;&#10;        $paged = isset($_POST['paged']) ? max(1, intval($_POST['paged'])) : 1;&#10;        $per_page = 10;&#10;&#10;        $filters = [&#10;            'charter_type'  =&gt; sanitize_text_field($_POST['charter_type'] ?? $_GET['charterType'] ?? ''),&#10;            'model'  =&gt; sanitize_text_field($_POST['model'] ?? ''),&#10;            'company'  =&gt; sanitize_text_field($_POST['company'] ?? ''),&#10;            'location' =&gt; sanitize_text_field($_POST['location'] ?? ''),&#10;            'cabin'    =&gt; intval($_POST['cabin'] ?? $_GET['cabin'] ?? 0),&#10;            'person'    =&gt; intval($_POST['person'] ?? $_GET['person'] ?? 0),&#10;            'year'     =&gt; sanitize_text_field($_POST['year'] ?? $_GET['year'] ?? ''),&#10;            'free_yacht'     =&gt; sanitize_text_field($_POST['free_yacht'] ?? ''),&#10;            'category'     =&gt; sanitize_text_field($_POST['category'] ?? ''),&#10;&#10;            // Additional advanced filter parameters&#10;            'berths'    =&gt; intval($_GET['berths'] ?? 0),&#10;            'wc'        =&gt; intval($_GET['wc'] ?? 0),&#10;            'min_length' =&gt; floatval($_GET['minLength'] ?? 0),&#10;            'max_length' =&gt; floatval($_GET['maxLength'] ?? 0),&#10;            'company_id' =&gt; intval($_GET['companyId'] ?? 0),&#10;            'base_from_id' =&gt; intval($_GET['baseFromId'] ?? 0),&#10;            'base_to_id' =&gt; intval($_GET['baseToId'] ?? 0),&#10;            'sailing_area_id' =&gt; intval($_GET['sailingAreaId'] ?? 0),&#10;            'model_id' =&gt; intval($_GET['modelId'] ?? 0),&#10;            'flexibility' =&gt; intval($_GET['flexibility'] ?? 1),&#10;        ];&#10;&#10;        // Debug filters&#10;        error_log(&quot; AJAX Filters received (total: &quot; . count(array_filter($filters)) . &quot;):&quot;);&#10;        foreach($filters as $key =&gt; $value) {&#10;            if (!empty($value)) {&#10;                error_log(&quot;  - {$key}: {$value}&quot;);&#10;            }&#10;        }&#10;&#10;        $country = isset($_GET['country']) &amp;&amp; $_GET['country'] ? $_GET['country'] : '';&#10;        $productName = isset($_GET['productName']) &amp;&amp; $_GET['productName'] ? sanitize_text_field($_GET['productName']) : '';&#10;        $dateFrom = isset($_GET['dateFrom']) &amp;&amp; $_GET['dateFrom'] ? $_GET['dateFrom'] : '';&#10;        $dateTo = isset($_GET['dateTo']) &amp;&amp; $_GET['dateTo'] ? $_GET['dateTo'] : '';&#10;&#10;        // Debug URL parameters&#10;        error_log(&quot; URL Parameters:&quot;);&#10;        error_log(&quot;  - country: &quot; . $country);&#10;        error_log(&quot;  - productName: &quot; . $productName);&#10;        if (!empty($_GET['charterType'])) error_log(&quot;  - charterType: &quot; . $_GET['charterType']);&#10;        if (!empty($_GET['person'])) error_log(&quot;  - person: &quot; . $_GET['person']);&#10;        if (!empty($_GET['cabin'])) error_log(&quot;  - cabin: &quot; . $_GET['cabin']);&#10;        if (!empty($_GET['year'])) error_log(&quot;  - year: &quot; . $_GET['year']);&#10;        if (!empty($_GET['berths'])) error_log(&quot;  - berths: &quot; . $_GET['berths']);&#10;        if (!empty($_GET['companyId'])) error_log(&quot;  - companyId: &quot; . $_GET['companyId']);&#10;&#10;        $icon = $helper-&gt;icons();&#10;&#10;        $datas = $helper-&gt;boat_filters($country, $productName, $dateFrom, $dateTo, $paged, $per_page, $filters);&#10;&#10;        ob_start();&#10;&#10;        if (!empty($datas['boats'])):&#10;&#10;            foreach ($datas['boats'] as $raw):&#10;&#10;                $data = $raw; // already decoded in boat_filters&#10;                $main_image = $data['images'][0]['url'] ?? '';&#10;&#10;                // Parse date range for URL parameters&#10;                $date_from = '';&#10;                $date_to = '';&#10;                $has_date_filter = !empty($_POST['free_yacht'] ?? '');&#10;&#10;                if ($has_date_filter) {&#10;                    $date_input = $_POST['free_yacht'];&#10;                    if (strpos($date_input, ' to ') !== false) {&#10;                        list($start_date_str, $end_date_str) = explode(' to ', $date_input);&#10;                        $date_from = date('Y-m-d', strtotime(trim($start_date_str)));&#10;                        $date_to = date('Y-m-d', strtotime(trim($end_date_str)));&#10;                    } else {&#10;                        $date_from = date('Y-m-d', strtotime($date_input));&#10;                        $date_to = date('Y-m-d', strtotime($date_input . ' +7 days'));&#10;                    }&#10;                }&#10;&#10;                // Build details URL with ALL current filter parameters for proper back navigation&#10;                $url_params = 'yachtId=' . urlencode($data['id'] ?? '');&#10;&#10;                // Add date parameters if available (ensure ISO time format)&#10;                if ($date_from &amp;&amp; $date_to) {&#10;                    // Ensure dates have proper ISO time format for API compatibility&#10;                    $formatted_date_from = $date_from;&#10;                    $formatted_date_to = $date_to;&#10;&#10;                    // Add time component if missing&#10;                    if (!empty($formatted_date_from) &amp;&amp; strpos($formatted_date_from, 'T') === false) {&#10;                        $formatted_date_from .= 'T00:00:00';&#10;                    }&#10;                    if (!empty($formatted_date_to) &amp;&amp; strpos($formatted_date_to, 'T') === false) {&#10;                        $formatted_date_to .= 'T00:00:00';&#10;                    }&#10;&#10;                    $url_params .= '&amp;dateFrom=' . urlencode($formatted_date_from) . '&amp;dateTo=' . urlencode($formatted_date_to);&#10;                }&#10;&#10;                // Include all current filter parameters so user can return to exact filter state&#10;                $current_filters = [&#10;                    'country' =&gt; $country,&#10;                    'productName' =&gt; $productName,&#10;                    'charterType' =&gt; $_GET['charterType'] ?? '',&#10;                    'person' =&gt; $_GET['person'] ?? '',&#10;                    'cabin' =&gt; $_GET['cabin'] ?? '',&#10;                    'year' =&gt; $_GET['year'] ?? '',&#10;                    'berths' =&gt; $_GET['berths'] ?? '',&#10;                    'wc' =&gt; $_GET['wc'] ?? '',&#10;                    'minLength' =&gt; $_GET['minLength'] ?? '',&#10;                    'maxLength' =&gt; $_GET['maxLength'] ?? '',&#10;                    'companyId' =&gt; $_GET['companyId'] ?? '',&#10;                    'baseFromId' =&gt; $_GET['baseFromId'] ?? '',&#10;                    'baseToId' =&gt; $_GET['baseToId'] ?? '',&#10;                    'sailingAreaId' =&gt; $_GET['sailingAreaId'] ?? '',&#10;                    'modelId' =&gt; $_GET['modelId'] ?? '',&#10;                    'flexibility' =&gt; $_GET['flexibility'] ?? '1'&#10;                ];&#10;&#10;                foreach ($current_filters as $param =&gt; $value) {&#10;                    if ($value !== '') {&#10;                        $url_params .= '&amp;' . $param . '=' . urlencode($value);&#10;                    }&#10;                }&#10;&#10;                $single_url = esc_url(site_url('/boat-details/?' . $url_params));&#10;                ?&gt;&#10;                &lt;div class=&quot;boat-list&quot;&gt;&#10;                    &lt;div class=&quot;boat-img&quot;&gt;&#10;                        &lt;a href=&quot;&lt;?php echo esc_url($main_image); ?&gt;&quot; target=&quot;_blank&quot;&gt;&#10;                            &lt;img src=&quot;&lt;?php echo esc_url($main_image); ?&gt;&quot; alt=&quot;&lt;?php echo esc_attr($data['name'] ?? ''); ?&gt;&quot;&gt;&#10;                        &lt;/a&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;boat-info&quot;&gt;&#10;                        &lt;div class=&quot;boat-title&quot;&gt;&#10;                            &lt;a href=&quot;&lt;?php echo esc_url($single_url); ?&gt;&quot; target=&quot;_blank&quot;&gt;&#10;                                &lt;?php echo esc_html($data['name'] ?? ''); ?&gt;&#10;                            &lt;/a&gt;&#10;                            &lt;?php if (!empty($data['homeBase'])): ?&gt;&#10;                                &lt;span class=&quot;boat-location&quot;&gt;&#10;                                   &lt;?php echo $icon['location']; ?&gt;  &lt;?php echo esc_html($data['homeBase']); ?&gt;&#10;                                &lt;/span&gt;&#10;                            &lt;?php endif; ?&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div class=&quot;other-title&quot;&gt;&#10;                            &lt;div class=&quot;buildyear&quot;&gt;&#10;                                &lt;?php echo $icon['model']; ?&gt;&#10;                                &lt;?php echo 'Model: ' . esc_html($data['model'] ?? 'N/A'); ?&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;div class=&quot;buildyear&quot;&gt;&#10;                                &lt;?php echo $icon['charter_type']; ?&gt;&#10;                                &lt;?php echo 'Charter Type: ' . esc_html($data['kind'] ?? 'N/A'); ?&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;div class=&quot;buildyear&quot;&gt;&#10;                                &lt;?php echo $icon['date']; ?&gt;&#10;                                &lt;?php echo 'Build Year: ' . esc_html($data['year'] ?? 'N/A'); ?&gt;&#10;                            &lt;/div&gt;&#10;                            &#10;                        &lt;/div&gt;&#10;                        &lt;div class=&quot;features&quot;&gt;&#10;                            &lt;ul&gt;&#10;                                &lt;?php if (!empty($data['maxPeopleOnBoard']) &amp;&amp; $data['maxPeopleOnBoard'] &gt; 0): ?&gt;&#10;                                    &lt;li&gt;&#10;                                        &lt;?php echo $icon['person']; ?&gt;&#10;                                        &lt;span&gt;Persons&lt;/span&gt;&#10;                                        &lt;span&gt;&lt;?php echo esc_html($data['maxPeopleOnBoard']); ?&gt;&lt;/span&gt;&#10;                                    &lt;/li&gt;&#10;                                &lt;?php endif; ?&gt;&#10;&#10;                                &lt;li&gt; &lt;?php echo $icon['cabin']; ?&gt; &lt;span&gt;Cabins&lt;/span&gt; &lt;span&gt;&lt;?php echo esc_html($data['cabins'] ?? 'N/A'); ?&gt;&lt;/span&gt;&lt;/li&gt;&#10;                                &lt;li&gt; &lt;?php echo $icon['shower']; ?&gt; &lt;span&gt;Shower&lt;/span&gt; &lt;span&gt;&lt;?php echo esc_html($data['wc'] ?? 'N/A'); ?&gt;&lt;/span&gt;&lt;/li&gt;&#10;                                &lt;li&gt; &lt;?php echo $icon['salon']; ?&gt; &lt;span&gt;Berths&lt;/span&gt; &lt;span&gt;&lt;?php echo esc_html($data['berths'] ?? 'N/A'); ?&gt;&lt;/span&gt;&lt;/li&gt;&#10;                            &lt;/ul&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;?php if (!empty($raw['availability_year'])): ?&gt;&#10;                            &lt;div class=&quot;availability-info&quot;&gt;&#10;                                &lt;strong&gt;Available Year:&lt;/strong&gt; &lt;?php echo esc_html($raw['availability_year']); ?&gt;&#10;                            &lt;/div&gt;&#10;                        &lt;?php endif; ?&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div class=&quot;boat-btn&quot;&gt;&#10;&#10;                        &lt;div class=&quot;price-info-wrap&quot;&gt;&#10;                            &lt;?php&#10;                            // Show offer price if available from API&#10;                            if (!empty($data['offer']['price'])) {&#10;                                $price = number_format($data['offer']['startPrice'], 0);&#10;//                                $currency = $data['offer']['currency'] ?? 'EUR';&#10;                                $currency = '€';&#10;&#10;                                echo '&lt;div class=&quot;price-info&quot;&gt;';&#10;                                echo '&lt;p&gt;&lt;i class=&quot;ri-money-euro-circle-line&quot; style=&quot;margin-right:4px;&quot;&gt;&lt;/i&gt;';&#10;                                echo 'Price: ' . $price . ' ' . esc_html($currency) . '&lt;/p&gt;';&#10;                                echo '&lt;/div&gt;';&#10;                            } else {&#10;                                echo '&lt;div class=&quot;price-info&quot;&gt;';&#10;                                echo '&lt;p&gt;&lt;i class=&quot;ri-money-euro-circle-line&quot; style=&quot;margin-right:4px;&quot;&gt;&lt;/i&gt;';&#10;                                echo 'Price: N/A&lt;/p&gt;';&#10;                                echo '&lt;/div&gt;';&#10;                            }&#10;                            ?&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;button class=&quot;boat-book-now&quot;&#10;                                data-id=&quot;&lt;?php echo esc_attr($data['id']); ?&gt;&quot;&#10;                                &lt;?php if ($date_from): ?&gt;data-date-from=&quot;&lt;?php echo esc_attr($date_from); ?&gt;&quot;&lt;?php endif; ?&gt;&#10;                                &lt;?php if ($date_to): ?&gt;data-date-to=&quot;&lt;?php echo esc_attr($date_to); ?&gt;&quot;&lt;?php endif; ?&gt;&#10;                        &gt;&#10;                            &lt;?php _e('Book Now', 'boat-listing'); ?&gt;&#10;                            &lt;span class=&quot;book-now-loader&quot; style=&quot;display: none;&quot;&gt;&lt;/span&gt;&#10;                        &lt;/button&gt;&#10;                        &lt;a href=&quot;&lt;?php echo $single_url; ?&gt;&quot;&gt;&#10;                            &lt;button class=&quot;boat-view&quot;&gt;&lt;?php _e('Details', 'boat-listing'); ?&gt; &lt;?php echo $icon['arrowright']; ?&gt;&lt;/button&gt;&#10;                        &lt;/a&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;?php endforeach;&#10;        else:&#10;            $message = isset($datas['message']) ? $datas['message'] : 'No boats found for your search criteria.';&#10;            echo '&lt;div class=&quot;no-boats-found&quot; style=&quot;text-align:center; padding:40px;&quot;&gt;';&#10;            echo '&lt;h3&gt; ' . $message . '&lt;/h3&gt;';&#10;        endif;&#10;    &#10;        // This shortcode for booking modal&#10;        echo do_shortcode('[book_now_modal_shortcode]');&#10;&#10;        $boats_html = ob_get_clean();&#10;&#10;        // Pagination HTML&#10;        ob_start();&#10;&#10;        error_log(&quot; Pagination Debug:&quot;);&#10;        error_log(&quot;  - Total pages: &quot; . $datas['pages']);&#10;        error_log(&quot;  - Current page: &quot; . $datas['paged']);&#10;        error_log(&quot;  - Total boats: &quot; . $datas['total']);&#10;&#10;        if ($datas['pages'] &gt; 1) {&#10;            $current = $datas['paged'];&#10;            $total_pages = $datas['pages'];&#10;&#10;            error_log(&quot;  ✅ Generating pagination HTML&quot;);&#10;            error_log(&quot;  - Current page: &quot; . $current);&#10;            error_log(&quot;  - Total pages: &quot; . $total_pages);&#10;&#10;            echo '&lt;div class=&quot;pagination&quot;&gt;';&#10;&#10;&#10;            // Previous button&#10;            if ($current &gt; 1) {&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;' . ($current - 1) . '&quot;&gt;' . $icon[&quot;arrowleft&quot;] . '&lt;/a&gt;';&#10;            }&#10;&#10;            // Simple pagination logic&#10;            $start_page = max(1, $current - 2);&#10;            $end_page = min($total_pages, $current + 2);&#10;&#10;            error_log(&quot;  - Start page: &quot; . $start_page);&#10;            error_log(&quot;  - End page: &quot; . $end_page);&#10;&#10;            // Show dots before if needed&#10;            if ($start_page &gt; 1) {&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;1&quot;&gt;1&lt;/a&gt;';&#10;                if ($start_page &gt; 2) {&#10;                    echo '&lt;span class=&quot;dots&quot;&gt;...&lt;/span&gt;';&#10;                }&#10;            }&#10;&#10;            // Show page numbers&#10;            for ($i = $start_page; $i &lt;= $end_page; $i++) {&#10;                $active_class = ($i == $current) ? ' active' : '';&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page' . $active_class . '&quot; data-page=&quot;' . $i . '&quot;&gt;' . $i . '&lt;/a&gt;';&#10;                error_log(&quot;  - Generated page: &quot; . $i . ($i == $current ? ' (active)' : ''));&#10;            }&#10;&#10;            // Show dots after if needed&#10;            if ($end_page &lt; $total_pages) {&#10;                if ($end_page &lt; $total_pages - 1) {&#10;                    echo '&lt;span class=&quot;dots&quot;&gt;...&lt;/span&gt;';&#10;                }&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;' . $total_pages . '&quot;&gt;' . $total_pages . '&lt;/a&gt;';&#10;                error_log(&quot;  - Generated last page: &quot; . $total_pages);&#10;            }&#10;&#10;            // Next button&#10;            if ($current &lt; $total_pages) {&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;' . ($current + 1) . '&quot;&gt;' . $icon[&quot;arrowright&quot;] . '&lt;/a&gt;';&#10;            }&#10;&#10;            echo '&lt;/div&gt;';&#10;        } else {&#10;            error_log(&quot;  ❌ No pagination generated - pages: &quot; . $datas['pages']);&#10;        }&#10;&#10;         $pagination_html = ob_get_clean();&#10;&#10;        // Clean any output that might have leaked&#10;        if (ob_get_level()) {&#10;            ob_clean();&#10;        }&#10;&#10;        wp_send_json_success([&#10;            'boats_html' =&gt; $boats_html,&#10;            'pagination_html' =&gt; $pagination_html,&#10;            'total_boats' =&gt; $datas['total'],&#10;            'has_date_filter' =&gt; !empty($filters['free_yacht']),&#10;            'has_prices' =&gt; !empty($datas['has_prices']),&#10;            'date_range' =&gt; $filters['free_yacht'] ?? ''&#10;        ]);&#10;&#10;        wp_die(); // Ensure clean exit&#10;    }&#10;&#10;    // New endpoint: Fetch prices asynchronously&#10;    add_action('wp_ajax_bl_get_boat_prices', 'bl_get_boat_prices');&#10;    add_action('wp_ajax_nopriv_bl_get_boat_prices', 'bl_get_boat_prices');&#10;&#10;    function bl_get_boat_prices() {&#10;        set_time_limit(300); // 5 minutes for slow API&#10;        ini_set('max_execution_time', 300);&#10;&#10;        $helper = new Boat_Listing_Helper();&#10;&#10;        $date_range = sanitize_text_field($_POST['date_range'] ?? '');&#10;        $boat_ids = isset($_POST['boat_ids']) ? array_map('sanitize_text_field', $_POST['boat_ids']) : [];&#10;&#10;        if (empty($date_range) || empty($boat_ids)) {&#10;            wp_send_json_error(['message' =&gt; 'Missing date range or boat IDs']);&#10;        }&#10;&#10;        try {&#10;            // Parse date range&#10;            if (strpos($date_range, ' to ') !== false) {&#10;                list($start_date_str, $end_date_str) = explode(' to ', $date_range);&#10;                $date_from = date('Y-m-d', strtotime(trim($start_date_str)));&#10;                $date_to = date('Y-m-d', strtotime(trim($end_date_str)));&#10;            } else {&#10;                $date_from = date('Y-m-d', strtotime($date_range));&#10;                $date_to = date('Y-m-d', strtotime($date_range . ' +7 days'));&#10;            }&#10;&#10;            error_log(&quot;Price API: Fetching prices for &quot; . count($boat_ids) . &quot; boats from $date_from to $date_to&quot;);&#10;&#10;            $price_start = microtime(true);&#10;&#10;            // Clear any previous output/errors&#10;            if (ob_get_level()) {&#10;                ob_clean();&#10;            }&#10;&#10;            $all_prices = $helper-&gt;get_all_yacht_prices_batch($date_from, $date_to);&#10;            $price_time = microtime(true) - $price_start;&#10;&#10;            error_log(&quot;Price API: Completed in &quot; . round($price_time, 2) . &quot;s&quot;);&#10;&#10;            if (empty($all_prices) || !is_array($all_prices)) {&#10;                error_log(&quot;⚠️ Price API returned empty or invalid data&quot;);&#10;                wp_send_json_error(['message' =&gt; 'No prices available', 'fetch_time' =&gt; round($price_time, 2)]);&#10;                return;&#10;            }&#10;&#10;            // Filter only requested boat IDs&#10;            $result = [];&#10;            foreach ($boat_ids as $boat_id) {&#10;                if (isset($all_prices[$boat_id])) {&#10;                    $result[$boat_id] = $all_prices[$boat_id];&#10;                }&#10;            }&#10;&#10;            wp_send_json_success([&#10;                'prices' =&gt; $result,&#10;                'fetch_time' =&gt; round($price_time, 2),&#10;                'boat_count' =&gt; count($result)&#10;            ]);&#10;&#10;        } catch (Exception $e) {&#10;            error_log(&quot;Price API Error: &quot; . $e-&gt;getMessage());&#10;            wp_send_json_error(['message' =&gt; $e-&gt;getMessage()]);&#10;        }&#10;&#10;        wp_die();&#10;    }&#10;&#10;    // Add to your functions.php or plugin file&#10;    add_action('wp_ajax_bl_clear_cache', 'bl_clear_cache_handler');&#10;    add_action('wp_ajax_nopriv_bl_clear_cache', 'bl_clear_cache_handler');&#10;&#10;    function bl_clear_cache_handler() {&#10;        $helper = new Boat_Listing_Helper();&#10;        $helper-&gt;clear_cache();&#10;        wp_send_json_success(['message' =&gt; 'Cache cleared successfully']);&#10;    }&#10;&#10;// Admin API Test Page&#10;add_action('admin_menu', function() {&#10;    add_submenu_page(&#10;        'tools.php',&#10;        'Boat API Test',&#10;        'Boat API Test',&#10;        'manage_options',&#10;        'boat-api-test',&#10;        'boat_api_test_page'&#10;    );&#10;});&#10;&#10;function boat_api_test_page() {&#10;    if (isset($_POST['run_test'])) {&#10;        $helper = new Boat_Listing_Helper();&#10;        $results = $helper-&gt;test_api();&#10;        echo '&lt;div class=&quot;notice notice-success&quot;&gt;&lt;p&gt;✅ API Test completed! Check error logs for results.&lt;/p&gt;&lt;/div&gt;';&#10;    }&#10;&#10;    ?&gt;&#10;    &lt;div class=&quot;wrap&quot;&gt;&#10;        &lt;h1&gt; Boat API Test&lt;/h1&gt;&#10;        &lt;p&gt;This will test the Booking Manager API with different parameters.&lt;/p&gt;&#10;        &lt;form method=&quot;post&quot;&gt;&#10;            &lt;input type=&quot;hidden&quot; name=&quot;run_test&quot; value=&quot;1&quot;&gt;&#10;            &lt;p class=&quot;submit&quot;&gt;&#10;                &lt;input type=&quot;submit&quot; class=&quot;button-primary&quot; value=&quot; Run API Test&quot;&gt;&#10;            &lt;/p&gt;&#10;        &lt;/form&gt;&#10;&#10;        &lt;h2&gt;Quick Test URLs:&lt;/h2&gt;&#10;        &lt;ul&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=GR&amp;productName=Bareboat&quot; target=&quot;_blank&quot;&gt; Greece + Bareboat&lt;/a&gt;&lt;/li&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=HR&amp;productName=Bareboat&quot; target=&quot;_blank&quot;&gt; Croatia + Bareboat&lt;/a&gt;&lt;/li&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=TR&amp;productName=Bareboat&quot; target=&quot;_blank&quot;&gt; Turkey + Bareboat&lt;/a&gt;&lt;/li&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=GR&quot; target=&quot;_blank&quot;&gt; Greece Only&lt;/a&gt;&lt;/li&gt;&#10;        &lt;/ul&gt;&#10;    &lt;/div&gt;&#10;    &lt;?php&#10;}&#10;&#10;" />
              <option name="updatedContent" value="&lt;?php&#10;    add_shortcode('boat_filter', 'render_boat_listing_filter');&#10;&#10;    function render_boat_listing_filter($atts, $content = null){&#10;&#10;        $helper = new Boat_Listing_Helper();&#10;        $icon = $helper-&gt;icons();&#10;        $charterTypes = $helper-&gt;fetch_category();&#10;        $preloader = $helper-&gt;bl_render_boat_overlay_preloader();&#10;        $getBoatProductTypes = $helper-&gt;getBoatProductTypes();&#10;        $data = $helper-&gt;sortPriorityCountries();&#10;        $getYears = $helper-&gt;getBoatYears();&#10;        $getCabins = $helper-&gt;getBoatCabins();&#10;        $getBoatPersons = $helper-&gt;getBoatPersons();&#10;&#10;        $regionsOrdered     = $data['regions'];&#10;        $remainingCountries = $data['countries'];&#10;&#10;        ob_start();&#10;&#10;        ?&gt;&#10;            &lt;div class=&quot;boat-listing-filter-area&quot; style=&quot;position:relative&quot;&gt;&#10;                &lt;div class=&quot;boat-lists-loader&quot;&gt;&lt;?php echo $preloader; ?&gt;&lt;/div&gt;&#10;&#10;                &lt;div class=&quot;boat-listing-filter-wraper&quot;&gt;&#10;                    &lt;div class=&quot;filter-bar-area&quot;&gt;&#10;                        &lt;div class=&quot;filter-bar&quot;&gt;&#10;                            &lt;strong&gt;&lt;?php echo $icon['filter']; ?&gt; Filter By&lt;/strong&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;charterType&quot;&gt;&lt;?php echo $icon['charter_type']; ?&gt; Charter Type&lt;/label&gt;&#10;                                &lt;select name=&quot;charterType&quot; id=&quot;charterType&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Charter Type &lt;/option&gt;&#10;                                    &lt;?php foreach ($charterTypes as $category): ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($category['name']); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($category['name']); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;!-- Date filter --&gt;&#10;                            &lt;!-- Hidden API fields --&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;dateFrom&quot; id=&quot;dateFrom&quot;&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;dateTo&quot; id=&quot;dateTo&quot;&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;dateRange&quot;&gt;&lt;?php echo $icon['date']; ?&gt; Dates &lt;/label&gt;&#10;                                &lt;input type=&quot;text&quot; id=&quot;dateRange&quot; name=&quot;dateRange&quot; placeholder=&quot;Select date range&quot; autocomplete=&quot;off&quot; class=&quot;boat-listing-input-text bl-date-range-picker&quot; /&gt;&#10;                            &lt;/div&gt;&#10;&#10;                             &lt;!-- Regions --&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;country&quot;&gt;&lt;?php echo $icon['location']; ?&gt; Destinations&lt;/label&gt;&#10;                                &lt;select name=&quot;country&quot; id=&quot;country&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;All Destinations&lt;/option&gt;&#10;                                    &lt;?php if (!empty($priorityCountries)): ?&gt;&#10;                                        &lt;optgroup label=&quot;Popular Destinations&quot;&gt;&#10;                                            &lt;?php foreach ($priorityCountries as $country): ?&gt;&#10;                                                &lt;option value=&quot;&lt;?php echo esc_attr($country['id']); ?&gt;&quot;&gt;&#10;                                                    &lt;?php echo esc_html($country['country_data']['name']); ?&gt;&#10;                                                &lt;/option&gt;&#10;                                            &lt;?php endforeach; ?&gt;&#10;                                        &lt;/optgroup&gt;&#10;                                    &lt;?php endif; ?&gt;&#10;&#10;                                    &lt;?php&#10;                                    foreach ($regionsOrdered as $region):&#10;                                        $regionId   = $region['id'];&#10;                                        $regionName = $region['regions_data']['name'] ?? 'Unknown Region';&#10;&#10;                                        $regionCountries = array_filter($remainingCountries, function ($country) use ($regionId) {&#10;                                            return ($country['country_data']['worldRegion'] ?? null) == $regionId;&#10;                                        });&#10;&#10;                                        if (!empty($regionCountries)):&#10;                                            ?&gt;&#10;                                            &lt;optgroup label=&quot;&lt;?php echo esc_html($regionName); ?&gt;&quot;&gt;&#10;                                                &lt;?php foreach ($regionCountries as $country): ?&gt;&#10;                                                    &lt;option value=&quot;&lt;?php echo esc_attr($country['country_data']['shortName']); ?&gt;&quot;&gt;&#10;                                                        − &lt;?php echo esc_html($country['country_data']['name']); ?&gt;&#10;                                                    &lt;/option&gt;&#10;                                                &lt;?php endforeach; ?&gt;&#10;                                            &lt;/optgroup&gt;&#10;                                        &lt;?php&#10;                                        endif;&#10;                                    endforeach;&#10;                                    ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;productName&quot;&gt;&lt;?php echo $icon['category']; ?&gt; Category&lt;/label&gt;&#10;                                &lt;select name=&quot;productName&quot; id=&quot;productName&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Category&lt;/option&gt;&#10;                                    &lt;?php&#10;                                    foreach ($getBoatProductTypes as $productType):&#10;                                        ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($productType); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($productType); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;!--Person filter --&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;people&quot;&gt;&lt;?php echo $icon['person']; ?&gt; Person&lt;/label&gt;&#10;                                &lt;select name=&quot;people&quot; id=&quot;people&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Person&lt;/option&gt;&#10;                                    &lt;?php foreach ($getBoatPersons as $person):&#10;                                        ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($person); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($person); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;cabin&quot;&gt;&lt;?php echo $icon['cabin']; ?&gt; Cabin&lt;/label&gt;&#10;                                &lt;select name=&quot;cabin&quot; id=&quot;cabin&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Cabin&lt;/option&gt;&#10;                                    &lt;?php foreach( $getCabins as $cabin): ?&gt;&#10;&#10;                                    &lt;option value=&quot;&lt;?php echo $cabin; ?&gt;&quot;&gt;&lt;?php echo $cabin; ?&gt;&lt;/option&gt;&#10;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;year&quot;&gt;&lt;?php echo $icon['date']; ?&gt; Build Year&lt;/label&gt;&#10;                                &lt;select name=&quot;year&quot; id=&quot;year&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Year&lt;/option&gt;&#10;                                    &lt;?php foreach ($getYears as $year):&#10;                                        ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($year); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($year); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;button id=&quot;submitFilter&quot; type=&quot;button&quot;&gt;Filter&lt;/button&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div class=&quot;contact-info&quot;&gt;&#10;                            &lt;h5 class=&quot;title&quot;&gt;&lt;?php echo $icon['headphone']; ?&gt;Help Center&lt;/h5&gt;&#10;                            &lt;p&gt;We're always just a message away&lt;/p&gt;&#10;                            &lt;div class=&quot;contact-content&quot;&gt;&#10;                                &lt;ul&gt;&#10;                                    &lt;li&gt;&lt;?php echo $icon['email_check']; ?&gt; &lt;a href=&quot;mailto:info@thebarefootparadise.com&quot;&gt;Email Us&lt;/a&gt;&lt;/li&gt;&#10;                                    &lt;li&gt;&lt;?php echo $icon['phone']; ?&gt; &lt;a href=&quot;tel:1-284-342-2387&quot;&gt;1-284-342-2387&lt;/a&gt; or &lt;a href=&quot;tel:340-201-8319&quot;&gt;340-201-8319&lt;/a&gt;&lt;/li&gt;&#10;                                    &lt;li&gt;&lt;?php echo $icon['message']; ?&gt; &lt;a href=&quot;javascript:void(0)&quot; id=&quot;boat-listing-open-hubspot-chat-box&quot;&gt;Chat with us&lt;/a&gt;&lt;/li&gt;&#10;                                &lt;/ul&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;button  class=&quot;need-help-btn filter-page-contact-us-frm&quot;&gt; Contact Us &lt;?php echo $icon['question_round']; ?&gt;&lt;/button&gt;&#10;                        &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;boat-listing-area&quot;&gt;&#10;                        &lt;div class=&quot;boat-count-and-pagination&quot;&gt;&#10;                            &lt;div id=&quot;boat-count&quot; class=&quot;boat-count-message&quot;&gt;&#10;                                &lt;!-- boat count result show here --&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;boat-listing-pagi&quot;&gt;&#10;                                &lt;!-- get boat pagination from ajax --&gt;&#10;                            &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                        &#10;                        &lt;div class=&quot;boat-lists&quot;&gt;&#10;                            &lt;!-- get boat list from ajax --&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;div class=&quot;boat-listing-pagi&quot;&gt;&#10;                            &lt;!-- get boat pagination from ajax --&gt;&#10;                        &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;&#10;        &lt;?php&#10;&#10;        $content = ob_get_clean();&#10;&#10;        return $content;&#10;    }&#10;&#10;// End Filter ======================================================&#10;    add_action('wp_ajax_bl_get_paginated_boats', 'bl_get_paginated_boats');&#10;    add_action('wp_ajax_nopriv_bl_get_paginated_boats', 'bl_get_paginated_boats');&#10;&#10;    function bl_get_paginated_boats() {&#10;&#10;        $helper = new Boat_Listing_Helper();&#10;&#10;        $paged = isset($_POST['paged']) ? max(1, intval($_POST['paged'])) : 1;&#10;        $per_page = 10;&#10;&#10;        $filters = [&#10;            'charter_type'  =&gt; sanitize_text_field($_POST['charter_type'] ?? $_GET['charterType'] ?? ''),&#10;            'model'  =&gt; sanitize_text_field($_POST['model'] ?? ''),&#10;            'company'  =&gt; sanitize_text_field($_POST['company'] ?? ''),&#10;            'location' =&gt; sanitize_text_field($_POST['location'] ?? ''),&#10;            'cabin'    =&gt; intval($_POST['cabin'] ?? $_GET['cabin'] ?? 0),&#10;            'person'    =&gt; intval($_POST['person'] ?? $_GET['person'] ?? 0),&#10;            'year'     =&gt; sanitize_text_field($_POST['year'] ?? $_GET['year'] ?? ''),&#10;            'free_yacht'     =&gt; sanitize_text_field($_POST['free_yacht'] ?? ''),&#10;            'category'     =&gt; sanitize_text_field($_POST['category'] ?? ''),&#10;&#10;            // Additional advanced filter parameters&#10;            'berths'    =&gt; intval($_GET['berths'] ?? 0),&#10;            'wc'        =&gt; intval($_GET['wc'] ?? 0),&#10;            'min_length' =&gt; floatval($_GET['minLength'] ?? 0),&#10;            'max_length' =&gt; floatval($_GET['maxLength'] ?? 0),&#10;            'company_id' =&gt; intval($_GET['companyId'] ?? 0),&#10;            'base_from_id' =&gt; intval($_GET['baseFromId'] ?? 0),&#10;            'base_to_id' =&gt; intval($_GET['baseToId'] ?? 0),&#10;            'sailing_area_id' =&gt; intval($_GET['sailingAreaId'] ?? 0),&#10;            'model_id' =&gt; intval($_GET['modelId'] ?? 0),&#10;            'flexibility' =&gt; intval($_GET['flexibility'] ?? 1),&#10;        ];&#10;&#10;        // Debug filters&#10;        error_log(&quot; AJAX Filters received (total: &quot; . count(array_filter($filters)) . &quot;):&quot;);&#10;        foreach($filters as $key =&gt; $value) {&#10;            if (!empty($value)) {&#10;                error_log(&quot;  - {$key}: {$value}&quot;);&#10;            }&#10;        }&#10;&#10;        $country = isset($_GET['country']) &amp;&amp; $_GET['country'] ? $_GET['country'] : '';&#10;        $productName = isset($_GET['productName']) &amp;&amp; $_GET['productName'] ? sanitize_text_field($_GET['productName']) : '';&#10;        $dateFrom = isset($_GET['dateFrom']) &amp;&amp; $_GET['dateFrom'] ? $_GET['dateFrom'] : '';&#10;        $dateTo = isset($_GET['dateTo']) &amp;&amp; $_GET['dateTo'] ? $_GET['dateTo'] : '';&#10;&#10;        // Debug URL parameters&#10;        error_log(&quot; URL Parameters:&quot;);&#10;        error_log(&quot;  - country: &quot; . $country);&#10;        error_log(&quot;  - productName: &quot; . $productName);&#10;        if (!empty($_GET['charterType'])) error_log(&quot;  - charterType: &quot; . $_GET['charterType']);&#10;        if (!empty($_GET['person'])) error_log(&quot;  - person: &quot; . $_GET['person']);&#10;        if (!empty($_GET['cabin'])) error_log(&quot;  - cabin: &quot; . $_GET['cabin']);&#10;        if (!empty($_GET['year'])) error_log(&quot;  - year: &quot; . $_GET['year']);&#10;        if (!empty($_GET['berths'])) error_log(&quot;  - berths: &quot; . $_GET['berths']);&#10;        if (!empty($_GET['companyId'])) error_log(&quot;  - companyId: &quot; . $_GET['companyId']);&#10;&#10;        $icon = $helper-&gt;icons();&#10;&#10;        $datas = $helper-&gt;boat_filters($country, $productName, $dateFrom, $dateTo, $paged, $per_page, $filters);&#10;&#10;        ob_start();&#10;&#10;        if (!empty($datas['boats'])):&#10;&#10;            foreach ($datas['boats'] as $raw):&#10;&#10;                $data = $raw; // already decoded in boat_filters&#10;                $main_image = $data['images'][0]['url'] ?? '';&#10;&#10;                // Parse date range for URL parameters&#10;                $date_from = '';&#10;                $date_to = '';&#10;                $has_date_filter = !empty($_POST['free_yacht'] ?? '');&#10;&#10;                if ($has_date_filter) {&#10;                    $date_input = $_POST['free_yacht'];&#10;                    if (strpos($date_input, ' to ') !== false) {&#10;                        list($start_date_str, $end_date_str) = explode(' to ', $date_input);&#10;                        $date_from = date('Y-m-d', strtotime(trim($start_date_str)));&#10;                        $date_to = date('Y-m-d', strtotime(trim($end_date_str)));&#10;                    } else {&#10;                        $date_from = date('Y-m-d', strtotime($date_input));&#10;                        $date_to = date('Y-m-d', strtotime($date_input . ' +7 days'));&#10;                    }&#10;                }&#10;&#10;                // Build details URL with ALL current filter parameters for proper back navigation&#10;                $url_params = 'yachtId=' . urlencode($data['id'] ?? '');&#10;&#10;                // Add date parameters if available (ensure ISO time format)&#10;                if ($date_from &amp;&amp; $date_to) {&#10;                    // Ensure dates have proper ISO time format for API compatibility&#10;                    $formatted_date_from = $date_from;&#10;                    $formatted_date_to = $date_to;&#10;&#10;                    // Add time component if missing&#10;                    if (!empty($formatted_date_from) &amp;&amp; strpos($formatted_date_from, 'T') === false) {&#10;                        $formatted_date_from .= 'T00:00:00';&#10;                    }&#10;                    if (!empty($formatted_date_to) &amp;&amp; strpos($formatted_date_to, 'T') === false) {&#10;                        $formatted_date_to .= 'T00:00:00';&#10;                    }&#10;&#10;                    $url_params .= '&amp;dateFrom=' . urlencode($formatted_date_from) . '&amp;dateTo=' . urlencode($formatted_date_to);&#10;                }&#10;&#10;                // Include all current filter parameters so user can return to exact filter state&#10;                $current_filters = [&#10;                    'country' =&gt; $country,&#10;                    'productName' =&gt; $productName,&#10;                    'charterType' =&gt; $_GET['charterType'] ?? '',&#10;                    'person' =&gt; $_GET['person'] ?? '',&#10;                    'cabin' =&gt; $_GET['cabin'] ?? '',&#10;                    'year' =&gt; $_GET['year'] ?? '',&#10;                    'berths' =&gt; $_GET['berths'] ?? '',&#10;                    'wc' =&gt; $_GET['wc'] ?? '',&#10;                    'minLength' =&gt; $_GET['minLength'] ?? '',&#10;                    'maxLength' =&gt; $_GET['maxLength'] ?? '',&#10;                    'companyId' =&gt; $_GET['companyId'] ?? '',&#10;                    'baseFromId' =&gt; $_GET['baseFromId'] ?? '',&#10;                    'baseToId' =&gt; $_GET['baseToId'] ?? '',&#10;                    'sailingAreaId' =&gt; $_GET['sailingAreaId'] ?? '',&#10;                    'modelId' =&gt; $_GET['modelId'] ?? '',&#10;                    'flexibility' =&gt; $_GET['flexibility'] ?? '1'&#10;                ];&#10;&#10;                foreach ($current_filters as $param =&gt; $value) {&#10;                    if ($value !== '') {&#10;                        $url_params .= '&amp;' . $param . '=' . urlencode($value);&#10;                    }&#10;                }&#10;&#10;                $single_url = esc_url(site_url('/boat-details/?' . $url_params));&#10;                ?&gt;&#10;                &lt;div class=&quot;boat-list&quot;&gt;&#10;                    &lt;div class=&quot;boat-img&quot;&gt;&#10;                        &lt;a href=&quot;&lt;?php echo esc_url($main_image); ?&gt;&quot; target=&quot;_blank&quot;&gt;&#10;                            &lt;img src=&quot;&lt;?php echo esc_url($main_image); ?&gt;&quot; alt=&quot;&lt;?php echo esc_attr($data['name'] ?? ''); ?&gt;&quot;&gt;&#10;                        &lt;/a&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;boat-info&quot;&gt;&#10;                        &lt;div class=&quot;boat-title&quot;&gt;&#10;                            &lt;a href=&quot;&lt;?php echo esc_url($single_url); ?&gt;&quot; target=&quot;_blank&quot;&gt;&#10;                                &lt;?php echo esc_html($data['name'] ?? ''); ?&gt;&#10;                            &lt;/a&gt;&#10;                            &lt;?php if (!empty($data['homeBase'])): ?&gt;&#10;                                &lt;span class=&quot;boat-location&quot;&gt;&#10;                                   &lt;?php echo $icon['location']; ?&gt;  &lt;?php echo esc_html($data['homeBase']); ?&gt;&#10;                                &lt;/span&gt;&#10;                            &lt;?php endif; ?&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div class=&quot;other-title&quot;&gt;&#10;                            &lt;div class=&quot;buildyear&quot;&gt;&#10;                                &lt;?php echo $icon['model']; ?&gt;&#10;                                &lt;?php echo 'Model: ' . esc_html($data['model'] ?? 'N/A'); ?&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;div class=&quot;buildyear&quot;&gt;&#10;                                &lt;?php echo $icon['charter_type']; ?&gt;&#10;                                &lt;?php echo 'Charter Type: ' . esc_html($data['kind'] ?? 'N/A'); ?&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;div class=&quot;buildyear&quot;&gt;&#10;                                &lt;?php echo $icon['date']; ?&gt;&#10;                                &lt;?php echo 'Build Year: ' . esc_html($data['year'] ?? 'N/A'); ?&gt;&#10;                            &lt;/div&gt;&#10;                            &#10;                        &lt;/div&gt;&#10;                        &lt;div class=&quot;features&quot;&gt;&#10;                            &lt;ul&gt;&#10;                                &lt;?php if (!empty($data['maxPeopleOnBoard']) &amp;&amp; $data['maxPeopleOnBoard'] &gt; 0): ?&gt;&#10;                                    &lt;li&gt;&#10;                                        &lt;?php echo $icon['person']; ?&gt;&#10;                                        &lt;span&gt;Persons&lt;/span&gt;&#10;                                        &lt;span&gt;&lt;?php echo esc_html($data['maxPeopleOnBoard']); ?&gt;&lt;/span&gt;&#10;                                    &lt;/li&gt;&#10;                                &lt;?php endif; ?&gt;&#10;&#10;                                &lt;li&gt; &lt;?php echo $icon['cabin']; ?&gt; &lt;span&gt;Cabins&lt;/span&gt; &lt;span&gt;&lt;?php echo esc_html($data['cabins'] ?? 'N/A'); ?&gt;&lt;/span&gt;&lt;/li&gt;&#10;                                &lt;li&gt; &lt;?php echo $icon['shower']; ?&gt; &lt;span&gt;Shower&lt;/span&gt; &lt;span&gt;&lt;?php echo esc_html($data['wc'] ?? 'N/A'); ?&gt;&lt;/span&gt;&lt;/li&gt;&#10;                                &lt;li&gt; &lt;?php echo $icon['salon']; ?&gt; &lt;span&gt;Berths&lt;/span&gt; &lt;span&gt;&lt;?php echo esc_html($data['berths'] ?? 'N/A'); ?&gt;&lt;/span&gt;&lt;/li&gt;&#10;                            &lt;/ul&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;?php if (!empty($raw['availability_year'])): ?&gt;&#10;                            &lt;div class=&quot;availability-info&quot;&gt;&#10;                                &lt;strong&gt;Available Year:&lt;/strong&gt; &lt;?php echo esc_html($raw['availability_year']); ?&gt;&#10;                            &lt;/div&gt;&#10;                        &lt;?php endif; ?&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div class=&quot;boat-btn&quot;&gt;&#10;&#10;                        &lt;div class=&quot;price-info-wrap&quot;&gt;&#10;                            &lt;?php&#10;                            // Show offer price if available from API&#10;                            if (!empty($data['offer']['price'])) {&#10;                                $price = number_format($data['offer']['startPrice'], 0);&#10;//                                $currency = $data['offer']['currency'] ?? 'EUR';&#10;                                $currency = '€';&#10;&#10;                                echo '&lt;div class=&quot;price-info&quot;&gt;';&#10;                                echo '&lt;p&gt;&lt;i class=&quot;ri-money-euro-circle-line&quot; style=&quot;margin-right:4px;&quot;&gt;&lt;/i&gt;';&#10;                                echo 'Price: ' . $price . ' ' . esc_html($currency) . '&lt;/p&gt;';&#10;                                echo '&lt;/div&gt;';&#10;                            } else {&#10;                                echo '&lt;div class=&quot;price-info&quot;&gt;';&#10;                                echo '&lt;p&gt;&lt;i class=&quot;ri-money-euro-circle-line&quot; style=&quot;margin-right:4px;&quot;&gt;&lt;/i&gt;';&#10;                                echo 'Price: N/A&lt;/p&gt;';&#10;                                echo '&lt;/div&gt;';&#10;                            }&#10;                            ?&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;button class=&quot;boat-book-now&quot;&#10;                                data-id=&quot;&lt;?php echo esc_attr($data['id']); ?&gt;&quot;&#10;                                &lt;?php if ($date_from): ?&gt;data-date-from=&quot;&lt;?php echo esc_attr($date_from); ?&gt;&quot;&lt;?php endif; ?&gt;&#10;                                &lt;?php if ($date_to): ?&gt;data-date-to=&quot;&lt;?php echo esc_attr($date_to); ?&gt;&quot;&lt;?php endif; ?&gt;&#10;                        &gt;&#10;                            &lt;?php _e('Book Now', 'boat-listing'); ?&gt;&#10;                            &lt;span class=&quot;book-now-loader&quot; style=&quot;display: none;&quot;&gt;&lt;/span&gt;&#10;                        &lt;/button&gt;&#10;                        &lt;a href=&quot;&lt;?php echo $single_url; ?&gt;&quot;&gt;&#10;                            &lt;button class=&quot;boat-view&quot;&gt;&lt;?php _e('Details', 'boat-listing'); ?&gt; &lt;?php echo $icon['arrowright']; ?&gt;&lt;/button&gt;&#10;                        &lt;/a&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;?php endforeach;&#10;        else:&#10;            $message = isset($datas['message']) ? $datas['message'] : 'No boats found for your search criteria.';&#10;            echo '&lt;div class=&quot;no-boats-found&quot; style=&quot;text-align:center; padding:40px;&quot;&gt;';&#10;            echo '&lt;h3&gt; ' . $message . '&lt;/h3&gt;';&#10;        endif;&#10;    &#10;        // This shortcode for booking modal&#10;        echo do_shortcode('[book_now_modal_shortcode]');&#10;&#10;        $boats_html = ob_get_clean();&#10;&#10;        // Pagination HTML&#10;        ob_start();&#10;&#10;        error_log(&quot; Pagination Debug:&quot;);&#10;        error_log(&quot;  - Total pages: &quot; . $datas['pages']);&#10;        error_log(&quot;  - Current page: &quot; . $datas['paged']);&#10;        error_log(&quot;  - Total boats: &quot; . $datas['total']);&#10;&#10;        if ($datas['pages'] &gt; 1) {&#10;            $current = $datas['paged'];&#10;            $total_pages = $datas['pages'];&#10;&#10;            error_log(&quot;  ✅ Generating pagination HTML&quot;);&#10;            error_log(&quot;  - Current page: &quot; . $current);&#10;            error_log(&quot;  - Total pages: &quot; . $total_pages);&#10;&#10;            echo '&lt;div class=&quot;pagination&quot;&gt;';&#10;&#10;&#10;            // Previous button&#10;            if ($current &gt; 1) {&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;' . ($current - 1) . '&quot;&gt;' . $icon[&quot;arrowleft&quot;] . '&lt;/a&gt;';&#10;            }&#10;&#10;            // Simple pagination logic&#10;            $start_page = max(1, $current - 2);&#10;            $end_page = min($total_pages, $current + 2);&#10;&#10;            error_log(&quot;  - Start page: &quot; . $start_page);&#10;            error_log(&quot;  - End page: &quot; . $end_page);&#10;&#10;            // Show dots before if needed&#10;            if ($start_page &gt; 1) {&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;1&quot;&gt;1&lt;/a&gt;';&#10;                if ($start_page &gt; 2) {&#10;                    echo '&lt;span class=&quot;dots&quot;&gt;...&lt;/span&gt;';&#10;                }&#10;            }&#10;&#10;            // Show page numbers&#10;            for ($i = $start_page; $i &lt;= $end_page; $i++) {&#10;                $active_class = ($i == $current) ? ' active' : '';&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page' . $active_class . '&quot; data-page=&quot;' . $i . '&quot;&gt;' . $i . '&lt;/a&gt;';&#10;                error_log(&quot;  - Generated page: &quot; . $i . ($i == $current ? ' (active)' : ''));&#10;            }&#10;&#10;            // Show dots after if needed&#10;            if ($end_page &lt; $total_pages) {&#10;                if ($end_page &lt; $total_pages - 1) {&#10;                    echo '&lt;span class=&quot;dots&quot;&gt;...&lt;/span&gt;';&#10;                }&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;' . $total_pages . '&quot;&gt;' . $total_pages . '&lt;/a&gt;';&#10;                error_log(&quot;  - Generated last page: &quot; . $total_pages);&#10;            }&#10;&#10;            // Next button&#10;            if ($current &lt; $total_pages) {&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;' . ($current + 1) . '&quot;&gt;' . $icon[&quot;arrowright&quot;] . '&lt;/a&gt;';&#10;            }&#10;&#10;            echo '&lt;/div&gt;';&#10;        } else {&#10;            error_log(&quot;  ❌ No pagination generated - pages: &quot; . $datas['pages']);&#10;        }&#10;&#10;         $pagination_html = ob_get_clean();&#10;&#10;        // Clean any output that might have leaked&#10;        if (ob_get_level()) {&#10;            ob_clean();&#10;        }&#10;&#10;        wp_send_json_success([&#10;            'boats_html' =&gt; $boats_html,&#10;            'pagination_html' =&gt; $pagination_html,&#10;            'total_boats' =&gt; $datas['total'],&#10;            'has_date_filter' =&gt; !empty($filters['free_yacht']),&#10;            'has_prices' =&gt; !empty($datas['has_prices']),&#10;            'date_range' =&gt; $filters['free_yacht'] ?? ''&#10;        ]);&#10;&#10;        wp_die(); // Ensure clean exit&#10;    }&#10;&#10;    // New endpoint: Fetch prices asynchronously&#10;    add_action('wp_ajax_bl_get_boat_prices', 'bl_get_boat_prices');&#10;    add_action('wp_ajax_nopriv_bl_get_boat_prices', 'bl_get_boat_prices');&#10;&#10;    function bl_get_boat_prices() {&#10;        set_time_limit(300); // 5 minutes for slow API&#10;        ini_set('max_execution_time', 300);&#10;&#10;        $helper = new Boat_Listing_Helper();&#10;&#10;        $date_range = sanitize_text_field($_POST['date_range'] ?? '');&#10;        $boat_ids = isset($_POST['boat_ids']) ? array_map('sanitize_text_field', $_POST['boat_ids']) : [];&#10;&#10;        if (empty($date_range) || empty($boat_ids)) {&#10;            wp_send_json_error(['message' =&gt; 'Missing date range or boat IDs']);&#10;        }&#10;&#10;        try {&#10;            // Parse date range&#10;            if (strpos($date_range, ' to ') !== false) {&#10;                list($start_date_str, $end_date_str) = explode(' to ', $date_range);&#10;                $date_from = date('Y-m-d', strtotime(trim($start_date_str)));&#10;                $date_to = date('Y-m-d', strtotime(trim($end_date_str)));&#10;            } else {&#10;                $date_from = date('Y-m-d', strtotime($date_range));&#10;                $date_to = date('Y-m-d', strtotime($date_range . ' +7 days'));&#10;            }&#10;&#10;            error_log(&quot;Price API: Fetching prices for &quot; . count($boat_ids) . &quot; boats from $date_from to $date_to&quot;);&#10;&#10;            $price_start = microtime(true);&#10;&#10;            // Clear any previous output/errors&#10;            if (ob_get_level()) {&#10;                ob_clean();&#10;            }&#10;&#10;            $all_prices = $helper-&gt;get_all_yacht_prices_batch($date_from, $date_to);&#10;            $price_time = microtime(true) - $price_start;&#10;&#10;            error_log(&quot;Price API: Completed in &quot; . round($price_time, 2) . &quot;s&quot;);&#10;&#10;            if (empty($all_prices) || !is_array($all_prices)) {&#10;                error_log(&quot;⚠️ Price API returned empty or invalid data&quot;);&#10;                wp_send_json_error(['message' =&gt; 'No prices available', 'fetch_time' =&gt; round($price_time, 2)]);&#10;                return;&#10;            }&#10;&#10;            // Filter only requested boat IDs&#10;            $result = [];&#10;            foreach ($boat_ids as $boat_id) {&#10;                if (isset($all_prices[$boat_id])) {&#10;                    $result[$boat_id] = $all_prices[$boat_id];&#10;                }&#10;            }&#10;&#10;            wp_send_json_success([&#10;                'prices' =&gt; $result,&#10;                'fetch_time' =&gt; round($price_time, 2),&#10;                'boat_count' =&gt; count($result)&#10;            ]);&#10;&#10;        } catch (Exception $e) {&#10;            error_log(&quot;Price API Error: &quot; . $e-&gt;getMessage());&#10;            wp_send_json_error(['message' =&gt; $e-&gt;getMessage()]);&#10;        }&#10;&#10;        wp_die();&#10;    }&#10;&#10;    // Add to your functions.php or plugin file&#10;    add_action('wp_ajax_bl_clear_cache', 'bl_clear_cache_handler');&#10;    add_action('wp_ajax_nopriv_bl_clear_cache', 'bl_clear_cache_handler');&#10;&#10;    function bl_clear_cache_handler() {&#10;        $helper = new Boat_Listing_Helper();&#10;        $helper-&gt;clear_cache();&#10;        wp_send_json_success(['message' =&gt; 'Cache cleared successfully']);&#10;    }&#10;&#10;// Admin API Test Page&#10;add_action('admin_menu', function() {&#10;    add_submenu_page(&#10;        'tools.php',&#10;        'Boat API Test',&#10;        'Boat API Test',&#10;        'manage_options',&#10;        'boat-api-test',&#10;        'boat_api_test_page'&#10;    );&#10;});&#10;&#10;function boat_api_test_page() {&#10;    if (isset($_POST['run_test'])) {&#10;        $helper = new Boat_Listing_Helper();&#10;        $results = $helper-&gt;test_api();&#10;        echo '&lt;div class=&quot;notice notice-success&quot;&gt;&lt;p&gt;✅ API Test completed! Check error logs for results.&lt;/p&gt;&lt;/div&gt;';&#10;    }&#10;&#10;    ?&gt;&#10;    &lt;div class=&quot;wrap&quot;&gt;&#10;        &lt;h1&gt; Boat API Test&lt;/h1&gt;&#10;        &lt;p&gt;This will test the Booking Manager API with different parameters.&lt;/p&gt;&#10;        &lt;form method=&quot;post&quot;&gt;&#10;            &lt;input type=&quot;hidden&quot; name=&quot;run_test&quot; value=&quot;1&quot;&gt;&#10;            &lt;p class=&quot;submit&quot;&gt;&#10;                &lt;input type=&quot;submit&quot; class=&quot;button-primary&quot; value=&quot; Run API Test&quot;&gt;&#10;            &lt;/p&gt;&#10;        &lt;/form&gt;&#10;&#10;        &lt;h2&gt;Quick Test URLs:&lt;/h2&gt;&#10;        &lt;ul&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=GR&amp;productName=Bareboat&quot; target=&quot;_blank&quot;&gt; Greece + Bareboat&lt;/a&gt;&lt;/li&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=HR&amp;productName=Bareboat&quot; target=&quot;_blank&quot;&gt; Croatia + Bareboat&lt;/a&gt;&lt;/li&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=TR&amp;productName=Bareboat&quot; target=&quot;_blank&quot;&gt; Turkey + Bareboat&lt;/a&gt;&lt;/li&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=GR&quot; target=&quot;_blank&quot;&gt; Greece Only&lt;/a&gt;&lt;/li&gt;&#10;        &lt;/ul&gt;&#10;    &lt;/div&gt;&#10;    &lt;?php&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/includes/ajax.php">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/includes/ajax.php" />
              <option name="originalContent" value="&lt;?php&#10;&#10;&#10;add_action('wp_ajax_bl_sync_boat_company', 'bl_sync_boat_company');&#10;&#10;function bl_sync_boat_company() {&#10;&#10;    //check_ajax_referer('bl_sync_nonce', 'nonce');&#10;&#10;    if (!current_user_can('manage_options')) {&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#10;    }&#10;&#10;    // Call the fetch &amp; insert function&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#10;&#10;    global $wpdb;&#10;&#10;    $results = [];&#10;&#10;    // Sync Companies&#10;    $companies_synced = Boat_Listing_Activator::insert_companies();&#10;    $results['companies'] = [&#10;        'status' =&gt; $companies_synced ? 'success' : 'failed',&#10;        'count'  =&gt; $companies_synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_companies&quot;) : 0,&#10;    ];&#10;&#10;      // Final response&#10;    wp_send_json_success([&#10;        'message' =&gt; 'Sync Successful.',&#10;        'results' =&gt; $results,&#10;    ]);&#10;&#10;}&#10;&#10;&#10;add_action('wp_ajax_bl_sync_freeyacht', 'bl_sync_freeyacht');&#10;&#10;function bl_sync_freeyacht() {&#10;&#10;    //check_ajax_referer('bl_sync_nonce', 'nonce');&#10;&#10;    if (!current_user_can('manage_options')) {&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#10;    }&#10;&#10;    // Call the fetch &amp; insert function&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#10;&#10;    global $wpdb;&#10;&#10;    $results = [];&#10;&#10;    // Sync Companies&#10;    $companies_synced = Boat_Listing_Activator::insert_freeyacht();&#10;    $results['freeyacht'] = [&#10;        'status' =&gt; $companies_synced ? 'success' : 'failed',&#10;        'count'  =&gt; $companies_synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_free&quot;) : 0,&#10;    ];&#10;&#10;      // Final response&#10;    wp_send_json_success([&#10;        'message' =&gt; 'Sync Successful.',&#10;        'results' =&gt; $results,&#10;    ]);&#10;&#10;}&#10;&#10;/**&#10; * Start Boat Sync Process&#10; */&#10;&#10;add_action('wp_ajax_bl_start_boat_sync', function () {&#10;&#10;    if (! current_user_can('manage_options')) {&#10;        wp_send_json_error();&#10;    }&#10;&#10;    //  already running? do nothing&#10;    if (get_option('bl_boat_sync_active')) {&#10;        wp_send_json_success([&#10;                'message' =&gt; 'Sync already running'&#10;        ]);&#10;    }&#10;&#10;    // ✅ just activate sync&#10;    update_option('bl_boat_sync_active', true);&#10;&#10;    if (! wp_next_scheduled('bl_boat_sync_cron')) {&#10;        wp_schedule_event(time(), 'every_minute', 'bl_boat_sync_cron');&#10;    }&#10;&#10;    wp_send_json_success([&#10;            'message' =&gt; 'Boat sync started. Background cron is running.'&#10;    ]);&#10;});&#10;&#10;&#10;/**&#10; * Sync Boat Models&#10; */&#10;&#10;add_action('wp_ajax_bl_sync_boat_models', 'bl_sync_boat_models');&#10;&#10;function bl_sync_boat_models() {&#10;&#10;&#10;    if (!current_user_can('manage_options')) {&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#10;    }&#10;&#10;    // Call the fetch &amp; insert function&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#10;&#10;    global $wpdb;&#10;&#10;    $results = [];&#10;&#10;&#10;    //Sync models&#10;    $models_synced = Boat_Listing_Activator::insert_models();&#10;    $results['models'] = [&#10;        'status' =&gt; $models_synced ? 'success' : 'failed',&#10;        'count'  =&gt; $models_synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_models&quot;) : 0,&#10;    ];&#10;&#10;      // Final response&#10;    wp_send_json_success([&#10;        'message' =&gt; 'Models Sync Successful.',&#10;        'results' =&gt; $results,&#10;    ]);&#10;&#10;}&#10;&#10;/**&#10; * Sync Boat Price Lists&#10; */&#10;&#10;add_action('wp_ajax_bl_sync_boat_price_lists', 'bl_sync_boat_price_lists');&#10;&#10;function bl_sync_boat_price_lists() {&#10;&#10;&#10;    if (!current_user_can('manage_options')) {&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#10;    }&#10;&#10;    // Call the fetch &amp; insert function&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#10;&#10;    global $wpdb;&#10;&#10;    $results = [];&#10;&#10;&#10;    //Sync models&#10;    $synced = Boat_Listing_Activator::insert_price_list();&#10;    $results['price_lists'] = [&#10;        'status' =&gt; $synced ? 'success' : 'failed',&#10;        'count'  =&gt; $synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_price_list&quot;) : 0,&#10;    ];&#10;&#10;      // Final response&#10;    wp_send_json_success([&#10;        'message' =&gt; 'Price Lists Sync Successful.',&#10;        'results' =&gt; $results,&#10;    ]);&#10;&#10;}&#10;&#10;/**&#10; * Sync Boat Category&#10; */&#10;add_action('wp_ajax_bl_sync_boat_category', 'bl_sync_boat_category');&#10;&#10;function bl_sync_boat_category() {&#10;&#10;&#10;    if (!current_user_can('manage_options')) {&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#10;    }&#10;&#10;    // Call the fetch &amp; insert function&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#10;&#10;    global $wpdb;&#10;&#10;    $results = [];&#10;&#10;     // Sync locations&#10;    $synced = Boat_Listing_Activator::insert_category();&#10;    $results['categories'] = [&#10;        'status' =&gt; $synced ? 'success' : 'failed',&#10;        'count'  =&gt; $synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_category&quot;) : 0,&#10;    ];&#10;&#10;      // Final response&#10;    wp_send_json_success([&#10;        'message' =&gt; 'Categories Sync Successful.',&#10;        'results' =&gt; $results,&#10;    ]);&#10;}&#10;&#10;&#10;/**&#10; * Sync Boat country&#10; */&#10;&#10;add_action('wp_ajax_bl_sync_boat_country', 'bl_sync_boat_country');&#10;&#10;function bl_sync_boat_country() {&#10;&#10;&#10;    if (!current_user_can('manage_options')) {&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#10;    }&#10;&#10;    // Call the fetch &amp; insert function&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#10;&#10;    global $wpdb;&#10;&#10;    $results = [];&#10;&#10;&#10;     // Sync country&#10;    $synced = Boat_Listing_Activator::insert_country();&#10;    $results['country'] = [&#10;        'status' =&gt; $synced ? 'success' : 'failed',&#10;        'count'  =&gt; $synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_country&quot;) : 0,&#10;    ];&#10;&#10;      // Final response&#10;    wp_send_json_success([&#10;        'message' =&gt; 'Countries Sync Successful.',&#10;        'results' =&gt; $results,&#10;    ]);&#10;&#10;}&#10;&#10;&#10;/**&#10; * Sync Boat country state&#10; */&#10;&#10;add_action('wp_ajax_bl_sync_boat_country_state', 'bl_sync_boat_country_state');&#10;&#10;function bl_sync_boat_country_state() {&#10;&#10;&#10;    if (!current_user_can('manage_options')) {&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#10;    }&#10;&#10;    // Call the fetch &amp; insert function&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#10;&#10;    global $wpdb;&#10;&#10;    $results = [];&#10;&#10;&#10;     // Sync country state&#10;    $synced = Boat_Listing_Activator::insert_country_state();&#10;    $results['country_state'] = [&#10;        'status' =&gt; $synced ? 'success' : 'failed',&#10;        'count'  =&gt; $synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_country_state&quot;) : 0,&#10;    ];&#10;&#10;      // Final response&#10;    wp_send_json_success([&#10;        'message' =&gt; 'Country states Sync Successful.',&#10;        'results' =&gt; $results,&#10;    ]);&#10;&#10;}&#10;&#10;/**&#10; * Sync Boat regions&#10; */&#10;&#10;add_action('wp_ajax_bl_sync_boat_regions', 'bl_sync_boat_regions');&#10;&#10;function bl_sync_boat_regions() {&#10;&#10;&#10;    if (!current_user_can('manage_options')) {&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#10;    }&#10;&#10;    // Call the fetch &amp; insert function&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#10;&#10;    global $wpdb;&#10;&#10;    $results = [];&#10;&#10;&#10;     // Sync regions&#10;    $synced = Boat_Listing_Activator::insert_regions();&#10;    $results['regions'] = [&#10;        'status' =&gt; $synced ? 'success' : 'failed',&#10;        'count'  =&gt; $synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_regions&quot;) : 0,&#10;    ];&#10;&#10;      // Final response&#10;    wp_send_json_success([&#10;        'message' =&gt; 'Regions Sync Successful.',&#10;        'results' =&gt; $results,&#10;    ]);&#10;&#10;}&#10;&#10;/**&#10; * Sync Boat Locations&#10; */&#10;&#10;add_action('wp_ajax_bl_sync_boat_locations', 'bl_sync_boat_locations');&#10;&#10;function bl_sync_boat_locations() {&#10;&#10;&#10;    if (!current_user_can('manage_options')) {&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#10;    }&#10;&#10;    // Call the fetch &amp; insert function&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#10;&#10;    global $wpdb;&#10;&#10;    $results = [];&#10;&#10;&#10;     // Sync locations&#10;    $location_synced = Boat_Listing_Activator::insert_locaitons();&#10;    $results['locations'] = [&#10;        'status' =&gt; $location_synced ? 'success' : 'failed',&#10;        'count'  =&gt; $location_synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_locations&quot;) : 0,&#10;    ];&#10;&#10;      // Final response&#10;    wp_send_json_success([&#10;        'message' =&gt; 'Locations Sync Successful.',&#10;        'results' =&gt; $results,&#10;    ]);&#10;&#10;}&#10;&#10;/**&#10; * Sync Boat boat_charterbaese&#10; */&#10;&#10;add_action('wp_ajax_bl_sync_boat_charterbase', 'bl_sync_boat_charterbase');&#10;&#10;function bl_sync_boat_charterbase() {&#10;&#10;&#10;    if (!current_user_can('manage_options')) {&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#10;    }&#10;&#10;    // Call the fetch &amp; insert function&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#10;&#10;    global $wpdb;&#10;&#10;    $results = [];&#10;&#10;&#10;    // Sync Charter Bases&#10;    $charterbase_synced = Boat_Listing_Activator::insert_charterbases();&#10;    $results['charterbases'] = [&#10;        'status' =&gt; $charterbase_synced ? 'success' : 'failed',&#10;        'count'  =&gt; $charterbase_synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_charterbaese&quot;) : 0,&#10;    ];&#10;&#10;      // Final response&#10;    wp_send_json_success([&#10;        'message' =&gt; 'charterbase Sync Successful.',&#10;        'results' =&gt; $results,&#10;    ]);&#10;&#10;}&#10;&#10;// Show booking form on modal&#10;add_action('wp_ajax_bl_load_booking_modal', 'bl_load_booking_modal');&#10;add_action('wp_ajax_nopriv_bl_load_booking_modal', 'bl_load_booking_modal');&#10;&#10;function bl_load_booking_modal() {&#10;    &#10;    $helper =  new Boat_Listing_Helper();&#10;   &#10;    $boat_id = intval($_POST['boat_id'] ?? 0);&#10;&#10;    $get_icons = $helper-&gt;icons();&#10;&#10;    $get_boat_data = $helper-&gt;fetch_all_boats( $boat_id );&#10;    $boat_name = $get_boat_data['data']['name'];&#10;    &#10;    // Use homeBase from boat data instead of non-existent fetch_all_locations method&#10;    $boat_location = $get_boat_data['data']['homeBase'] ?? 'Location N/A';&#10;&#10;    //print_r($boat_location);&#10;&#10;&#10;    if (!$boat_id) {&#10;        echo '&lt;p&gt;Invalid boat ID.&lt;/p&gt;';&#10;        wp_die();&#10;    }&#10;&#10;    ?&gt;&#10;&#10;    &lt;div class=&quot;modal-header boat-listing-modal-header&quot;&gt;&#10;        &lt;h4 class=&quot;modal-title&quot;&gt;Book  &lt;a class=&quot;boat-title&quot; target=&quot;_blank&quot; href=&quot;&lt;?php echo site_url('/boat-details/?id=' . $boat_id); ?&gt;&quot;&gt;&lt;?php echo esc_html($boat_name); ?&gt;&lt;/a&gt; In &lt;span class=&quot;boat-location&quot;&gt;&lt;?php echo $get_icons['location'] . esc_html($boat_location); ?&gt;&lt;/span&gt;&lt;/h4&gt;&#10;        &lt;span class=&quot;btn-close&quot; data-bs-dismiss=&quot;modal&quot; aria-label=&quot;Close&quot;&gt;&lt;/span&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;modal-body boat-listing-modal-body&quot;&gt;&#10;        &lt;form id=&quot;boat-booking-form&quot; class=&quot;boat-booking-form&quot; method=&quot;post&quot; novalidate&gt;&#10;&#10;            &lt;input type=&quot;hidden&quot; name=&quot;boat_id&quot; value=&quot;&lt;?php echo esc_html($boat_id) ?&gt;&quot;&gt;&#10;&#10;            &lt;div class=&quot;form-row row&quot;&gt;&#10;                &lt;div class=&quot;form-group col-12&quot;&gt;&#10;                        &lt;label for=&quot;book_date&quot;&gt;Select booking date &lt;span class=&quot;text-danger&quot;&gt;*&lt;/span&gt;&lt;/label&gt;&#10;                      &lt;input type=&quot;text&quot; id=&quot;book_date&quot; name=&quot;book_date&quot; required placeholder=&quot;Select date range&quot; autocomplete=&quot;off&quot; class=&quot;boat-listing-input-text bl-date-range-picker&quot; /&gt;&#10;                      &lt;div class=&quot;invalid-feedback&quot;&gt;Please select booking date&lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;!-- Row 1: Full Name &amp; Email --&gt;&#10;            &lt;div class=&quot;form-row row&quot;&gt;&#10;                &lt;div class=&quot;form-group col-4&quot;&gt;&#10;                    &lt;label for=&quot;full_name&quot;&gt;Full Name &lt;span class=&quot;text-danger&quot;&gt;*&lt;/span&gt;&lt;/label&gt;&#10;                    &lt;input type=&quot;text&quot; name=&quot;full_name&quot; placeholder=&quot;John Doe&quot; class=&quot;boat-listing-input-text&quot; id=&quot;full_name&quot; required /&gt;&#10;                    &lt;div class=&quot;invalid-feedback&quot;&gt;Please enter your full name&lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &lt;div class=&quot;form-group col-4&quot;&gt;&#10;                    &lt;label for=&quot;email&quot;&gt;Email Address &lt;span class=&quot;text-danger&quot;&gt;*&lt;/span&gt;&lt;/label&gt;&#10;                    &lt;input type=&quot;email&quot; name=&quot;email&quot; placeholder=&quot;example@gmail.com&quot; class=&quot;boat-listing-input-text&quot; id=&quot;email&quot; required /&gt;&#10;                    &lt;div class=&quot;invalid-feedback&quot;&gt;Please enter your valid email address&lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &lt;div class=&quot;form-group col-4&quot;&gt;&#10;                    &lt;label for=&quot;contact&quot;&gt;Contact Number &lt;span class=&quot;text-danger&quot;&gt;*&lt;/span&gt;&lt;/label&gt;&#10;                    &lt;input type=&quot;tel&quot; name=&quot;contact&quot; placeholder=&quot;+1 (310) 555-1234&quot; class=&quot;boat-listing-input-text boat-listing-format-contact&quot; id=&quot;contact&quot; required /&gt;&#10;                    &lt;div class=&quot;invalid-feedback&quot;&gt;Please enter your contact number&lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;!-- Row 2: Contact &amp; Location --&gt;&#10;            &lt;div class=&quot;form-row row&quot;&gt;&#10;                &#10;                &lt;div class=&quot;form-group col-12&quot;&gt;&#10;                    &lt;label for=&quot;address&quot;&gt;Full Address &lt;span class=&quot;text-danger&quot;&gt;*&lt;/span&gt;&lt;/label&gt;&#10;                    &lt;textarea name=&quot;address&quot; rows=&quot;3&quot; placeholder=&quot;1234 Elm Street,  Apt. 5B,  Los Angeles, CA 90001&quot; id=&quot;address&quot; class=&quot;boat-listing-input-textarea&quot; required&gt;&lt;/textarea&gt;&#10;                    &lt;div class=&quot;invalid-feedback&quot;&gt;Please enter your address&lt;/div&gt;&#10;                    &lt;!-- //&lt;input type=&quot;text&quot; name=&quot;location&quot; placeholder=&quot;Dubrovnik&quot; class=&quot;boat-listing-input-text&quot; id=&quot;location&quot; required /&gt; --&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;!-- Additional Services --&gt;&#10;            &lt;div class=&quot;form-row row&quot;&gt;&#10;                &lt;div class=&quot;form-group col-12&quot;&gt;&#10;                    &lt;label&gt;Additional Services &lt;span class=&quot;text-danger&quot;&gt;*&lt;/span&gt;&lt;/label&gt;&#10;                    &lt;select name=&quot;additional_services[]&quot; class=&quot;boat-listing-select2 boat-listing-select&quot; required multiple=&quot;multiple&quot;&gt;&#10;                        &lt;option value=&quot;Water Taxi&quot;&gt;Water Taxi&lt;/option&gt;&#10;                        &lt;option value=&quot;Center-Console Rental&quot;&gt;Center-Console Rental&lt;/option&gt;&#10;                        &lt;option value=&quot;Sub Rentals&quot;&gt;SUV rentals&lt;/option&gt;&#10;                        &lt;option value=&quot;Souvenirs&quot;&gt;Souvenirs&lt;/option&gt;&#10;                        &lt;option value=&quot;Souvenirs&quot;&gt;Concierge&lt;/option&gt;&#10;                        &lt;option value=&quot;Land Taxi (STT)&quot;&gt;Land Taxi (STT)&lt;/option&gt;&#10;                        &lt;option value=&quot;Land Taxi (BVI)&quot;&gt;Land Taxi (BVI)&lt;/option&gt;&#10;                        &lt;option value=&quot;Travel Protection&quot;&gt;Travel Protection&lt;/option&gt;&#10;                        &lt;option value=&quot;None&quot;&gt;None&lt;/option&gt;&#10;                    &lt;/select&gt;&#10;                    &lt;div class=&quot;invalid-feedback&quot;&gt;Please select minimum one service but If you don't need select &quot;None&quot; Option&lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;form-row row&quot;&gt;&#10;                &lt;div class=&quot;form-group col-12&quot;&gt;&#10;                    &lt;button type=&quot;submit&quot; class=&quot;book-now-on-popup&quot;&gt;Book Now&lt;/button&gt;&#10;                    &lt;div class=&quot;message&quot;&gt;&lt;/div&gt;&#10;                &lt;/div&gt;&#10;             &lt;/div&gt;&#10;&#10;        &lt;/form&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;?php&#10;&#10;    &#10;&#10;    wp_die();&#10;}&#10;&#10;// Insert Book reserve&#10;add_action('wp_ajax_bl_insert_book_reserve', 'bl_insert_book_reserve');&#10;add_action('wp_ajax_nopriv_bl_insert_book_reserve', 'bl_insert_book_reserve');&#10;&#10;function bl_insert_book_reserve() {&#10;    global $wpdb;&#10;&#10;    $table = $wpdb-&gt;prefix . 'boat_book_request'; // your table name&#10;&#10;    $boat_id = isset($_POST['boat_id']) ? intval($_POST['boat_id']) : 0;&#10;&#10;    parse_str($_POST['form_data'], $parsed_data);&#10;&#10;    $sanitized_data = [];&#10;    foreach ( $parsed_data as $key =&gt; $value ) {&#10;        if ( is_array( $value ) ) {&#10;            // For arrays like additional_services[]&#10;            $sanitized_data[$key] = array_map( 'sanitize_text_field', $value );&#10;        } else {&#10;            $sanitized_data[$key] = sanitize_text_field( $value );&#10;        }&#10;    }&#10;    &#10;    $json_date = wp_json_encode($sanitized_data);&#10;&#10;    if (!$boat_id || empty($json_date)) {&#10;        wp_send_json_error('Missing data');&#10;    }&#10;&#10;    $data = array(&#10;        'boat_id'      =&gt; $boat_id,&#10;        'book_data'    =&gt; $json_date,&#10;        'mail_status'    =&gt; 'pending',&#10;        'inserted_at'  =&gt; current_time('mysql')&#10;    );&#10;&#10;    $format = array('%d', '%s', '%s', '%s');&#10;&#10;    $inserted = $wpdb-&gt;insert($table, $data, $format);&#10;&#10;    if ($inserted) {&#10;        wp_send_json_success();&#10;    } else {&#10;        wp_send_json_error('DB insert failed');&#10;    }&#10;&#10;    wp_die();&#10;}" />
              <option name="updatedContent" value="&lt;?php&#13;&#10;&#13;&#10;&#13;&#10;add_action('wp_ajax_bl_sync_boat_company', 'bl_sync_boat_company');&#13;&#10;&#13;&#10;function bl_sync_boat_company() {&#13;&#10;&#13;&#10;    //check_ajax_referer('bl_sync_nonce', 'nonce');&#13;&#10;&#13;&#10;    if (!current_user_can('manage_options')) {&#13;&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#13;&#10;    }&#13;&#10;&#13;&#10;    // Call the fetch &amp; insert function&#13;&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#13;&#10;&#13;&#10;    global $wpdb;&#13;&#10;&#13;&#10;    $results = [];&#13;&#10;&#13;&#10;    // Sync Companies&#13;&#10;    $companies_synced = Boat_Listing_Activator::insert_companies();&#13;&#10;    $results['companies'] = [&#13;&#10;        'status' =&gt; $companies_synced ? 'success' : 'failed',&#13;&#10;        'count'  =&gt; $companies_synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_companies&quot;) : 0,&#13;&#10;    ];&#13;&#10;&#13;&#10;      // Final response&#13;&#10;    wp_send_json_success([&#13;&#10;        'message' =&gt; 'Sync Successful.',&#13;&#10;        'results' =&gt; $results,&#13;&#10;    ]);&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;add_action('wp_ajax_bl_sync_freeyacht', 'bl_sync_freeyacht');&#13;&#10;&#13;&#10;function bl_sync_freeyacht() {&#13;&#10;&#13;&#10;    //check_ajax_referer('bl_sync_nonce', 'nonce');&#13;&#10;&#13;&#10;    if (!current_user_can('manage_options')) {&#13;&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#13;&#10;    }&#13;&#10;&#13;&#10;    // Call the fetch &amp; insert function&#13;&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#13;&#10;&#13;&#10;    global $wpdb;&#13;&#10;&#13;&#10;    $results = [];&#13;&#10;&#13;&#10;    // Sync Companies&#13;&#10;    $companies_synced = Boat_Listing_Activator::insert_freeyacht();&#13;&#10;    $results['freeyacht'] = [&#13;&#10;        'status' =&gt; $companies_synced ? 'success' : 'failed',&#13;&#10;        'count'  =&gt; $companies_synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_free&quot;) : 0,&#13;&#10;    ];&#13;&#10;&#13;&#10;      // Final response&#13;&#10;    wp_send_json_success([&#13;&#10;        'message' =&gt; 'Sync Successful.',&#13;&#10;        'results' =&gt; $results,&#13;&#10;    ]);&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;/**&#13;&#10; * Start Boat Sync Process&#13;&#10; */&#13;&#10;&#13;&#10;add_action('wp_ajax_bl_start_boat_sync', function () {&#13;&#10;&#13;&#10;    if (! current_user_can('manage_options')) {&#13;&#10;        wp_send_json_error();&#13;&#10;    }&#13;&#10;&#13;&#10;    //  already running? do nothing&#13;&#10;    if (get_option('bl_boat_sync_active')) {&#13;&#10;        wp_send_json_success([&#13;&#10;                'message' =&gt; 'Sync already running'&#13;&#10;        ]);&#13;&#10;    }&#13;&#10;&#13;&#10;    // ✅ just activate sync&#13;&#10;    update_option('bl_boat_sync_active', true);&#13;&#10;&#13;&#10;    if (! wp_next_scheduled('bl_boat_sync_cron')) {&#13;&#10;        wp_schedule_event(time(), 'every_minute', 'bl_boat_sync_cron');&#13;&#10;    }&#13;&#10;&#13;&#10;    wp_send_json_success([&#13;&#10;            'message' =&gt; 'Boat sync started. Background cron is running.'&#13;&#10;    ]);&#13;&#10;});&#13;&#10;&#13;&#10;&#13;&#10;/**&#13;&#10; * Sync Boat Models&#13;&#10; */&#13;&#10;&#13;&#10;add_action('wp_ajax_bl_sync_boat_models', 'bl_sync_boat_models');&#13;&#10;&#13;&#10;function bl_sync_boat_models() {&#13;&#10;&#13;&#10;&#13;&#10;    if (!current_user_can('manage_options')) {&#13;&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#13;&#10;    }&#13;&#10;&#13;&#10;    // Call the fetch &amp; insert function&#13;&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#13;&#10;&#13;&#10;    global $wpdb;&#13;&#10;&#13;&#10;    $results = [];&#13;&#10;&#13;&#10;&#13;&#10;    //Sync models&#13;&#10;    $models_synced = Boat_Listing_Activator::insert_models();&#13;&#10;    $results['models'] = [&#13;&#10;        'status' =&gt; $models_synced ? 'success' : 'failed',&#13;&#10;        'count'  =&gt; $models_synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_models&quot;) : 0,&#13;&#10;    ];&#13;&#10;&#13;&#10;      // Final response&#13;&#10;    wp_send_json_success([&#13;&#10;        'message' =&gt; 'Models Sync Successful.',&#13;&#10;        'results' =&gt; $results,&#13;&#10;    ]);&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;/**&#13;&#10; * Sync Boat Price Lists&#13;&#10; */&#13;&#10;&#13;&#10;add_action('wp_ajax_bl_sync_boat_price_lists', 'bl_sync_boat_price_lists');&#13;&#10;&#13;&#10;function bl_sync_boat_price_lists() {&#13;&#10;&#13;&#10;&#13;&#10;    if (!current_user_can('manage_options')) {&#13;&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#13;&#10;    }&#13;&#10;&#13;&#10;    // Call the fetch &amp; insert function&#13;&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#13;&#10;&#13;&#10;    global $wpdb;&#13;&#10;&#13;&#10;    $results = [];&#13;&#10;&#13;&#10;&#13;&#10;    //Sync models&#13;&#10;    $synced = Boat_Listing_Activator::insert_price_list();&#13;&#10;    $results['price_lists'] = [&#13;&#10;        'status' =&gt; $synced ? 'success' : 'failed',&#13;&#10;        'count'  =&gt; $synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_price_list&quot;) : 0,&#13;&#10;    ];&#13;&#10;&#13;&#10;      // Final response&#13;&#10;    wp_send_json_success([&#13;&#10;        'message' =&gt; 'Price Lists Sync Successful.',&#13;&#10;        'results' =&gt; $results,&#13;&#10;    ]);&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;/**&#13;&#10; * Sync Boat Category&#13;&#10; */&#13;&#10;add_action('wp_ajax_bl_sync_boat_category', 'bl_sync_boat_category');&#13;&#10;&#13;&#10;function bl_sync_boat_category() {&#13;&#10;&#13;&#10;&#13;&#10;    if (!current_user_can('manage_options')) {&#13;&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#13;&#10;    }&#13;&#10;&#13;&#10;    // Call the fetch &amp; insert function&#13;&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#13;&#10;&#13;&#10;    global $wpdb;&#13;&#10;&#13;&#10;    $results = [];&#13;&#10;&#13;&#10;     // Sync locations&#13;&#10;    $synced = Boat_Listing_Activator::insert_category();&#13;&#10;    $results['categories'] = [&#13;&#10;        'status' =&gt; $synced ? 'success' : 'failed',&#13;&#10;        'count'  =&gt; $synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_category&quot;) : 0,&#13;&#10;    ];&#13;&#10;&#13;&#10;      // Final response&#13;&#10;    wp_send_json_success([&#13;&#10;        'message' =&gt; 'Categories Sync Successful.',&#13;&#10;        'results' =&gt; $results,&#13;&#10;    ]);&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;/**&#13;&#10; * Sync Boat country&#13;&#10; */&#13;&#10;&#13;&#10;add_action('wp_ajax_bl_sync_boat_country', 'bl_sync_boat_country');&#13;&#10;&#13;&#10;function bl_sync_boat_country() {&#13;&#10;&#13;&#10;&#13;&#10;    if (!current_user_can('manage_options')) {&#13;&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#13;&#10;    }&#13;&#10;&#13;&#10;    // Call the fetch &amp; insert function&#13;&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#13;&#10;&#13;&#10;    global $wpdb;&#13;&#10;&#13;&#10;    $results = [];&#13;&#10;&#13;&#10;&#13;&#10;     // Sync country&#13;&#10;    $synced = Boat_Listing_Activator::insert_country();&#13;&#10;    $results['country'] = [&#13;&#10;        'status' =&gt; $synced ? 'success' : 'failed',&#13;&#10;        'count'  =&gt; $synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_country&quot;) : 0,&#13;&#10;    ];&#13;&#10;&#13;&#10;      // Final response&#13;&#10;    wp_send_json_success([&#13;&#10;        'message' =&gt; 'Countries Sync Successful.',&#13;&#10;        'results' =&gt; $results,&#13;&#10;    ]);&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;/**&#13;&#10; * Sync Boat country state&#13;&#10; */&#13;&#10;&#13;&#10;add_action('wp_ajax_bl_sync_boat_country_state', 'bl_sync_boat_country_state');&#13;&#10;&#13;&#10;function bl_sync_boat_country_state() {&#13;&#10;&#13;&#10;&#13;&#10;    if (!current_user_can('manage_options')) {&#13;&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#13;&#10;    }&#13;&#10;&#13;&#10;    // Call the fetch &amp; insert function&#13;&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#13;&#10;&#13;&#10;    global $wpdb;&#13;&#10;&#13;&#10;    $results = [];&#13;&#10;&#13;&#10;&#13;&#10;     // Sync country state&#13;&#10;    $synced = Boat_Listing_Activator::insert_country_state();&#13;&#10;    $results['country_state'] = [&#13;&#10;        'status' =&gt; $synced ? 'success' : 'failed',&#13;&#10;        'count'  =&gt; $synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_country_state&quot;) : 0,&#13;&#10;    ];&#13;&#10;&#13;&#10;      // Final response&#13;&#10;    wp_send_json_success([&#13;&#10;        'message' =&gt; 'Country states Sync Successful.',&#13;&#10;        'results' =&gt; $results,&#13;&#10;    ]);&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;/**&#13;&#10; * Sync Boat regions&#13;&#10; */&#13;&#10;&#13;&#10;add_action('wp_ajax_bl_sync_boat_regions', 'bl_sync_boat_regions');&#13;&#10;&#13;&#10;function bl_sync_boat_regions() {&#13;&#10;&#13;&#10;&#13;&#10;    if (!current_user_can('manage_options')) {&#13;&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#13;&#10;    }&#13;&#10;&#13;&#10;    // Call the fetch &amp; insert function&#13;&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#13;&#10;&#13;&#10;    global $wpdb;&#13;&#10;&#13;&#10;    $results = [];&#13;&#10;&#13;&#10;&#13;&#10;     // Sync regions&#13;&#10;    $synced = Boat_Listing_Activator::insert_regions();&#13;&#10;    $results['regions'] = [&#13;&#10;        'status' =&gt; $synced ? 'success' : 'failed',&#13;&#10;        'count'  =&gt; $synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_regions&quot;) : 0,&#13;&#10;    ];&#13;&#10;&#13;&#10;      // Final response&#13;&#10;    wp_send_json_success([&#13;&#10;        'message' =&gt; 'Regions Sync Successful.',&#13;&#10;        'results' =&gt; $results,&#13;&#10;    ]);&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;/**&#13;&#10; * Sync Boat Locations&#13;&#10; */&#13;&#10;&#13;&#10;add_action('wp_ajax_bl_sync_boat_locations', 'bl_sync_boat_locations');&#13;&#10;&#13;&#10;function bl_sync_boat_locations() {&#13;&#10;&#13;&#10;&#13;&#10;    if (!current_user_can('manage_options')) {&#13;&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#13;&#10;    }&#13;&#10;&#13;&#10;    // Call the fetch &amp; insert function&#13;&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#13;&#10;&#13;&#10;    global $wpdb;&#13;&#10;&#13;&#10;    $results = [];&#13;&#10;&#13;&#10;&#13;&#10;     // Sync locations&#13;&#10;    $location_synced = Boat_Listing_Activator::insert_locaitons();&#13;&#10;    $results['locations'] = [&#13;&#10;        'status' =&gt; $location_synced ? 'success' : 'failed',&#13;&#10;        'count'  =&gt; $location_synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_locations&quot;) : 0,&#13;&#10;    ];&#13;&#10;&#13;&#10;      // Final response&#13;&#10;    wp_send_json_success([&#13;&#10;        'message' =&gt; 'Locations Sync Successful.',&#13;&#10;        'results' =&gt; $results,&#13;&#10;    ]);&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;/**&#13;&#10; * Sync Boat boat_charterbaese&#13;&#10; */&#13;&#10;&#13;&#10;add_action('wp_ajax_bl_sync_boat_charterbase', 'bl_sync_boat_charterbase');&#13;&#10;&#13;&#10;function bl_sync_boat_charterbase() {&#13;&#10;&#13;&#10;&#13;&#10;    if (!current_user_can('manage_options')) {&#13;&#10;        wp_send_json_error(['message' =&gt; 'Unauthorized']);&#13;&#10;    }&#13;&#10;&#13;&#10;    // Call the fetch &amp; insert function&#13;&#10;    require_once plugin_dir_path(__FILE__) . 'class-boat-listing-activator.php'; // adjust path as needed&#13;&#10;&#13;&#10;    global $wpdb;&#13;&#10;&#13;&#10;    $results = [];&#13;&#10;&#13;&#10;&#13;&#10;    // Sync Charter Bases&#13;&#10;    $charterbase_synced = Boat_Listing_Activator::insert_charterbases();&#13;&#10;    $results['charterbases'] = [&#13;&#10;        'status' =&gt; $charterbase_synced ? 'success' : 'failed',&#13;&#10;        'count'  =&gt; $charterbase_synced ? (int) $wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM {$wpdb-&gt;prefix}boat_charterbaese&quot;) : 0,&#13;&#10;    ];&#13;&#10;&#13;&#10;      // Final response&#13;&#10;    wp_send_json_success([&#13;&#10;        'message' =&gt; 'charterbase Sync Successful.',&#13;&#10;        'results' =&gt; $results,&#13;&#10;    ]);&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;// Show booking form on modal&#13;&#10;add_action('wp_ajax_bl_load_booking_modal', 'bl_load_booking_modal');&#13;&#10;add_action('wp_ajax_nopriv_bl_load_booking_modal', 'bl_load_booking_modal');&#13;&#10;&#13;&#10;function bl_load_booking_modal() {&#13;&#10;    &#13;&#10;    $helper =  new Boat_Listing_Helper();&#13;&#10;   &#13;&#10;    $boat_id = intval($_POST['boat_id'] ?? 0);&#13;&#10;&#13;&#10;    $get_icons = $helper-&gt;icons();&#13;&#10;&#13;&#10;    $get_boat_data = $helper-&gt;fetch_all_boats( $boat_id );&#10;    $boat_name = $get_boat_data['data']['name'];&#10;    &#10;    // Use homeBase from boat data instead of non-existent fetch_all_locations method&#10;    $boat_location = $get_boat_data['data']['homeBase'] ?? 'Location N/A';&#13;&#10;&#13;&#10;    //print_r($boat_location);&#13;&#10;&#13;&#10;&#13;&#10;    if (!$boat_id) {&#13;&#10;        echo '&lt;p&gt;Invalid boat ID.&lt;/p&gt;';&#13;&#10;        wp_die();&#13;&#10;    }&#13;&#10;&#13;&#10;    ?&gt;&#13;&#10;&#13;&#10;    &lt;div class=&quot;modal-header boat-listing-modal-header&quot;&gt;&#13;&#10;        &lt;h4 class=&quot;modal-title&quot;&gt;Book  &lt;a class=&quot;boat-title&quot; target=&quot;_blank&quot; href=&quot;&lt;?php echo site_url('/boat-details/?id=' . $boat_id); ?&gt;&quot;&gt;&lt;?php echo esc_html($boat_name); ?&gt;&lt;/a&gt; In &lt;span class=&quot;boat-location&quot;&gt;&lt;?php echo $get_icons['location'] . esc_html($boat_location); ?&gt;&lt;/span&gt;&lt;/h4&gt;&#13;&#10;        &lt;span class=&quot;btn-close&quot; data-bs-dismiss=&quot;modal&quot; aria-label=&quot;Close&quot;&gt;&lt;/span&gt;&#13;&#10;    &lt;/div&gt;&#13;&#10;&#13;&#10;    &lt;div class=&quot;modal-body boat-listing-modal-body&quot;&gt;&#13;&#10;        &lt;form id=&quot;boat-booking-form&quot; class=&quot;boat-booking-form&quot; method=&quot;post&quot; novalidate&gt;&#13;&#10;&#13;&#10;            &lt;input type=&quot;hidden&quot; name=&quot;boat_id&quot; value=&quot;&lt;?php echo esc_html($boat_id) ?&gt;&quot;&gt;&#13;&#10;&#13;&#10;            &lt;div class=&quot;form-row row&quot;&gt;&#13;&#10;                &lt;div class=&quot;form-group col-12&quot;&gt;&#13;&#10;                        &lt;label for=&quot;book_date&quot;&gt;Select booking date &lt;span class=&quot;text-danger&quot;&gt;*&lt;/span&gt;&lt;/label&gt;&#13;&#10;                      &lt;input type=&quot;text&quot; id=&quot;book_date&quot; name=&quot;book_date&quot; required placeholder=&quot;Select date range&quot; autocomplete=&quot;off&quot; class=&quot;boat-listing-input-text bl-date-range-picker&quot; /&gt;&#13;&#10;                      &lt;div class=&quot;invalid-feedback&quot;&gt;Please select booking date&lt;/div&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;            &lt;/div&gt;&#13;&#10;            &lt;!-- Row 1: Full Name &amp; Email --&gt;&#13;&#10;            &lt;div class=&quot;form-row row&quot;&gt;&#13;&#10;                &lt;div class=&quot;form-group col-4&quot;&gt;&#13;&#10;                    &lt;label for=&quot;full_name&quot;&gt;Full Name &lt;span class=&quot;text-danger&quot;&gt;*&lt;/span&gt;&lt;/label&gt;&#13;&#10;                    &lt;input type=&quot;text&quot; name=&quot;full_name&quot; placeholder=&quot;John Doe&quot; class=&quot;boat-listing-input-text&quot; id=&quot;full_name&quot; required /&gt;&#13;&#10;                    &lt;div class=&quot;invalid-feedback&quot;&gt;Please enter your full name&lt;/div&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;                &lt;div class=&quot;form-group col-4&quot;&gt;&#13;&#10;                    &lt;label for=&quot;email&quot;&gt;Email Address &lt;span class=&quot;text-danger&quot;&gt;*&lt;/span&gt;&lt;/label&gt;&#13;&#10;                    &lt;input type=&quot;email&quot; name=&quot;email&quot; placeholder=&quot;example@gmail.com&quot; class=&quot;boat-listing-input-text&quot; id=&quot;email&quot; required /&gt;&#13;&#10;                    &lt;div class=&quot;invalid-feedback&quot;&gt;Please enter your valid email address&lt;/div&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;                &lt;div class=&quot;form-group col-4&quot;&gt;&#13;&#10;                    &lt;label for=&quot;contact&quot;&gt;Contact Number &lt;span class=&quot;text-danger&quot;&gt;*&lt;/span&gt;&lt;/label&gt;&#13;&#10;                    &lt;input type=&quot;tel&quot; name=&quot;contact&quot; placeholder=&quot;+1 (310) 555-1234&quot; class=&quot;boat-listing-input-text boat-listing-format-contact&quot; id=&quot;contact&quot; required /&gt;&#13;&#10;                    &lt;div class=&quot;invalid-feedback&quot;&gt;Please enter your contact number&lt;/div&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;            &lt;/div&gt;&#13;&#10;&#13;&#10;            &lt;!-- Row 2: Contact &amp; Location --&gt;&#13;&#10;            &lt;div class=&quot;form-row row&quot;&gt;&#13;&#10;                &#13;&#10;                &lt;div class=&quot;form-group col-12&quot;&gt;&#13;&#10;                    &lt;label for=&quot;address&quot;&gt;Full Address &lt;span class=&quot;text-danger&quot;&gt;*&lt;/span&gt;&lt;/label&gt;&#13;&#10;                    &lt;textarea name=&quot;address&quot; rows=&quot;3&quot; placeholder=&quot;1234 Elm Street,  Apt. 5B,  Los Angeles, CA 90001&quot; id=&quot;address&quot; class=&quot;boat-listing-input-textarea&quot; required&gt;&lt;/textarea&gt;&#13;&#10;                    &lt;div class=&quot;invalid-feedback&quot;&gt;Please enter your address&lt;/div&gt;&#13;&#10;                    &lt;!-- //&lt;input type=&quot;text&quot; name=&quot;location&quot; placeholder=&quot;Dubrovnik&quot; class=&quot;boat-listing-input-text&quot; id=&quot;location&quot; required /&gt; --&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;            &lt;/div&gt;&#13;&#10;&#13;&#10;            &lt;!-- Additional Services --&gt;&#13;&#10;            &lt;div class=&quot;form-row row&quot;&gt;&#13;&#10;                &lt;div class=&quot;form-group col-12&quot;&gt;&#13;&#10;                    &lt;label&gt;Additional Services &lt;span class=&quot;text-danger&quot;&gt;*&lt;/span&gt;&lt;/label&gt;&#13;&#10;                    &lt;select name=&quot;additional_services[]&quot; class=&quot;boat-listing-select2 boat-listing-select&quot; required multiple=&quot;multiple&quot;&gt;&#13;&#10;                        &lt;option value=&quot;Water Taxi&quot;&gt;Water Taxi&lt;/option&gt;&#13;&#10;                        &lt;option value=&quot;Center-Console Rental&quot;&gt;Center-Console Rental&lt;/option&gt;&#13;&#10;                        &lt;option value=&quot;Sub Rentals&quot;&gt;SUV rentals&lt;/option&gt;&#13;&#10;                        &lt;option value=&quot;Souvenirs&quot;&gt;Souvenirs&lt;/option&gt;&#13;&#10;                        &lt;option value=&quot;Souvenirs&quot;&gt;Concierge&lt;/option&gt;&#13;&#10;                        &lt;option value=&quot;Land Taxi (STT)&quot;&gt;Land Taxi (STT)&lt;/option&gt;&#13;&#10;                        &lt;option value=&quot;Land Taxi (BVI)&quot;&gt;Land Taxi (BVI)&lt;/option&gt;&#13;&#10;                        &lt;option value=&quot;Travel Protection&quot;&gt;Travel Protection&lt;/option&gt;&#13;&#10;                        &lt;option value=&quot;None&quot;&gt;None&lt;/option&gt;&#13;&#10;                    &lt;/select&gt;&#13;&#10;                    &lt;div class=&quot;invalid-feedback&quot;&gt;Please select minimum one service but If you don't need select &quot;None&quot; Option&lt;/div&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;            &lt;/div&gt;&#13;&#10;            &#13;&#10;            &lt;div class=&quot;form-row row&quot;&gt;&#13;&#10;                &lt;div class=&quot;form-group col-12&quot;&gt;&#13;&#10;                    &lt;button type=&quot;submit&quot; class=&quot;book-now-on-popup&quot;&gt;Book Now&lt;/button&gt;&#13;&#10;                    &lt;div class=&quot;message&quot;&gt;&lt;/div&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;             &lt;/div&gt;&#13;&#10;&#13;&#10;        &lt;/form&gt;&#13;&#10;    &lt;/div&gt;&#13;&#10;&#13;&#10;    &lt;?php&#13;&#10;&#13;&#10;    &#13;&#10;&#13;&#10;    wp_die();&#13;&#10;}&#13;&#10;&#13;&#10;// Insert Book reserve&#13;&#10;add_action('wp_ajax_bl_insert_book_reserve', 'bl_insert_book_reserve');&#13;&#10;add_action('wp_ajax_nopriv_bl_insert_book_reserve', 'bl_insert_book_reserve');&#13;&#10;&#13;&#10;function bl_insert_book_reserve() {&#13;&#10;    global $wpdb;&#13;&#10;&#13;&#10;    $table = $wpdb-&gt;prefix . 'boat_book_request'; // your table name&#13;&#10;&#13;&#10;    $boat_id = isset($_POST['boat_id']) ? intval($_POST['boat_id']) : 0;&#13;&#10;&#13;&#10;    parse_str($_POST['form_data'], $parsed_data);&#13;&#10;&#13;&#10;    $sanitized_data = [];&#13;&#10;    foreach ( $parsed_data as $key =&gt; $value ) {&#13;&#10;        if ( is_array( $value ) ) {&#13;&#10;            // For arrays like additional_services[]&#13;&#10;            $sanitized_data[$key] = array_map( 'sanitize_text_field', $value );&#13;&#10;        } else {&#13;&#10;            $sanitized_data[$key] = sanitize_text_field( $value );&#13;&#10;        }&#13;&#10;    }&#13;&#10;    &#13;&#10;    $json_date = wp_json_encode($sanitized_data);&#13;&#10;&#13;&#10;    if (!$boat_id || empty($json_date)) {&#13;&#10;        wp_send_json_error('Missing data');&#13;&#10;    }&#13;&#10;&#13;&#10;    $data = array(&#13;&#10;        'boat_id'      =&gt; $boat_id,&#13;&#10;        'book_data'    =&gt; $json_date,&#13;&#10;        'mail_status'    =&gt; 'pending',&#13;&#10;        'inserted_at'  =&gt; current_time('mysql')&#13;&#10;    );&#13;&#10;&#13;&#10;    $format = array('%d', '%s', '%s', '%s');&#13;&#10;&#13;&#10;    $inserted = $wpdb-&gt;insert($table, $data, $format);&#13;&#10;&#13;&#10;    if ($inserted) {&#13;&#10;        wp_send_json_success();&#13;&#10;    } else {&#13;&#10;        wp_send_json_error('DB insert failed');&#13;&#10;    }&#13;&#10;&#13;&#10;    wp_die();&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>