<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/boat-listing/boat-listing-filters.php">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/boat-listing/boat-listing-filters.php" />
              <option name="originalContent" value="&lt;?php&#10;    add_shortcode('boat_filter', 'render_boat_listing_filter');&#10;&#10;    function render_boat_listing_filter($atts, $content = null){&#10;&#10;        $helper = new Boat_Listing_Helper();&#10;        $icon = $helper-&gt;icons();&#10;        $charterTypes = $helper-&gt;fetch_category();&#10;        $preloader = $helper-&gt;bl_render_boat_overlay_preloader();&#10;        $getBoatProductTypes = $helper-&gt;getBoatProductTypes();&#10;        $data = $helper-&gt;sortPriorityCountries();&#10;        $getYears = $helper-&gt;getBoatYears();&#10;        $getCabins = $helper-&gt;getBoatCabins();&#10;        $getBoatPersons = $helper-&gt;getBoatPersons();&#10;&#10;        $regionsOrdered     = $data['regions'];&#10;        $remainingCountries = $data['countries'];&#10;&#10;        ob_start();&#10;&#10;        ?&gt;&#10;            &lt;div class=&quot;boat-listing-filter-area&quot; style=&quot;position:relative&quot;&gt;&#10;                &lt;div class=&quot;boat-lists-loader&quot;&gt;&lt;?php echo $preloader; ?&gt;&lt;/div&gt;&#10;&#10;                &lt;div class=&quot;boat-listing-filter-wraper&quot;&gt;&#10;                    &lt;div class=&quot;filter-bar-area&quot;&gt;&#10;                        &lt;div class=&quot;filter-bar&quot;&gt;&#10;                            &lt;strong&gt;&lt;?php echo $icon['filter']; ?&gt; Filter By&lt;/strong&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;charterType&quot;&gt;&lt;?php echo $icon['charter_type']; ?&gt; Charter Type&lt;/label&gt;&#10;                                &lt;select name=&quot;charterType&quot; id=&quot;charterType&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Charter Type &lt;/option&gt;&#10;                                    &lt;?php foreach ($charterTypes as $category): ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($category['name']); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($category['name']); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;!-- Date filter --&gt;&#10;                            &lt;!-- Hidden API fields --&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;dateFrom&quot; id=&quot;dateFrom&quot;&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;dateTo&quot; id=&quot;dateTo&quot;&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;dateRange&quot;&gt;&lt;?php echo $icon['date']; ?&gt; Dates &lt;/label&gt;&#10;                                &lt;input type=&quot;text&quot; id=&quot;dateRange&quot; name=&quot;dateRange&quot; placeholder=&quot;Select date range&quot; autocomplete=&quot;off&quot; class=&quot;boat-listing-input-text bl-date-range-picker&quot; /&gt;&#10;                            &lt;/div&gt;&#10;&#10;                             &lt;!-- Regions --&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;country&quot;&gt;&lt;?php echo $icon['location']; ?&gt; Destinations&lt;/label&gt;&#10;                                &lt;select name=&quot;country&quot; id=&quot;country&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;All Destinations&lt;/option&gt;&#10;                                    &lt;?php if (!empty($priorityCountries)): ?&gt;&#10;                                        &lt;optgroup label=&quot;Popular Destinations&quot;&gt;&#10;                                            &lt;?php foreach ($priorityCountries as $country): ?&gt;&#10;                                                &lt;option value=&quot;&lt;?php echo esc_attr($country['id']); ?&gt;&quot;&gt;&#10;                                                    &lt;?php echo esc_html($country['country_data']['name']); ?&gt;&#10;                                                &lt;/option&gt;&#10;                                            &lt;?php endforeach; ?&gt;&#10;                                        &lt;/optgroup&gt;&#10;                                    &lt;?php endif; ?&gt;&#10;&#10;                                    &lt;?php&#10;                                    foreach ($regionsOrdered as $region):&#10;                                        $regionId   = $region['id'];&#10;                                        $regionName = $region['regions_data']['name'] ?? 'Unknown Region';&#10;&#10;                                        $regionCountries = array_filter($remainingCountries, function ($country) use ($regionId) {&#10;                                            return ($country['country_data']['worldRegion'] ?? null) == $regionId;&#10;                                        });&#10;&#10;                                        if (!empty($regionCountries)):&#10;                                            ?&gt;&#10;                                            &lt;optgroup label=&quot;&lt;?php echo esc_html($regionName); ?&gt;&quot;&gt;&#10;                                                &lt;?php foreach ($regionCountries as $country): ?&gt;&#10;                                                    &lt;option value=&quot;&lt;?php echo esc_attr($country['country_data']['shortName']); ?&gt;&quot;&gt;&#10;                                                        − &lt;?php echo esc_html($country['country_data']['name']); ?&gt;&#10;                                                    &lt;/option&gt;&#10;                                                &lt;?php endforeach; ?&gt;&#10;                                            &lt;/optgroup&gt;&#10;                                        &lt;?php&#10;                                        endif;&#10;                                    endforeach;&#10;                                    ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;productName&quot;&gt;&lt;?php echo $icon['category']; ?&gt; Category&lt;/label&gt;&#10;                                &lt;select name=&quot;productName&quot; id=&quot;productName&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Category&lt;/option&gt;&#10;                                    &lt;?php&#10;                                    foreach ($getBoatProductTypes as $productType):&#10;                                        ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($productType); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($productType); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;!--Person filter --&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;people&quot;&gt;&lt;?php echo $icon['person']; ?&gt; Person&lt;/label&gt;&#10;                                &lt;select name=&quot;people&quot; id=&quot;people&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Person&lt;/option&gt;&#10;                                    &lt;?php foreach ($getBoatPersons as $person):&#10;                                        ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($person); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($person); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;cabin&quot;&gt;&lt;?php echo $icon['cabin']; ?&gt; Cabin&lt;/label&gt;&#10;                                &lt;select name=&quot;cabin&quot; id=&quot;cabin&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Cabin&lt;/option&gt;&#10;                                    &lt;?php foreach( $getCabins as $cabin): ?&gt;&#10;&#10;                                    &lt;option value=&quot;&lt;?php echo $cabin; ?&gt;&quot;&gt;&lt;?php echo $cabin; ?&gt;&lt;/option&gt;&#10;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;year&quot;&gt;&lt;?php echo $icon['date']; ?&gt; Build Year&lt;/label&gt;&#10;                                &lt;select name=&quot;year&quot; id=&quot;year&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Year&lt;/option&gt;&#10;                                    &lt;?php foreach ($getYears as $year):&#10;                                        ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($year); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($year); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;button id=&quot;submitFilter&quot; type=&quot;button&quot;&gt;Filter&lt;/button&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div class=&quot;contact-info&quot;&gt;&#10;                            &lt;h5 class=&quot;title&quot;&gt;&lt;?php echo $icon['headphone']; ?&gt;Help Center&lt;/h5&gt;&#10;                            &lt;p&gt;We're always just a message away&lt;/p&gt;&#10;                            &lt;div class=&quot;contact-content&quot;&gt;&#10;                                &lt;ul&gt;&#10;                                    &lt;li&gt;&lt;?php echo $icon['email_check']; ?&gt; &lt;a href=&quot;mailto:info@thebarefootparadise.com&quot;&gt;Email Us&lt;/a&gt;&lt;/li&gt;&#10;                                    &lt;li&gt;&lt;?php echo $icon['phone']; ?&gt; &lt;a href=&quot;tel:1-284-342-2387&quot;&gt;1-284-342-2387&lt;/a&gt; or &lt;a href=&quot;tel:340-201-8319&quot;&gt;340-201-8319&lt;/a&gt;&lt;/li&gt;&#10;                                    &lt;li&gt;&lt;?php echo $icon['message']; ?&gt; &lt;a href=&quot;javascript:void(0)&quot; id=&quot;boat-listing-open-hubspot-chat-box&quot;&gt;Chat with us&lt;/a&gt;&lt;/li&gt;&#10;                                &lt;/ul&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;button  class=&quot;need-help-btn filter-page-contact-us-frm&quot;&gt; Contact Us &lt;?php echo $icon['question_round']; ?&gt;&lt;/button&gt;&#10;                        &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;boat-listing-area&quot;&gt;&#10;                        &lt;div class=&quot;boat-count-and-pagination&quot;&gt;&#10;                            &lt;div id=&quot;boat-count&quot; class=&quot;boat-count-message&quot;&gt;&#10;                                &lt;!-- boat count result show here --&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;boat-listing-pagi&quot;&gt;&#10;                                &lt;!-- get boat pagination from ajax --&gt;&#10;                            &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                        &#10;                        &lt;div class=&quot;boat-lists&quot;&gt;&#10;                            &lt;!-- get boat list from ajax --&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;div class=&quot;boat-listing-pagi&quot;&gt;&#10;                            &lt;!-- get boat pagination from ajax --&gt;&#10;                        &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;&#10;        &lt;?php&#10;&#10;        $content = ob_get_clean();&#10;&#10;        return $content;&#10;    }&#10;&#10;// End Filter ======================================================&#10;    add_action('wp_ajax_bl_get_paginated_boats', 'bl_get_paginated_boats');&#10;    add_action('wp_ajax_nopriv_bl_get_paginated_boats', 'bl_get_paginated_boats');&#10;&#10;    function bl_get_paginated_boats() {&#10;&#10;        $helper = new Boat_Listing_Helper();&#10;&#10;        $paged = isset($_POST['paged']) ? max(1, intval($_POST['paged'])) : 1;&#10;        $per_page = 10;&#10;&#10;        $filters = [&#10;            'charter_type'  =&gt; sanitize_text_field($_POST['charter_type'] ?? $_GET['charterType'] ?? ''),&#10;            'model'  =&gt; sanitize_text_field($_POST['model'] ?? ''),&#10;            'company'  =&gt; sanitize_text_field($_POST['company'] ?? ''),&#10;            'location' =&gt; sanitize_text_field($_POST['location'] ?? ''),&#10;            'cabin'    =&gt; intval($_POST['cabin'] ?? $_GET['cabin'] ?? 0),&#10;            'person'    =&gt; intval($_POST['person'] ?? $_GET['person'] ?? 0),&#10;            'year'     =&gt; sanitize_text_field($_POST['year'] ?? $_GET['year'] ?? ''),&#10;            'free_yacht'     =&gt; sanitize_text_field($_POST['free_yacht'] ?? ''),&#10;            'category'     =&gt; sanitize_text_field($_POST['category'] ?? ''),&#10;&#10;            // Additional advanced filter parameters&#10;            'berths'    =&gt; intval($_GET['berths'] ?? 0),&#10;            'wc'        =&gt; intval($_GET['wc'] ?? 0),&#10;            'min_length' =&gt; floatval($_GET['minLength'] ?? 0),&#10;            'max_length' =&gt; floatval($_GET['maxLength'] ?? 0),&#10;            'company_id' =&gt; intval($_GET['companyId'] ?? 0),&#10;            'base_from_id' =&gt; intval($_GET['baseFromId'] ?? 0),&#10;            'base_to_id' =&gt; intval($_GET['baseToId'] ?? 0),&#10;            'sailing_area_id' =&gt; intval($_GET['sailingAreaId'] ?? 0),&#10;            'model_id' =&gt; intval($_GET['modelId'] ?? 0),&#10;            'flexibility' =&gt; intval($_GET['flexibility'] ?? 1),&#10;        ];&#10;&#10;        // Debug filters&#10;        error_log(&quot; AJAX Filters received (total: &quot; . count(array_filter($filters)) . &quot;):&quot;);&#10;        foreach($filters as $key =&gt; $value) {&#10;            if (!empty($value)) {&#10;                error_log(&quot;  - {$key}: {$value}&quot;);&#10;            }&#10;        }&#10;&#10;        $country = isset($_GET['country']) &amp;&amp; $_GET['country'] ? $_GET['country'] : '';&#10;        $productName = isset($_GET['productName']) &amp;&amp; $_GET['productName'] ? sanitize_text_field($_GET['productName']) : '';&#10;        $dateFrom = isset($_GET['dateFrom']) &amp;&amp; $_GET['dateFrom'] ? $_GET['dateFrom'] : '';&#10;        $dateTo = isset($_GET['dateTo']) &amp;&amp; $_GET['dateTo'] ? $_GET['dateTo'] : '';&#10;&#10;        // Debug URL parameters&#10;        error_log(&quot; URL Parameters:&quot;);&#10;        error_log(&quot;  - country: &quot; . $country);&#10;        error_log(&quot;  - productName: &quot; . $productName);&#10;        if (!empty($_GET['charterType'])) error_log(&quot;  - charterType: &quot; . $_GET['charterType']);&#10;        if (!empty($_GET['person'])) error_log(&quot;  - person: &quot; . $_GET['person']);&#10;        if (!empty($_GET['cabin'])) error_log(&quot;  - cabin: &quot; . $_GET['cabin']);&#10;        if (!empty($_GET['year'])) error_log(&quot;  - year: &quot; . $_GET['year']);&#10;        if (!empty($_GET['berths'])) error_log(&quot;  - berths: &quot; . $_GET['berths']);&#10;        if (!empty($_GET['companyId'])) error_log(&quot;  - companyId: &quot; . $_GET['companyId']);&#10;&#10;        $icon = $helper-&gt;icons();&#10;&#10;        $datas = $helper-&gt;boat_filters($country, $productName, $dateFrom, $dateTo, $paged, $per_page, $filters);&#10;&#10;        ob_start();&#10;&#10;        if (!empty($datas['boats'])):&#10;&#10;            foreach ($datas['boats'] as $raw):&#10;&#10;                $data = $raw; // already decoded in boat_filters&#10;                $main_image = $data['images'][0]['url'] ?? '';&#10;&#10;                // Parse date range for URL parameters&#10;                $date_from = '';&#10;                $date_to = '';&#10;                $has_date_filter = !empty($_POST['free_yacht'] ?? '');&#10;&#10;                if ($has_date_filter) {&#10;                    $date_input = $_POST['free_yacht'];&#10;                    if (strpos($date_input, ' to ') !== false) {&#10;                        list($start_date_str, $end_date_str) = explode(' to ', $date_input);&#10;                        $date_from = date('Y-m-d', strtotime(trim($start_date_str)));&#10;                        $date_to = date('Y-m-d', strtotime(trim($end_date_str)));&#10;                    } else {&#10;                        $date_from = date('Y-m-d', strtotime($date_input));&#10;                        $date_to = date('Y-m-d', strtotime($date_input . ' +7 days'));&#10;                    }&#10;                }&#10;&#10;                // Build details URL with ALL current filter parameters for proper back navigation&#10;                $url_params = 'id=' . urlencode($data['id'] ?? '');&#10;&#10;                // Add date parameters if available (ensure ISO time format)&#10;                if ($date_from &amp;&amp; $date_to) {&#10;                    // Ensure dates have proper ISO time format for API compatibility&#10;                    $formatted_date_from = $date_from;&#10;                    $formatted_date_to = $date_to;&#10;                    &#10;                    // Add time component if missing&#10;                    if (!empty($formatted_date_from) &amp;&amp; strpos($formatted_date_from, 'T') === false) {&#10;                        $formatted_date_from .= 'T00:00:00';&#10;                    }&#10;                    if (!empty($formatted_date_to) &amp;&amp; strpos($formatted_date_to, 'T') === false) {&#10;                        $formatted_date_to .= 'T00:00:00';&#10;                    }&#10;                    &#10;                    $url_params .= '&amp;dateFrom=' . urlencode($formatted_date_from) . '&amp;dateTo=' . urlencode($formatted_date_to);&#10;                }&#10;&#10;                // Include all current filter parameters so user can return to exact filter state&#10;                $current_filters = [&#10;                    'country' =&gt; $country,&#10;                    'productName' =&gt; $productName,&#10;                    'charterType' =&gt; $_GET['charterType'] ?? '',&#10;                    'person' =&gt; $_GET['person'] ?? '',&#10;                    'cabin' =&gt; $_GET['cabin'] ?? '',&#10;                    'year' =&gt; $_GET['year'] ?? '',&#10;                    'berths' =&gt; $_GET['berths'] ?? '',&#10;                    'wc' =&gt; $_GET['wc'] ?? '',&#10;                    'minLength' =&gt; $_GET['minLength'] ?? '',&#10;                    'maxLength' =&gt; $_GET['maxLength'] ?? '',&#10;                    'companyId' =&gt; $_GET['companyId'] ?? '',&#10;                    'baseFromId' =&gt; $_GET['baseFromId'] ?? '',&#10;                    'baseToId' =&gt; $_GET['baseToId'] ?? '',&#10;                    'sailingAreaId' =&gt; $_GET['sailingAreaId'] ?? '',&#10;                    'modelId' =&gt; $_GET['modelId'] ?? '',&#10;                    'flexibility' =&gt; $_GET['flexibility'] ?? '1'&#10;                ];&#10;&#10;                foreach ($current_filters as $param =&gt; $value) {&#10;                    if ($value !== '') {&#10;                        $url_params .= '&amp;' . $param . '=' . urlencode($value);&#10;                    }&#10;                }&#10;&#10;                $single_url = esc_url(site_url('/boat-details/?' . $url_params));&#10;                ?&gt;&#10;                &lt;div class=&quot;boat-list&quot;&gt;&#10;                    &lt;div class=&quot;boat-img&quot;&gt;&#10;                        &lt;a href=&quot;&lt;?php echo esc_url($main_image); ?&gt;&quot; target=&quot;_blank&quot;&gt;&#10;                            &lt;img src=&quot;&lt;?php echo esc_url($main_image); ?&gt;&quot; alt=&quot;&lt;?php echo esc_attr($data['name'] ?? ''); ?&gt;&quot;&gt;&#10;                        &lt;/a&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;boat-info&quot;&gt;&#10;                        &lt;div class=&quot;boat-title&quot;&gt;&#10;                            &lt;a href=&quot;&lt;?php echo esc_url($single_url); ?&gt;&quot; target=&quot;_blank&quot;&gt;&#10;                                &lt;?php echo esc_html($data['name'] ?? ''); ?&gt;&#10;                            &lt;/a&gt;&#10;                            &lt;?php if (!empty($data['homeBase'])): ?&gt;&#10;                                &lt;span class=&quot;boat-location&quot;&gt;&#10;                                   &lt;?php echo $icon['location']; ?&gt;  &lt;?php echo esc_html($data['homeBase']); ?&gt;&#10;                                &lt;/span&gt;&#10;                            &lt;?php endif; ?&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div class=&quot;other-title&quot;&gt;&#10;                            &lt;div class=&quot;buildyear&quot;&gt;&#10;                                &lt;?php echo $icon['model']; ?&gt;&#10;                                &lt;?php echo 'Model: ' . esc_html($data['model'] ?? 'N/A'); ?&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;div class=&quot;buildyear&quot;&gt;&#10;                                &lt;?php echo $icon['charter_type']; ?&gt;&#10;                                &lt;?php echo 'Charter Type: ' . esc_html($data['kind'] ?? 'N/A'); ?&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;div class=&quot;buildyear&quot;&gt;&#10;                                &lt;?php echo $icon['date']; ?&gt;&#10;                                &lt;?php echo 'Build Year: ' . esc_html($data['year'] ?? 'N/A'); ?&gt;&#10;                            &lt;/div&gt;&#10;                            &#10;                        &lt;/div&gt;&#10;                        &lt;div class=&quot;features&quot;&gt;&#10;                            &lt;ul&gt;&#10;                                &lt;?php if (!empty($data['maxPeopleOnBoard']) &amp;&amp; $data['maxPeopleOnBoard'] &gt; 0): ?&gt;&#10;                                    &lt;li&gt;&#10;                                        &lt;?php echo $icon['person']; ?&gt;&#10;                                        &lt;span&gt;Persons&lt;/span&gt;&#10;                                        &lt;span&gt;&lt;?php echo esc_html($data['maxPeopleOnBoard']); ?&gt;&lt;/span&gt;&#10;                                    &lt;/li&gt;&#10;                                &lt;?php endif; ?&gt;&#10;&#10;                                &lt;li&gt; &lt;?php echo $icon['cabin']; ?&gt; &lt;span&gt;Cabins&lt;/span&gt; &lt;span&gt;&lt;?php echo esc_html($data['cabins'] ?? 'N/A'); ?&gt;&lt;/span&gt;&lt;/li&gt;&#10;                                &lt;li&gt; &lt;?php echo $icon['shower']; ?&gt; &lt;span&gt;Shower&lt;/span&gt; &lt;span&gt;&lt;?php echo esc_html($data['wc'] ?? 'N/A'); ?&gt;&lt;/span&gt;&lt;/li&gt;&#10;                                &lt;li&gt; &lt;?php echo $icon['salon']; ?&gt; &lt;span&gt;Berths&lt;/span&gt; &lt;span&gt;&lt;?php echo esc_html($data['berths'] ?? 'N/A'); ?&gt;&lt;/span&gt;&lt;/li&gt;&#10;                            &lt;/ul&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;?php if (!empty($raw['availability_year'])): ?&gt;&#10;                            &lt;div class=&quot;availability-info&quot;&gt;&#10;                                &lt;strong&gt;Available Year:&lt;/strong&gt; &lt;?php echo esc_html($raw['availability_year']); ?&gt;&#10;                            &lt;/div&gt;&#10;                        &lt;?php endif; ?&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div class=&quot;boat-btn&quot;&gt;&#10;&#10;                        &lt;div class=&quot;price-info-wrap&quot;&gt;&#10;                            &lt;?php&#10;                            // Show offer price if available from API&#10;                            if (!empty($data['offer']['price'])) {&#10;                                $price = number_format($data['offer']['price'], 0);&#10;                                $currency = $data['offer']['currency'] ?? 'EUR';&#10;&#10;                                echo '&lt;div class=&quot;price-info&quot;&gt;';&#10;                                echo '&lt;p&gt;&lt;i class=&quot;ri-money-euro-circle-line&quot; style=&quot;margin-right:4px;&quot;&gt;&lt;/i&gt;';&#10;                                echo 'Price: ' . $price . ' ' . esc_html($currency) . '&lt;/p&gt;';&#10;                                echo '&lt;/div&gt;';&#10;                            } else {&#10;                                echo '&lt;div class=&quot;price-info price-info--hint&quot;&gt;';&#10;                                echo '&lt;p&gt; Select dates to see prices&lt;/p&gt;';&#10;                                echo '&lt;/div&gt;';&#10;                            }&#10;                            ?&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;button class=&quot;boat-book-now&quot;&#10;                                data-id=&quot;&lt;?php echo esc_attr($data['id']); ?&gt;&quot;&#10;                                &lt;?php if ($date_from): ?&gt;data-date-from=&quot;&lt;?php echo esc_attr($date_from); ?&gt;&quot;&lt;?php endif; ?&gt;&#10;                                &lt;?php if ($date_to): ?&gt;data-date-to=&quot;&lt;?php echo esc_attr($date_to); ?&gt;&quot;&lt;?php endif; ?&gt;&#10;                        &gt;&#10;                            &lt;?php _e('Book Now', 'boat-listing'); ?&gt;&#10;                            &lt;span class=&quot;book-now-loader&quot; style=&quot;display: none;&quot;&gt;&lt;/span&gt;&#10;                        &lt;/button&gt;&#10;                        &lt;a href=&quot;&lt;?php echo $single_url; ?&gt;&quot;&gt;&#10;                            &lt;button class=&quot;boat-view&quot;&gt;&lt;?php _e('Details', 'boat-listing'); ?&gt; &lt;?php echo $icon['arrowright']; ?&gt;&lt;/button&gt;&#10;                        &lt;/a&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;?php endforeach;&#10;        else:&#10;            $message = isset($datas['message']) ? $datas['message'] : 'No boats found for your search criteria.';&#10;            echo '&lt;div class=&quot;no-boats-found&quot; style=&quot;text-align:center; padding:40px;&quot;&gt;';&#10;            echo '&lt;h3&gt; ' . $message . '&lt;/h3&gt;';&#10;            echo '&lt;p&gt;&lt;strong&gt;Try these suggestions:&lt;/strong&gt;&lt;/p&gt;';&#10;            echo '&lt;ul style=&quot;text-align:left; display:inline-block;&quot;&gt;';&#10;            echo '&lt;li&gt; Select a different destination (Greece, Croatia, Turkey are popular)&lt;/li&gt;';&#10;            echo '&lt;li&gt; Try different dates (summer months have more availability)&lt;/li&gt;';&#10;            echo '&lt;li&gt;⛵ Choose &quot;Bareboat&quot; or &quot;Crewed&quot; category&lt;/li&gt;';&#10;            echo '&lt;li&gt; Remove date filters to see all available boats&lt;/li&gt;';&#10;            echo '&lt;/ul&gt;';&#10;            echo '&lt;/div&gt;';&#10;        endif;&#10;    &#10;        // This shortcode for booking modal&#10;        echo do_shortcode('[book_now_modal_shortcode]');&#10;&#10;        $boats_html = ob_get_clean();&#10;&#10;        // Pagination HTML&#10;        ob_start();&#10;&#10;        error_log(&quot; Pagination Debug:&quot;);&#10;        error_log(&quot;  - Total pages: &quot; . $datas['pages']);&#10;        error_log(&quot;  - Current page: &quot; . $datas['paged']);&#10;        error_log(&quot;  - Total boats: &quot; . $datas['total']);&#10;&#10;        if ($datas['pages'] &gt; 1) {&#10;            $current = $datas['paged'];&#10;            $total_pages = $datas['pages'];&#10;&#10;            error_log(&quot;  ✅ Generating pagination HTML&quot;);&#10;            error_log(&quot;  - Current page: &quot; . $current);&#10;            error_log(&quot;  - Total pages: &quot; . $total_pages);&#10;&#10;            echo '&lt;div class=&quot;pagination&quot;&gt;';&#10;&#10;&#10;            // Previous button&#10;            if ($current &gt; 1) {&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;' . ($current - 1) . '&quot;&gt;' . $icon[&quot;arrowleft&quot;] . '&lt;/a&gt;';&#10;            }&#10;&#10;            // Simple pagination logic&#10;            $start_page = max(1, $current - 2);&#10;            $end_page = min($total_pages, $current + 2);&#10;&#10;            error_log(&quot;  - Start page: &quot; . $start_page);&#10;            error_log(&quot;  - End page: &quot; . $end_page);&#10;&#10;            // Show dots before if needed&#10;            if ($start_page &gt; 1) {&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;1&quot;&gt;1&lt;/a&gt;';&#10;                if ($start_page &gt; 2) {&#10;                    echo '&lt;span class=&quot;dots&quot;&gt;...&lt;/span&gt;';&#10;                }&#10;            }&#10;&#10;            // Show page numbers&#10;            for ($i = $start_page; $i &lt;= $end_page; $i++) {&#10;                $active_class = ($i == $current) ? ' active' : '';&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page' . $active_class . '&quot; data-page=&quot;' . $i . '&quot;&gt;' . $i . '&lt;/a&gt;';&#10;                error_log(&quot;  - Generated page: &quot; . $i . ($i == $current ? ' (active)' : ''));&#10;            }&#10;&#10;            // Show dots after if needed&#10;            if ($end_page &lt; $total_pages) {&#10;                if ($end_page &lt; $total_pages - 1) {&#10;                    echo '&lt;span class=&quot;dots&quot;&gt;...&lt;/span&gt;';&#10;                }&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;' . $total_pages . '&quot;&gt;' . $total_pages . '&lt;/a&gt;';&#10;                error_log(&quot;  - Generated last page: &quot; . $total_pages);&#10;            }&#10;&#10;            // Next button&#10;            if ($current &lt; $total_pages) {&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;' . ($current + 1) . '&quot;&gt;' . $icon[&quot;arrowright&quot;] . '&lt;/a&gt;';&#10;            }&#10;&#10;            echo '&lt;/div&gt;';&#10;        } else {&#10;            error_log(&quot;  ❌ No pagination generated - pages: &quot; . $datas['pages']);&#10;        }&#10;&#10;         $pagination_html = ob_get_clean();&#10;&#10;        // Clean any output that might have leaked&#10;        if (ob_get_level()) {&#10;            ob_clean();&#10;        }&#10;&#10;        wp_send_json_success([&#10;            'boats_html' =&gt; $boats_html,&#10;            'pagination_html' =&gt; $pagination_html,&#10;            'total_boats' =&gt; $datas['total'],&#10;            'has_date_filter' =&gt; !empty($filters['free_yacht']),&#10;            'has_prices' =&gt; !empty($datas['has_prices']),&#10;            'date_range' =&gt; $filters['free_yacht'] ?? ''&#10;        ]);&#10;&#10;        wp_die(); // Ensure clean exit&#10;    }&#10;&#10;    // New endpoint: Fetch prices asynchronously&#10;    add_action('wp_ajax_bl_get_boat_prices', 'bl_get_boat_prices');&#10;    add_action('wp_ajax_nopriv_bl_get_boat_prices', 'bl_get_boat_prices');&#10;&#10;    function bl_get_boat_prices() {&#10;        set_time_limit(300); // 5 minutes for slow API&#10;        ini_set('max_execution_time', 300);&#10;&#10;        $helper = new Boat_Listing_Helper();&#10;&#10;        $date_range = sanitize_text_field($_POST['date_range'] ?? '');&#10;        $boat_ids = isset($_POST['boat_ids']) ? array_map('sanitize_text_field', $_POST['boat_ids']) : [];&#10;&#10;        if (empty($date_range) || empty($boat_ids)) {&#10;            wp_send_json_error(['message' =&gt; 'Missing date range or boat IDs']);&#10;        }&#10;&#10;        try {&#10;            // Parse date range&#10;            if (strpos($date_range, ' to ') !== false) {&#10;                list($start_date_str, $end_date_str) = explode(' to ', $date_range);&#10;                $date_from = date('Y-m-d', strtotime(trim($start_date_str)));&#10;                $date_to = date('Y-m-d', strtotime(trim($end_date_str)));&#10;            } else {&#10;                $date_from = date('Y-m-d', strtotime($date_range));&#10;                $date_to = date('Y-m-d', strtotime($date_range . ' +7 days'));&#10;            }&#10;&#10;            error_log(&quot;Price API: Fetching prices for &quot; . count($boat_ids) . &quot; boats from $date_from to $date_to&quot;);&#10;&#10;            $price_start = microtime(true);&#10;&#10;            // Clear any previous output/errors&#10;            if (ob_get_level()) {&#10;                ob_clean();&#10;            }&#10;&#10;            $all_prices = $helper-&gt;get_all_yacht_prices_batch($date_from, $date_to);&#10;            $price_time = microtime(true) - $price_start;&#10;&#10;            error_log(&quot;Price API: Completed in &quot; . round($price_time, 2) . &quot;s&quot;);&#10;&#10;            if (empty($all_prices) || !is_array($all_prices)) {&#10;                error_log(&quot;⚠️ Price API returned empty or invalid data&quot;);&#10;                wp_send_json_error(['message' =&gt; 'No prices available', 'fetch_time' =&gt; round($price_time, 2)]);&#10;                return;&#10;            }&#10;&#10;            // Filter only requested boat IDs&#10;            $result = [];&#10;            foreach ($boat_ids as $boat_id) {&#10;                if (isset($all_prices[$boat_id])) {&#10;                    $result[$boat_id] = $all_prices[$boat_id];&#10;                }&#10;            }&#10;&#10;            wp_send_json_success([&#10;                'prices' =&gt; $result,&#10;                'fetch_time' =&gt; round($price_time, 2),&#10;                'boat_count' =&gt; count($result)&#10;            ]);&#10;&#10;        } catch (Exception $e) {&#10;            error_log(&quot;Price API Error: &quot; . $e-&gt;getMessage());&#10;            wp_send_json_error(['message' =&gt; $e-&gt;getMessage()]);&#10;        }&#10;&#10;        wp_die();&#10;    }&#10;&#10;// Admin API Test Page&#10;add_action('admin_menu', function() {&#10;    add_submenu_page(&#10;        'tools.php',&#10;        'Boat API Test',&#10;        'Boat API Test',&#10;        'manage_options',&#10;        'boat-api-test',&#10;        'boat_api_test_page'&#10;    );&#10;});&#10;&#10;function boat_api_test_page() {&#10;    if (isset($_POST['run_test'])) {&#10;        $helper = new Boat_Listing_Helper();&#10;        $results = $helper-&gt;test_api();&#10;        echo '&lt;div class=&quot;notice notice-success&quot;&gt;&lt;p&gt;✅ API Test completed! Check error logs for results.&lt;/p&gt;&lt;/div&gt;';&#10;    }&#10;&#10;    ?&gt;&#10;    &lt;div class=&quot;wrap&quot;&gt;&#10;        &lt;h1&gt; Boat API Test&lt;/h1&gt;&#10;        &lt;p&gt;This will test the Booking Manager API with different parameters.&lt;/p&gt;&#10;        &lt;form method=&quot;post&quot;&gt;&#10;            &lt;input type=&quot;hidden&quot; name=&quot;run_test&quot; value=&quot;1&quot;&gt;&#10;            &lt;p class=&quot;submit&quot;&gt;&#10;                &lt;input type=&quot;submit&quot; class=&quot;button-primary&quot; value=&quot; Run API Test&quot;&gt;&#10;            &lt;/p&gt;&#10;        &lt;/form&gt;&#10;&#10;        &lt;h2&gt;Quick Test URLs:&lt;/h2&gt;&#10;        &lt;ul&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=GR&amp;productName=Bareboat&quot; target=&quot;_blank&quot;&gt; Greece + Bareboat&lt;/a&gt;&lt;/li&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=HR&amp;productName=Bareboat&quot; target=&quot;_blank&quot;&gt; Croatia + Bareboat&lt;/a&gt;&lt;/li&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=TR&amp;productName=Bareboat&quot; target=&quot;_blank&quot;&gt; Turkey + Bareboat&lt;/a&gt;&lt;/li&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=GR&quot; target=&quot;_blank&quot;&gt; Greece Only&lt;/a&gt;&lt;/li&gt;&#10;        &lt;/ul&gt;&#10;    &lt;/div&gt;&#10;    &lt;?php&#10;}&#10;&#10;" />
              <option name="updatedContent" value="&lt;?php&#10;    add_shortcode('boat_filter', 'render_boat_listing_filter');&#10;&#10;    function render_boat_listing_filter($atts, $content = null){&#10;&#10;        $helper = new Boat_Listing_Helper();&#10;        $icon = $helper-&gt;icons();&#10;        $charterTypes = $helper-&gt;fetch_category();&#10;        $preloader = $helper-&gt;bl_render_boat_overlay_preloader();&#10;        $getBoatProductTypes = $helper-&gt;getBoatProductTypes();&#10;        $data = $helper-&gt;sortPriorityCountries();&#10;        $getYears = $helper-&gt;getBoatYears();&#10;        $getCabins = $helper-&gt;getBoatCabins();&#10;        $getBoatPersons = $helper-&gt;getBoatPersons();&#10;&#10;        $regionsOrdered     = $data['regions'];&#10;        $remainingCountries = $data['countries'];&#10;&#10;        ob_start();&#10;&#10;        ?&gt;&#10;            &lt;div class=&quot;boat-listing-filter-area&quot; style=&quot;position:relative&quot;&gt;&#10;                &lt;div class=&quot;boat-lists-loader&quot;&gt;&lt;?php echo $preloader; ?&gt;&lt;/div&gt;&#10;&#10;                &lt;div class=&quot;boat-listing-filter-wraper&quot;&gt;&#10;                    &lt;div class=&quot;filter-bar-area&quot;&gt;&#10;                        &lt;div class=&quot;filter-bar&quot;&gt;&#10;                            &lt;strong&gt;&lt;?php echo $icon['filter']; ?&gt; Filter By&lt;/strong&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;charterType&quot;&gt;&lt;?php echo $icon['charter_type']; ?&gt; Charter Type&lt;/label&gt;&#10;                                &lt;select name=&quot;charterType&quot; id=&quot;charterType&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Charter Type &lt;/option&gt;&#10;                                    &lt;?php foreach ($charterTypes as $category): ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($category['name']); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($category['name']); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;!-- Date filter --&gt;&#10;                            &lt;!-- Hidden API fields --&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;dateFrom&quot; id=&quot;dateFrom&quot;&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;dateTo&quot; id=&quot;dateTo&quot;&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;dateRange&quot;&gt;&lt;?php echo $icon['date']; ?&gt; Dates &lt;/label&gt;&#10;                                &lt;input type=&quot;text&quot; id=&quot;dateRange&quot; name=&quot;dateRange&quot; placeholder=&quot;Select date range&quot; autocomplete=&quot;off&quot; class=&quot;boat-listing-input-text bl-date-range-picker&quot; /&gt;&#10;                            &lt;/div&gt;&#10;&#10;                             &lt;!-- Regions --&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;country&quot;&gt;&lt;?php echo $icon['location']; ?&gt; Destinations&lt;/label&gt;&#10;                                &lt;select name=&quot;country&quot; id=&quot;country&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;All Destinations&lt;/option&gt;&#10;                                    &lt;?php if (!empty($priorityCountries)): ?&gt;&#10;                                        &lt;optgroup label=&quot;Popular Destinations&quot;&gt;&#10;                                            &lt;?php foreach ($priorityCountries as $country): ?&gt;&#10;                                                &lt;option value=&quot;&lt;?php echo esc_attr($country['id']); ?&gt;&quot;&gt;&#10;                                                    &lt;?php echo esc_html($country['country_data']['name']); ?&gt;&#10;                                                &lt;/option&gt;&#10;                                            &lt;?php endforeach; ?&gt;&#10;                                        &lt;/optgroup&gt;&#10;                                    &lt;?php endif; ?&gt;&#10;&#10;                                    &lt;?php&#10;                                    foreach ($regionsOrdered as $region):&#10;                                        $regionId   = $region['id'];&#10;                                        $regionName = $region['regions_data']['name'] ?? 'Unknown Region';&#10;&#10;                                        $regionCountries = array_filter($remainingCountries, function ($country) use ($regionId) {&#10;                                            return ($country['country_data']['worldRegion'] ?? null) == $regionId;&#10;                                        });&#10;&#10;                                        if (!empty($regionCountries)):&#10;                                            ?&gt;&#10;                                            &lt;optgroup label=&quot;&lt;?php echo esc_html($regionName); ?&gt;&quot;&gt;&#10;                                                &lt;?php foreach ($regionCountries as $country): ?&gt;&#10;                                                    &lt;option value=&quot;&lt;?php echo esc_attr($country['country_data']['shortName']); ?&gt;&quot;&gt;&#10;                                                        − &lt;?php echo esc_html($country['country_data']['name']); ?&gt;&#10;                                                    &lt;/option&gt;&#10;                                                &lt;?php endforeach; ?&gt;&#10;                                            &lt;/optgroup&gt;&#10;                                        &lt;?php&#10;                                        endif;&#10;                                    endforeach;&#10;                                    ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;productName&quot;&gt;&lt;?php echo $icon['category']; ?&gt; Category&lt;/label&gt;&#10;                                &lt;select name=&quot;productName&quot; id=&quot;productName&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Category&lt;/option&gt;&#10;                                    &lt;?php&#10;                                    foreach ($getBoatProductTypes as $productType):&#10;                                        ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($productType); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($productType); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;!--Person filter --&gt;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;people&quot;&gt;&lt;?php echo $icon['person']; ?&gt; Person&lt;/label&gt;&#10;                                &lt;select name=&quot;people&quot; id=&quot;people&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Person&lt;/option&gt;&#10;                                    &lt;?php foreach ($getBoatPersons as $person):&#10;                                        ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($person); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($person); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;cabin&quot;&gt;&lt;?php echo $icon['cabin']; ?&gt; Cabin&lt;/label&gt;&#10;                                &lt;select name=&quot;cabin&quot; id=&quot;cabin&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Cabin&lt;/option&gt;&#10;                                    &lt;?php foreach( $getCabins as $cabin): ?&gt;&#10;&#10;                                    &lt;option value=&quot;&lt;?php echo $cabin; ?&gt;&quot;&gt;&lt;?php echo $cabin; ?&gt;&lt;/option&gt;&#10;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;filter-fieldset&quot;&gt;&#10;                                &lt;label for=&quot;year&quot;&gt;&lt;?php echo $icon['date']; ?&gt; Build Year&lt;/label&gt;&#10;                                &lt;select name=&quot;year&quot; id=&quot;year&quot; class=&quot;boat-listing-select2&quot;&gt;&#10;                                    &lt;option value=&quot;&quot;&gt;Select Year&lt;/option&gt;&#10;                                    &lt;?php foreach ($getYears as $year):&#10;                                        ?&gt;&#10;                                        &lt;option value=&quot;&lt;?php echo esc_attr($year); ?&gt;&quot;&gt;&#10;                                            &lt;?php echo esc_html($year); ?&gt;&#10;                                        &lt;/option&gt;&#10;                                    &lt;?php endforeach; ?&gt;&#10;                                &lt;/select&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;button id=&quot;submitFilter&quot; type=&quot;button&quot;&gt;Filter&lt;/button&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div class=&quot;contact-info&quot;&gt;&#10;                            &lt;h5 class=&quot;title&quot;&gt;&lt;?php echo $icon['headphone']; ?&gt;Help Center&lt;/h5&gt;&#10;                            &lt;p&gt;We're always just a message away&lt;/p&gt;&#10;                            &lt;div class=&quot;contact-content&quot;&gt;&#10;                                &lt;ul&gt;&#10;                                    &lt;li&gt;&lt;?php echo $icon['email_check']; ?&gt; &lt;a href=&quot;mailto:info@thebarefootparadise.com&quot;&gt;Email Us&lt;/a&gt;&lt;/li&gt;&#10;                                    &lt;li&gt;&lt;?php echo $icon['phone']; ?&gt; &lt;a href=&quot;tel:1-284-342-2387&quot;&gt;1-284-342-2387&lt;/a&gt; or &lt;a href=&quot;tel:340-201-8319&quot;&gt;340-201-8319&lt;/a&gt;&lt;/li&gt;&#10;                                    &lt;li&gt;&lt;?php echo $icon['message']; ?&gt; &lt;a href=&quot;javascript:void(0)&quot; id=&quot;boat-listing-open-hubspot-chat-box&quot;&gt;Chat with us&lt;/a&gt;&lt;/li&gt;&#10;                                &lt;/ul&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;button  class=&quot;need-help-btn filter-page-contact-us-frm&quot;&gt; Contact Us &lt;?php echo $icon['question_round']; ?&gt;&lt;/button&gt;&#10;                        &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;boat-listing-area&quot;&gt;&#10;                        &lt;div class=&quot;boat-count-and-pagination&quot;&gt;&#10;                            &lt;div id=&quot;boat-count&quot; class=&quot;boat-count-message&quot;&gt;&#10;                                &lt;!-- boat count result show here --&gt;&#10;                            &lt;/div&gt;&#10;&#10;                            &lt;div class=&quot;boat-listing-pagi&quot;&gt;&#10;                                &lt;!-- get boat pagination from ajax --&gt;&#10;                            &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                        &#10;                        &lt;div class=&quot;boat-lists&quot;&gt;&#10;                            &lt;!-- get boat list from ajax --&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;div class=&quot;boat-listing-pagi&quot;&gt;&#10;                            &lt;!-- get boat pagination from ajax --&gt;&#10;                        &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;&#10;        &lt;?php&#10;&#10;        $content = ob_get_clean();&#10;&#10;        return $content;&#10;    }&#10;&#10;// End Filter ======================================================&#10;    add_action('wp_ajax_bl_get_paginated_boats', 'bl_get_paginated_boats');&#10;    add_action('wp_ajax_nopriv_bl_get_paginated_boats', 'bl_get_paginated_boats');&#10;&#10;    function bl_get_paginated_boats() {&#10;&#10;        $helper = new Boat_Listing_Helper();&#10;&#10;        $paged = isset($_POST['paged']) ? max(1, intval($_POST['paged'])) : 1;&#10;        $per_page = 10;&#10;&#10;        $filters = [&#10;            'charter_type'  =&gt; sanitize_text_field($_POST['charter_type'] ?? $_GET['charterType'] ?? ''),&#10;            'model'  =&gt; sanitize_text_field($_POST['model'] ?? ''),&#10;            'company'  =&gt; sanitize_text_field($_POST['company'] ?? ''),&#10;            'location' =&gt; sanitize_text_field($_POST['location'] ?? ''),&#10;            'cabin'    =&gt; intval($_POST['cabin'] ?? $_GET['cabin'] ?? 0),&#10;            'person'    =&gt; intval($_POST['person'] ?? $_GET['person'] ?? 0),&#10;            'year'     =&gt; sanitize_text_field($_POST['year'] ?? $_GET['year'] ?? ''),&#10;            'free_yacht'     =&gt; sanitize_text_field($_POST['free_yacht'] ?? ''),&#10;            'category'     =&gt; sanitize_text_field($_POST['category'] ?? ''),&#10;&#10;            // Additional advanced filter parameters&#10;            'berths'    =&gt; intval($_GET['berths'] ?? 0),&#10;            'wc'        =&gt; intval($_GET['wc'] ?? 0),&#10;            'min_length' =&gt; floatval($_GET['minLength'] ?? 0),&#10;            'max_length' =&gt; floatval($_GET['maxLength'] ?? 0),&#10;            'company_id' =&gt; intval($_GET['companyId'] ?? 0),&#10;            'base_from_id' =&gt; intval($_GET['baseFromId'] ?? 0),&#10;            'base_to_id' =&gt; intval($_GET['baseToId'] ?? 0),&#10;            'sailing_area_id' =&gt; intval($_GET['sailingAreaId'] ?? 0),&#10;            'model_id' =&gt; intval($_GET['modelId'] ?? 0),&#10;            'flexibility' =&gt; intval($_GET['flexibility'] ?? 1),&#10;        ];&#10;&#10;        // Debug filters&#10;        error_log(&quot; AJAX Filters received (total: &quot; . count(array_filter($filters)) . &quot;):&quot;);&#10;        foreach($filters as $key =&gt; $value) {&#10;            if (!empty($value)) {&#10;                error_log(&quot;  - {$key}: {$value}&quot;);&#10;            }&#10;        }&#10;&#10;        $country = isset($_GET['country']) &amp;&amp; $_GET['country'] ? $_GET['country'] : '';&#10;        $productName = isset($_GET['productName']) &amp;&amp; $_GET['productName'] ? sanitize_text_field($_GET['productName']) : '';&#10;        $dateFrom = isset($_GET['dateFrom']) &amp;&amp; $_GET['dateFrom'] ? $_GET['dateFrom'] : '';&#10;        $dateTo = isset($_GET['dateTo']) &amp;&amp; $_GET['dateTo'] ? $_GET['dateTo'] : '';&#10;&#10;        // Debug URL parameters&#10;        error_log(&quot; URL Parameters:&quot;);&#10;        error_log(&quot;  - country: &quot; . $country);&#10;        error_log(&quot;  - productName: &quot; . $productName);&#10;        if (!empty($_GET['charterType'])) error_log(&quot;  - charterType: &quot; . $_GET['charterType']);&#10;        if (!empty($_GET['person'])) error_log(&quot;  - person: &quot; . $_GET['person']);&#10;        if (!empty($_GET['cabin'])) error_log(&quot;  - cabin: &quot; . $_GET['cabin']);&#10;        if (!empty($_GET['year'])) error_log(&quot;  - year: &quot; . $_GET['year']);&#10;        if (!empty($_GET['berths'])) error_log(&quot;  - berths: &quot; . $_GET['berths']);&#10;        if (!empty($_GET['companyId'])) error_log(&quot;  - companyId: &quot; . $_GET['companyId']);&#10;&#10;        $icon = $helper-&gt;icons();&#10;&#10;        $datas = $helper-&gt;boat_filters($country, $productName, $dateFrom, $dateTo, $paged, $per_page, $filters);&#10;&#10;        ob_start();&#10;&#10;        if (!empty($datas['boats'])):&#10;&#10;            foreach ($datas['boats'] as $raw):&#10;&#10;                $data = $raw; // already decoded in boat_filters&#10;                $main_image = $data['images'][0]['url'] ?? '';&#10;&#10;                // Parse date range for URL parameters&#10;                $date_from = '';&#10;                $date_to = '';&#10;                $has_date_filter = !empty($_POST['free_yacht'] ?? '');&#10;&#10;                if ($has_date_filter) {&#10;                    $date_input = $_POST['free_yacht'];&#10;                    if (strpos($date_input, ' to ') !== false) {&#10;                        list($start_date_str, $end_date_str) = explode(' to ', $date_input);&#10;                        $date_from = date('Y-m-d', strtotime(trim($start_date_str)));&#10;                        $date_to = date('Y-m-d', strtotime(trim($end_date_str)));&#10;                    } else {&#10;                        $date_from = date('Y-m-d', strtotime($date_input));&#10;                        $date_to = date('Y-m-d', strtotime($date_input . ' +7 days'));&#10;                    }&#10;                }&#10;&#10;                // Build details URL with ALL current filter parameters for proper back navigation&#10;                $url_params = 'id=' . urlencode($data['id'] ?? '');&#10;&#10;                // Add date parameters if available (ensure ISO time format)&#10;                if ($date_from &amp;&amp; $date_to) {&#10;                    // Ensure dates have proper ISO time format for API compatibility&#10;                    $formatted_date_from = $date_from;&#10;                    $formatted_date_to = $date_to;&#10;                    &#10;                    // Add time component if missing&#10;                    if (!empty($formatted_date_from) &amp;&amp; strpos($formatted_date_from, 'T') === false) {&#10;                        $formatted_date_from .= 'T00:00:00';&#10;                    }&#10;                    if (!empty($formatted_date_to) &amp;&amp; strpos($formatted_date_to, 'T') === false) {&#10;                        $formatted_date_to .= 'T00:00:00';&#10;                    }&#10;                    &#10;                    $url_params .= '&amp;dateFrom=' . urlencode($formatted_date_from) . '&amp;dateTo=' . urlencode($formatted_date_to);&#10;                }&#10;&#10;                // Include all current filter parameters so user can return to exact filter state&#10;                $current_filters = [&#10;                    'country' =&gt; $country,&#10;                    'productName' =&gt; $productName,&#10;                    'charterType' =&gt; $_GET['charterType'] ?? '',&#10;                    'person' =&gt; $_GET['person'] ?? '',&#10;                    'cabin' =&gt; $_GET['cabin'] ?? '',&#10;                    'year' =&gt; $_GET['year'] ?? '',&#10;                    'berths' =&gt; $_GET['berths'] ?? '',&#10;                    'wc' =&gt; $_GET['wc'] ?? '',&#10;                    'minLength' =&gt; $_GET['minLength'] ?? '',&#10;                    'maxLength' =&gt; $_GET['maxLength'] ?? '',&#10;                    'companyId' =&gt; $_GET['companyId'] ?? '',&#10;                    'baseFromId' =&gt; $_GET['baseFromId'] ?? '',&#10;                    'baseToId' =&gt; $_GET['baseToId'] ?? '',&#10;                    'sailingAreaId' =&gt; $_GET['sailingAreaId'] ?? '',&#10;                    'modelId' =&gt; $_GET['modelId'] ?? '',&#10;                    'flexibility' =&gt; $_GET['flexibility'] ?? '1'&#10;                ];&#10;&#10;                foreach ($current_filters as $param =&gt; $value) {&#10;                    if ($value !== '') {&#10;                        $url_params .= '&amp;' . $param . '=' . urlencode($value);&#10;                    }&#10;                }&#10;&#10;                $single_url = esc_url(site_url('/boat-details/?' . $url_params));&#10;                ?&gt;&#10;                &lt;div class=&quot;boat-list&quot;&gt;&#10;                    &lt;div class=&quot;boat-img&quot;&gt;&#10;                        &lt;a href=&quot;&lt;?php echo esc_url($main_image); ?&gt;&quot; target=&quot;_blank&quot;&gt;&#10;                            &lt;img src=&quot;&lt;?php echo esc_url($main_image); ?&gt;&quot; alt=&quot;&lt;?php echo esc_attr($data['name'] ?? ''); ?&gt;&quot;&gt;&#10;                        &lt;/a&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;boat-info&quot;&gt;&#10;                        &lt;div class=&quot;boat-title&quot;&gt;&#10;                            &lt;a href=&quot;&lt;?php echo esc_url($single_url); ?&gt;&quot; target=&quot;_blank&quot;&gt;&#10;                                &lt;?php echo esc_html($data['name'] ?? ''); ?&gt;&#10;                            &lt;/a&gt;&#10;                            &lt;?php if (!empty($data['homeBase'])): ?&gt;&#10;                                &lt;span class=&quot;boat-location&quot;&gt;&#10;                                   &lt;?php echo $icon['location']; ?&gt;  &lt;?php echo esc_html($data['homeBase']); ?&gt;&#10;                                &lt;/span&gt;&#10;                            &lt;?php endif; ?&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div class=&quot;other-title&quot;&gt;&#10;                            &lt;div class=&quot;buildyear&quot;&gt;&#10;                                &lt;?php echo $icon['model']; ?&gt;&#10;                                &lt;?php echo 'Model: ' . esc_html($data['model'] ?? 'N/A'); ?&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;div class=&quot;buildyear&quot;&gt;&#10;                                &lt;?php echo $icon['charter_type']; ?&gt;&#10;                                &lt;?php echo 'Charter Type: ' . esc_html($data['kind'] ?? 'N/A'); ?&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;div class=&quot;buildyear&quot;&gt;&#10;                                &lt;?php echo $icon['date']; ?&gt;&#10;                                &lt;?php echo 'Build Year: ' . esc_html($data['year'] ?? 'N/A'); ?&gt;&#10;                            &lt;/div&gt;&#10;                            &#10;                        &lt;/div&gt;&#10;                        &lt;div class=&quot;features&quot;&gt;&#10;                            &lt;ul&gt;&#10;                                &lt;?php if (!empty($data['maxPeopleOnBoard']) &amp;&amp; $data['maxPeopleOnBoard'] &gt; 0): ?&gt;&#10;                                    &lt;li&gt;&#10;                                        &lt;?php echo $icon['person']; ?&gt;&#10;                                        &lt;span&gt;Persons&lt;/span&gt;&#10;                                        &lt;span&gt;&lt;?php echo esc_html($data['maxPeopleOnBoard']); ?&gt;&lt;/span&gt;&#10;                                    &lt;/li&gt;&#10;                                &lt;?php endif; ?&gt;&#10;&#10;                                &lt;li&gt; &lt;?php echo $icon['cabin']; ?&gt; &lt;span&gt;Cabins&lt;/span&gt; &lt;span&gt;&lt;?php echo esc_html($data['cabins'] ?? 'N/A'); ?&gt;&lt;/span&gt;&lt;/li&gt;&#10;                                &lt;li&gt; &lt;?php echo $icon['shower']; ?&gt; &lt;span&gt;Shower&lt;/span&gt; &lt;span&gt;&lt;?php echo esc_html($data['wc'] ?? 'N/A'); ?&gt;&lt;/span&gt;&lt;/li&gt;&#10;                                &lt;li&gt; &lt;?php echo $icon['salon']; ?&gt; &lt;span&gt;Berths&lt;/span&gt; &lt;span&gt;&lt;?php echo esc_html($data['berths'] ?? 'N/A'); ?&gt;&lt;/span&gt;&lt;/li&gt;&#10;                            &lt;/ul&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;?php if (!empty($raw['availability_year'])): ?&gt;&#10;                            &lt;div class=&quot;availability-info&quot;&gt;&#10;                                &lt;strong&gt;Available Year:&lt;/strong&gt; &lt;?php echo esc_html($raw['availability_year']); ?&gt;&#10;                            &lt;/div&gt;&#10;                        &lt;?php endif; ?&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div class=&quot;boat-btn&quot;&gt;&#10;&#10;                        &lt;div class=&quot;price-info-wrap&quot;&gt;&#10;                            &lt;?php&#10;                            // Show offer price if available from API&#10;                            if (!empty($data['offer']['price'])) {&#10;                                $price = number_format($data['offer']['price'], 0);&#10;                                $currency = $data['offer']['currency'] ?? 'EUR';&#10;&#10;                                echo '&lt;div class=&quot;price-info&quot;&gt;';&#10;                                echo '&lt;p&gt;&lt;i class=&quot;ri-money-euro-circle-line&quot; style=&quot;margin-right:4px;&quot;&gt;&lt;/i&gt;';&#10;                                echo 'Price: ' . $price . ' ' . esc_html($currency) . '&lt;/p&gt;';&#10;                                echo '&lt;/div&gt;';&#10;                            } else {&#10;                                echo '&lt;div class=&quot;price-info price-info--hint&quot;&gt;';&#10;                                echo '&lt;p&gt; Select dates to see prices&lt;/p&gt;';&#10;                                echo '&lt;/div&gt;';&#10;                            }&#10;                            ?&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;button class=&quot;boat-book-now&quot;&#10;                                data-id=&quot;&lt;?php echo esc_attr($data['id']); ?&gt;&quot;&#10;                                &lt;?php if ($date_from): ?&gt;data-date-from=&quot;&lt;?php echo esc_attr($date_from); ?&gt;&quot;&lt;?php endif; ?&gt;&#10;                                &lt;?php if ($date_to): ?&gt;data-date-to=&quot;&lt;?php echo esc_attr($date_to); ?&gt;&quot;&lt;?php endif; ?&gt;&#10;                        &gt;&#10;                            &lt;?php _e('Book Now', 'boat-listing'); ?&gt;&#10;                            &lt;span class=&quot;book-now-loader&quot; style=&quot;display: none;&quot;&gt;&lt;/span&gt;&#10;                        &lt;/button&gt;&#10;                        &lt;a href=&quot;&lt;?php echo $single_url; ?&gt;&quot;&gt;&#10;                            &lt;button class=&quot;boat-view&quot;&gt;&lt;?php _e('Details', 'boat-listing'); ?&gt; &lt;?php echo $icon['arrowright']; ?&gt;&lt;/button&gt;&#10;                        &lt;/a&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;?php endforeach;&#10;        else:&#10;            $message = isset($datas['message']) ? $datas['message'] : 'No boats found for your search criteria.';&#10;            echo '&lt;div class=&quot;no-boats-found&quot; style=&quot;text-align:center; padding:40px;&quot;&gt;';&#10;            echo '&lt;h3&gt; ' . $message . '&lt;/h3&gt;';&#10;            echo '&lt;p&gt;&lt;strong&gt;Try these suggestions:&lt;/strong&gt;&lt;/p&gt;';&#10;            echo '&lt;ul style=&quot;text-align:left; display:inline-block;&quot;&gt;';&#10;            echo '&lt;li&gt; Select a different destination (Greece, Croatia, Turkey are popular)&lt;/li&gt;';&#10;            echo '&lt;li&gt; Try different dates (summer months have more availability)&lt;/li&gt;';&#10;            echo '&lt;li&gt;⛵ Choose &quot;Bareboat&quot; or &quot;Crewed&quot; category&lt;/li&gt;';&#10;            echo '&lt;li&gt; Remove date filters to see all available boats&lt;/li&gt;';&#10;            echo '&lt;/ul&gt;';&#10;            echo '&lt;/div&gt;';&#10;        endif;&#10;    &#10;        // This shortcode for booking modal&#10;        echo do_shortcode('[book_now_modal_shortcode]');&#10;&#10;        $boats_html = ob_get_clean();&#10;&#10;        // Pagination HTML&#10;        ob_start();&#10;&#10;        error_log(&quot; Pagination Debug:&quot;);&#10;        error_log(&quot;  - Total pages: &quot; . $datas['pages']);&#10;        error_log(&quot;  - Current page: &quot; . $datas['paged']);&#10;        error_log(&quot;  - Total boats: &quot; . $datas['total']);&#10;&#10;        if ($datas['pages'] &gt; 1) {&#10;            $current = $datas['paged'];&#10;            $total_pages = $datas['pages'];&#10;&#10;            error_log(&quot;  ✅ Generating pagination HTML&quot;);&#10;            error_log(&quot;  - Current page: &quot; . $current);&#10;            error_log(&quot;  - Total pages: &quot; . $total_pages);&#10;&#10;            echo '&lt;div class=&quot;pagination&quot;&gt;';&#10;&#10;&#10;            // Previous button&#10;            if ($current &gt; 1) {&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;' . ($current - 1) . '&quot;&gt;' . $icon[&quot;arrowleft&quot;] . '&lt;/a&gt;';&#10;            }&#10;&#10;            // Simple pagination logic&#10;            $start_page = max(1, $current - 2);&#10;            $end_page = min($total_pages, $current + 2);&#10;&#10;            error_log(&quot;  - Start page: &quot; . $start_page);&#10;            error_log(&quot;  - End page: &quot; . $end_page);&#10;&#10;            // Show dots before if needed&#10;            if ($start_page &gt; 1) {&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;1&quot;&gt;1&lt;/a&gt;';&#10;                if ($start_page &gt; 2) {&#10;                    echo '&lt;span class=&quot;dots&quot;&gt;...&lt;/span&gt;';&#10;                }&#10;            }&#10;&#10;            // Show page numbers&#10;            for ($i = $start_page; $i &lt;= $end_page; $i++) {&#10;                $active_class = ($i == $current) ? ' active' : '';&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page' . $active_class . '&quot; data-page=&quot;' . $i . '&quot;&gt;' . $i . '&lt;/a&gt;';&#10;                error_log(&quot;  - Generated page: &quot; . $i . ($i == $current ? ' (active)' : ''));&#10;            }&#10;&#10;            // Show dots after if needed&#10;            if ($end_page &lt; $total_pages) {&#10;                if ($end_page &lt; $total_pages - 1) {&#10;                    echo '&lt;span class=&quot;dots&quot;&gt;...&lt;/span&gt;';&#10;                }&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;' . $total_pages . '&quot;&gt;' . $total_pages . '&lt;/a&gt;';&#10;                error_log(&quot;  - Generated last page: &quot; . $total_pages);&#10;            }&#10;&#10;            // Next button&#10;            if ($current &lt; $total_pages) {&#10;                echo '&lt;a href=&quot;#&quot; class=&quot;bl-page&quot; data-page=&quot;' . ($current + 1) . '&quot;&gt;' . $icon[&quot;arrowright&quot;] . '&lt;/a&gt;';&#10;            }&#10;&#10;            echo '&lt;/div&gt;';&#10;        } else {&#10;            error_log(&quot;  ❌ No pagination generated - pages: &quot; . $datas['pages']);&#10;        }&#10;&#10;         $pagination_html = ob_get_clean();&#10;&#10;        // Clean any output that might have leaked&#10;        if (ob_get_level()) {&#10;            ob_clean();&#10;        }&#10;&#10;        wp_send_json_success([&#10;            'boats_html' =&gt; $boats_html,&#10;            'pagination_html' =&gt; $pagination_html,&#10;            'total_boats' =&gt; $datas['total'],&#10;            'has_date_filter' =&gt; !empty($filters['free_yacht']),&#10;            'has_prices' =&gt; !empty($datas['has_prices']),&#10;            'date_range' =&gt; $filters['free_yacht'] ?? ''&#10;        ]);&#10;&#10;        wp_die(); // Ensure clean exit&#10;    }&#10;&#10;    // New endpoint: Fetch prices asynchronously&#10;    add_action('wp_ajax_bl_get_boat_prices', 'bl_get_boat_prices');&#10;    add_action('wp_ajax_nopriv_bl_get_boat_prices', 'bl_get_boat_prices');&#10;&#10;    function bl_get_boat_prices() {&#10;        set_time_limit(300); // 5 minutes for slow API&#10;        ini_set('max_execution_time', 300);&#10;&#10;        $helper = new Boat_Listing_Helper();&#10;&#10;        $date_range = sanitize_text_field($_POST['date_range'] ?? '');&#10;        $boat_ids = isset($_POST['boat_ids']) ? array_map('sanitize_text_field', $_POST['boat_ids']) : [];&#10;&#10;        if (empty($date_range) || empty($boat_ids)) {&#10;            wp_send_json_error(['message' =&gt; 'Missing date range or boat IDs']);&#10;        }&#10;&#10;        try {&#10;            // Parse date range&#10;            if (strpos($date_range, ' to ') !== false) {&#10;                list($start_date_str, $end_date_str) = explode(' to ', $date_range);&#10;                $date_from = date('Y-m-d', strtotime(trim($start_date_str)));&#10;                $date_to = date('Y-m-d', strtotime(trim($end_date_str)));&#10;            } else {&#10;                $date_from = date('Y-m-d', strtotime($date_range));&#10;                $date_to = date('Y-m-d', strtotime($date_range . ' +7 days'));&#10;            }&#10;&#10;            error_log(&quot;Price API: Fetching prices for &quot; . count($boat_ids) . &quot; boats from $date_from to $date_to&quot;);&#10;&#10;            $price_start = microtime(true);&#10;&#10;            // Clear any previous output/errors&#10;            if (ob_get_level()) {&#10;                ob_clean();&#10;            }&#10;&#10;            $all_prices = $helper-&gt;get_all_yacht_prices_batch($date_from, $date_to);&#10;            $price_time = microtime(true) - $price_start;&#10;&#10;            error_log(&quot;Price API: Completed in &quot; . round($price_time, 2) . &quot;s&quot;);&#10;&#10;            if (empty($all_prices) || !is_array($all_prices)) {&#10;                error_log(&quot;⚠️ Price API returned empty or invalid data&quot;);&#10;                wp_send_json_error(['message' =&gt; 'No prices available', 'fetch_time' =&gt; round($price_time, 2)]);&#10;                return;&#10;            }&#10;&#10;            // Filter only requested boat IDs&#10;            $result = [];&#10;            foreach ($boat_ids as $boat_id) {&#10;                if (isset($all_prices[$boat_id])) {&#10;                    $result[$boat_id] = $all_prices[$boat_id];&#10;                }&#10;            }&#10;&#10;            wp_send_json_success([&#10;                'prices' =&gt; $result,&#10;                'fetch_time' =&gt; round($price_time, 2),&#10;                'boat_count' =&gt; count($result)&#10;            ]);&#10;&#10;        } catch (Exception $e) {&#10;            error_log(&quot;Price API Error: &quot; . $e-&gt;getMessage());&#10;            wp_send_json_error(['message' =&gt; $e-&gt;getMessage()]);&#10;        }&#10;&#10;        wp_die();&#10;    }&#10;&#10;// Admin API Test Page&#10;add_action('admin_menu', function() {&#10;    add_submenu_page(&#10;        'tools.php',&#10;        'Boat API Test',&#10;        'Boat API Test',&#10;        'manage_options',&#10;        'boat-api-test',&#10;        'boat_api_test_page'&#10;    );&#10;});&#10;&#10;function boat_api_test_page() {&#10;    if (isset($_POST['run_test'])) {&#10;        $helper = new Boat_Listing_Helper();&#10;        $results = $helper-&gt;test_api();&#10;        echo '&lt;div class=&quot;notice notice-success&quot;&gt;&lt;p&gt;✅ API Test completed! Check error logs for results.&lt;/p&gt;&lt;/div&gt;';&#10;    }&#10;&#10;    ?&gt;&#10;    &lt;div class=&quot;wrap&quot;&gt;&#10;        &lt;h1&gt; Boat API Test&lt;/h1&gt;&#10;        &lt;p&gt;This will test the Booking Manager API with different parameters.&lt;/p&gt;&#10;        &lt;form method=&quot;post&quot;&gt;&#10;            &lt;input type=&quot;hidden&quot; name=&quot;run_test&quot; value=&quot;1&quot;&gt;&#10;            &lt;p class=&quot;submit&quot;&gt;&#10;                &lt;input type=&quot;submit&quot; class=&quot;button-primary&quot; value=&quot; Run API Test&quot;&gt;&#10;            &lt;/p&gt;&#10;        &lt;/form&gt;&#10;&#10;        &lt;h2&gt;Quick Test URLs:&lt;/h2&gt;&#10;        &lt;ul&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=GR&amp;productName=Bareboat&quot; target=&quot;_blank&quot;&gt; Greece + Bareboat&lt;/a&gt;&lt;/li&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=HR&amp;productName=Bareboat&quot; target=&quot;_blank&quot;&gt; Croatia + Bareboat&lt;/a&gt;&lt;/li&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=TR&amp;productName=Bareboat&quot; target=&quot;_blank&quot;&gt; Turkey + Bareboat&lt;/a&gt;&lt;/li&gt;&#10;            &lt;li&gt;&lt;a href=&quot;/boat/boat-filter?country=GR&quot; target=&quot;_blank&quot;&gt; Greece Only&lt;/a&gt;&lt;/li&gt;&#10;        &lt;/ul&gt;&#10;    &lt;/div&gt;&#10;    &lt;?php&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>